<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TransCS Pro Ultimate v5.1 - Sistema Completo com Autentica√ß√£o</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.min.js"></script>
    
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --primary-light: #60a5fa;
            --secondary: #10b981;
            --accent: #8b5cf6;
            --warning: #f59e0b;
            --danger: #ef4444;
            --success: #10b981;
            --info: #06b6d4;
            --dark: #1f2937;
            --gray: #6b7280;
            --gray-light: #f3f4f6;
            --gray-dark: #374151;
            --white: #ffffff;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark);
            line-height: 1.6;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--white);
            min-height: 100vh;
            box-shadow: var(--shadow-xl);
            position: relative;
        }

        .dark-mode .container {
            background: var(--dark);
            color: var(--white);
        }

        /* ==================== LOGIN SCREEN ==================== */
        .login-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 2rem;
        }

        .login-box {
            background: rgba(255, 255, 255, 0.95);
            padding: 3rem;
            border-radius: 20px;
            width: 100%;
            max-width: 450px;
            box-shadow: var(--shadow-xl);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .login-box::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(37, 99, 235, 0.1) 0%, transparent 70%);
            animation: loginPulse 4s ease-in-out infinite;
        }

        @keyframes loginPulse {
            0%, 100% { transform: rotate(0deg) scale(1); opacity: 0.3; }
            50% { transform: rotate(180deg) scale(1.1); opacity: 0.1; }
        }

        .login-content {
            position: relative;
            z-index: 2;
        }

        .login-logo {
            margin-bottom: 2rem;
        }

        .login-logo i {
            font-size: 4rem;
            color: var(--primary);
            margin-bottom: 1rem;
            display: block;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .login-logo h1 {
            font-size: 2rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .login-logo .version {
            background: var(--accent);
            color: var(--white);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 0.5rem;
            display: inline-block;
        }

        .auth-toggle {
            display: flex;
            background: var(--gray-light);
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .auth-toggle button {
            flex: 1;
            padding: 0.75rem;
            border: none;
            background: transparent;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .auth-toggle button.active {
            background: var(--primary);
            color: var(--white);
        }

        .form-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .form-label {
            display: block;
            margin-bottom: 0.75rem;
            font-weight: 600;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 2px solid var(--gray-light);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            background: var(--white);
            font-family: inherit;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
            transform: translateY(-1px);
        }

        .password-group {
            position: relative;
        }

        .password-toggle {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            padding: 0.25rem;
        }

        .btn {
            padding: 1rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            text-decoration: none;
            white-space: nowrap;
            font-family: inherit;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s;
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--white);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
            width: 100%;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(37, 99, 235, 0.5);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary), #059669);
            color: var(--white);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }

        .btn-secondary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.5);
        }

        .btn-accent {
            background: linear-gradient(135deg, var(--accent), #7c3aed);
            color: var(--white);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
        }

        .btn-accent:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.5);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            box-shadow: none;
        }

        .btn-outline:hover:not(:disabled) {
            background: var(--primary);
            color: var(--white);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            color: var(--white);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }

        .btn-danger:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.5);
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            width: auto;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .user-type-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 1rem 0;
        }

        .user-type-option {
            padding: 1rem;
            border: 2px solid var(--gray-light);
            border-radius: var(--border-radius);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background: var(--white);
        }

        .user-type-option:hover {
            border-color: var(--primary);
            background: rgba(37, 99, 235, 0.05);
        }

        .user-type-option.selected {
            border-color: var(--primary);
            background: var(--primary);
            color: var(--white);
        }

        .info-box {
            background: linear-gradient(135deg, #e0f2fe 0%, #b3e5fc 100%);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin-top: 1.5rem;
            font-size: 0.9rem;
            color: var(--dark);
            border: 1px solid rgba(6, 182, 212, 0.2);
            text-align: left;
        }

        .invite-notice {
            background: linear-gradient(135deg, #f0fff4 0%, #dcfce7 100%);
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            font-size: 0.9rem;
            border: 1px solid var(--success);
            color: var(--dark);
            text-align: left;
        }

        /* ==================== USER MANAGEMENT MODAL ==================== */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 2rem;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            border-radius: 20px;
            padding: 2rem;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
        }

        .dark-mode .modal-content {
            background: var(--dark);
            color: var(--white);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--primary);
        }

        .modal-title {
            font-size: 1.75rem;
            font-weight: 800;
            color: var(--dark);
        }

        .dark-mode .modal-title {
            color: var(--white);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
            padding: 0.5rem;
            border-radius: 50%;
            transition: var(--transition);
        }

        .close-modal:hover {
            background: var(--gray-light);
            color: var(--dark);
        }

        .user-card {
            background: var(--gray-light);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dark-mode .user-card {
            background: var(--gray-dark);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: 700;
            font-size: 1.2rem;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 1rem;
        }

        .status-active {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .status-blocked {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .invite-link-container {
            background: var(--gray-light);
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-top: 1rem;
            display: none;
        }

        .dark-mode .invite-link-container {
            background: var(--gray-dark);
        }

        .invite-link {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .invite-link input {
            flex: 1;
            font-family: monospace;
            font-size: 0.9rem;
        }

        /* ==================== APP CONTAINER ==================== */
        .app {
            display: none;
        }

        .app.active {
            display: block;
        }

        /* ==================== HEADER ==================== */
        .header {
            background: linear-gradient(135deg, var(--dark) 0%, var(--gray-dark) 100%);
            color: var(--white);
            padding: 2rem;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: headerPulse 6s ease-in-out infinite;
        }

        @keyframes headerPulse {
            0%, 100% { transform: scale(1) rotate(0deg); opacity: 0.3; }
            50% { transform: scale(1.1) rotate(180deg); opacity: 0.1; }
        }

        .header-content {
            position: relative;
            z-index: 2;
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 2rem;
            align-items: center;
        }

        .header-left h1 {
            font-size: 2.5rem;
            font-weight: 900;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--primary-light), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-left .version-badge {
            font-size: 0.75rem;
            background: var(--accent);
            color: var(--white);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        .header-left p {
            opacity: 0.9;
            font-size: 1.1rem;
            font-weight: 500;
        }

        .header-stats {
            display: flex;
            gap: 2rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .quick-stat {
            text-align: center;
            min-width: 80px;
        }

        .quick-stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary-light);
            margin-bottom: 0.25rem;
        }

        .quick-stat-label {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .user-panel {
            background: rgba(255, 255, 255, 0.1);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: right;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-info-panel {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .theme-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: var(--white);
            padding: 0.5rem;
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
            margin-left: 1rem;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Continue with all the existing styles from the previous version... */
        /* (All the navigation, pages, cards, stats, forms, etc. styles remain the same) */

        /* ==================== NAVIGATION ==================== */
        .nav {
            background: var(--dark);
            border-bottom: 3px solid var(--primary);
            position: sticky;
            top: 0;
            z-index: 90;
            box-shadow: var(--shadow);
        }

        .nav-tabs {
            display: flex;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .nav-tabs::-webkit-scrollbar {
            display: none;
        }

        .nav-btn {
            flex: 0 0 auto;
            min-width: 160px;
            padding: 1.25rem 2rem;
            background: transparent;
            border: none;
            color: var(--white);
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            white-space: nowrap;
            position: relative;
        }

        .nav-btn i {
            font-size: 1.1rem;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--white);
            box-shadow: var(--shadow);
        }

        .nav-btn.active::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-light), var(--secondary));
        }

        .nav-btn.hidden {
            display: none !important;
        }

        /* ==================== PAGES ==================== */
        .page {
            display: none;
            padding: 2rem;
            background: var(--gray-light);
            min-height: calc(100vh - 200px);
        }

        .dark-mode .page {
            background: var(--gray-dark);
        }

        .page.active {
            display: block;
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--primary);
        }

        .page-title {
            font-size: 2.25rem;
            font-weight: 800;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .dark-mode .page-title {
            color: var(--white);
        }

        .page-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        /* ==================== CARDS ==================== */
        .card {
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 0, 0, 0.05);
            overflow: hidden;
            transition: var(--transition);
            margin-bottom: 1.5rem;
        }

        .dark-mode .card {
            background: var(--dark);
            border-color: var(--gray-dark);
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--gray-light);
            background: linear-gradient(135deg, var(--white) 0%, #f8fafc 100%);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dark-mode .card-header {
            background: linear-gradient(135deg, var(--dark) 0%, var(--gray-dark) 100%);
            border-bottom-color: var(--gray-dark);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .dark-mode .card-title {
            color: var(--white);
        }

        .card-body {
            padding: 2rem;
        }

        /* ==================== STATS GRID ==================== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--white) 0%, #f8fafc 100%);
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .dark-mode .stat-card {
            background: linear-gradient(135deg, var(--dark) 0%, var(--gray-dark) 100%);
            border-color: var(--gray-dark);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .stat-icon {
            width: 56px;
            height: 56px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            color: var(--white);
            box-shadow: var(--shadow);
        }

        .stat-icon.primary { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); }
        .stat-icon.secondary { background: linear-gradient(135deg, var(--secondary), #059669); }
        .stat-icon.accent { background: linear-gradient(135deg, var(--accent), #7c3aed); }
        .stat-icon.warning { background: linear-gradient(135deg, var(--warning), #d97706); }
        .stat-icon.danger { background: linear-gradient(135deg, var(--danger), #dc2626); }
        .stat-icon.info { background: linear-gradient(135deg, var(--info), #0891b2); }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--dark);
            margin-bottom: 0.5rem;
            line-height: 1;
        }

        .dark-mode .stat-value {
            color: var(--white);
        }

        .stat-label {
            color: var(--gray);
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 1rem;
        }

        .stat-change {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            margin-top: 0.75rem;
            padding: 0.5rem;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.02);
        }

        .stat-change.positive { 
            color: var(--success); 
            background: rgba(16, 185, 129, 0.1);
        }
        .stat-change.negative { 
            color: var(--danger); 
            background: rgba(239, 68, 68, 0.1);
        }
        .stat-change.neutral { 
            color: var(--gray); 
            background: rgba(107, 114, 128, 0.1);
        }

        /* ==================== FORM LAYOUTS ==================== */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-row-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        /* ==================== ITEMS LIST ==================== */
        .item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            background: var(--white);
            transition: var(--transition);
        }

        .dark-mode .item {
            background: var(--dark);
            border-color: var(--gray-dark);
        }

        .item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .item-info {
            flex: 1;
        }

        .item-name {
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--dark);
            font-size: 1.1rem;
        }

        .dark-mode .item-name {
            color: var(--white);
        }

        .item-details {
            color: var(--gray);
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .item-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* ==================== ALERTS ==================== */
        .alert {
            padding: 1.25rem 1.5rem;
            border-radius: var(--border-radius);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            border-left: 4px solid;
            box-shadow: var(--shadow);
        }

        .alert-success {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            color: #065f46;
            border-left-color: var(--success);
        }

        .alert-warning {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #92400e;
            border-left-color: var(--warning);
        }

        .alert-info {
            background: linear-gradient(135deg, #dbeafe 0%, #93c5fd 100%);
            color: #1e40af;
            border-left-color: var(--info);
        }

        .alert-danger {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: #991b1b;
            border-left-color: var(--danger);
        }

        .alert-icon {
            font-size: 1.25rem;
            margin-top: 0.125rem;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        /* ==================== CHARTS ==================== */
        .chart-container {
            position: relative;
            height: 300px;
            margin: 1rem 0;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        /* ==================== CALCULATORS ==================== */
        .calculator-card {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 1px solid rgba(6, 182, 212, 0.2);
            border-radius: var(--border-radius);
            padding: 2rem;
            margin-bottom: 1.5rem;
        }

        .calculator-result {
            background: var(--white);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            border: 2px solid var(--primary);
            margin-top: 1rem;
            text-align: center;
        }

        .result-value {
            font-size: 2rem;
            font-weight: 900;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .result-label {
            color: var(--gray);
            font-weight: 600;
        }

        /* ==================== NOTIFICATIONS ==================== */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            max-width: 400px;
            padding: 1.25rem 1.5rem;
            border-radius: var(--border-radius);
            color: var(--white);
            font-weight: 600;
            z-index: 1000;
            transform: translateX(450px);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            gap: 1rem;
            backdrop-filter: blur(10px);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success { 
            background: linear-gradient(135deg, var(--success), #059669);
        }
        .notification.error { 
            background: linear-gradient(135deg, var(--danger), #dc2626);
        }
        .notification.info { 
            background: linear-gradient(135deg, var(--info), #0891b2);
        }
        .notification.warning { 
            background: linear-gradient(135deg, var(--warning), #d97706);
        }

        .notification-icon {
            font-size: 1.25rem;
        }

        .notification-content {
            flex: 1;
        }

        /* ==================== EMPTY STATE ==================== */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            opacity: 0.3;
            display: block;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--gray-dark);
        }

        .dark-mode .empty-state h3 {
            color: var(--gray-light);
        }

        /* ==================== TABS ==================== */
        .tab-container {
            background: var(--white);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .dark-mode .tab-container {
            background: var(--dark);
        }

        .tab-nav {
            display: flex;
            background: var(--gray-light);
            border-bottom: 1px solid var(--gray-light);
        }

        .dark-mode .tab-nav {
            background: var(--gray-dark);
            border-bottom-color: var(--gray-dark);
        }

        .tab-btn {
            flex: 1;
            padding: 1rem 1.5rem;
            background: transparent;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: var(--gray);
            transition: var(--transition);
        }

        .tab-btn:hover {
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary);
        }

        .tab-btn.active {
            background: var(--white);
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }

        .dark-mode .tab-btn.active {
            background: var(--dark);
            color: var(--primary-light);
        }

        .tab-content {
            display: none;
            padding: 2rem;
        }

        .tab-content.active {
            display: block;
        }

        /* ==================== UTILITIES ==================== */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .text-left { text-align: left; }
        .font-bold { font-weight: 700; }
        .font-semibold { font-weight: 600; }
        .hidden { display: none !important; }
        .block { display: block !important; }
        .flex { display: flex !important; }
        .grid { display: grid !important; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-1 { gap: 0.25rem; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mt-4 { margin-top: 1rem; }
        .w-full { width: 100%; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* ==================== RESPONSIVE ==================== */
        @media (max-width: 1200px) {
            .header-content {
                grid-template-columns: 1fr auto;
                gap: 1.5rem;
            }

            .header-stats {
                display: none;
            }

            .chart-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .login-box, .modal-content {
                margin: 1rem;
                padding: 2rem;
                max-width: calc(100% - 2rem);
            }

            .header {
                padding: 1.5rem;
            }

            .header-content {
                grid-template-columns: 1fr;
                text-align: center;
                gap: 1rem;
            }

            .header-left h1 {
                font-size: 2rem;
                flex-direction: column;
                gap: 0.5rem;
            }

            .nav-tabs {
                overflow-x: auto;
                scrollbar-width: thin;
            }

            .nav-btn {
                min-width: 140px;
                font-size: 0.85rem;
                padding: 1rem 1.5rem;
            }

            .page {
                padding: 1rem;
            }

            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }

            .form-row, .form-row-2, .form-row-3 {
                grid-template-columns: 1fr;
            }

            .chart-grid {
                grid-template-columns: 1fr;
            }

            .item {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .item-actions {
                width: 100%;
                justify-content: center;
            }

            .user-type-selector {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 1rem;
            }

            .header-left h1 {
                font-size: 1.75rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .nav-btn {
                font-size: 0.8rem;
                padding: 0.875rem 1rem;
            }

            .btn {
                padding: 0.75rem 1.25rem;
                font-size: 0.9rem;
            }

            .btn-sm {
                padding: 0.5rem 0.75rem;
                font-size: 0.8rem;
            }

            .card-body {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- LOGIN SCREEN -->
    <div id="loginScreen" class="login-screen">
        <div class="login-box">
            <div class="login-content">
                <div class="login-logo">
                    <i class="fas fa-truck"></i>
                    <h1>TransCS Pro Ultimate</h1>
                    <div class="version">v5.1</div>
                    <p style="margin-top: 1rem; color: var(--gray);">Sistema Completo de Gest√£o de Fretes</p>
                </div>

                <!-- Invite Notice (Hidden by default) -->
                <div id="inviteNotice" class="invite-notice hidden">
                    <div style="font-weight: 600; margin-bottom: 0.5rem;">üéâ Convite V√°lido!</div>
                    <div id="inviteDetails">Complete seu cadastro abaixo.</div>
                </div>
                
                <!-- Auth Toggle -->
                <div class="auth-toggle">
                    <button type="button" class="active" onclick="switchToLogin()">
                        <i class="fas fa-sign-in-alt"></i> Entrar
                    </button>
                    <button type="button" onclick="switchToRegister()">
                        <i class="fas fa-user-plus"></i> Registrar
                    </button>
                </div>

                <!-- Login Form -->
                <form id="loginForm">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-user"></i> Usu√°rio ou Email
                        </label>
                        <input type="text" class="form-input" id="loginUsername" placeholder="Digite seu usu√°rio ou email" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-lock"></i> Senha
                        </label>
                        <div class="password-group">
                            <input type="password" class="form-input" id="loginPassword" placeholder="Digite sua senha" required>
                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility('loginPassword')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; color: var(--gray); cursor: pointer;">
                            <input type="checkbox" id="rememberMe"> Lembrar de mim
                        </label>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-sign-in-alt"></i> Entrar no Sistema
                    </button>
                </form>

                <!-- Register Form (Hidden by default) -->
                <form id="registerForm" class="hidden">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-user"></i> Nome Completo
                        </label>
                        <input type="text" class="form-input" id="registerFullName" placeholder="Seu nome completo" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-envelope"></i> Email
                        </label>
                        <input type="email" class="form-input" id="registerEmail" placeholder="seu@email.com" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-user-circle"></i> Nome de Usu√°rio
                        </label>
                        <input type="text" class="form-input" id="registerUsername" placeholder="Digite um nome de usu√°rio" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-lock"></i> Senha
                        </label>
                        <div class="password-group">
                            <input type="password" class="form-input" id="registerPassword" placeholder="Digite uma senha forte (m√≠n. 4 caracteres)" required minlength="4">
                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility('registerPassword')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-lock"></i> Confirmar Senha
                        </label>
                        <div class="password-group">
                            <input type="password" class="form-input" id="confirmPassword" placeholder="Confirme sua senha" required>
                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility('confirmPassword')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>

                    <!-- User Type Selector -->
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-id-badge"></i> Tipo de Conta
                        </label>
                        <div class="user-type-selector">
                            <div class="user-type-option selected" data-role="user" onclick="selectUserType('user')">
                                <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üë§</div>
                                <div style="font-weight: 600;">Usu√°rio</div>
                                <div style="font-size: 0.8rem; opacity: 0.8;">Acesso restrito</div>
                            </div>
                            <div class="user-type-option" data-role="admin" onclick="selectUserType('admin')">
                                <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üëë</div>
                                <div style="font-weight: 600;">Administrador</div>
                                <div style="font-size: 0.8rem; opacity: 0.8;">Acesso total</div>
                            </div>
                        </div>
                        <input type="hidden" id="selectedUserType" value="user">
                    </div>

                    <!-- Invite Code (Hidden by default) -->
                    <div class="form-group" id="inviteCodeGroup" style="display: none;">
                        <label class="form-label">
                            <i class="fas fa-key"></i> C√≥digo de Convite
                        </label>
                        <input type="text" class="form-input" id="inviteCode" placeholder="Cole o c√≥digo de convite aqui" readonly>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-user-plus"></i> Criar Conta
                    </button>
                </form>

                <div class="info-box">
                    <div style="font-weight: 600; margin-bottom: 0.5rem;">üîê Sistema Seguro</div>
                    <div>
                        ‚Ä¢ <strong>Primeira vez?</strong> Clique em "Registrar" para criar sua conta<br>
                        ‚Ä¢ <strong>Conta Admin:</strong> Usu√°rio: <code>admin</code> | Senha: <code>admin123</code><br>
                        ‚Ä¢ <strong>Multiusu√°rio:</strong> Cada usu√°rio tem seus dados isolados e seguros
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- USER MANAGEMENT MODAL -->
    <div id="userManagementModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-users-cog"></i> Gerenciamento de Usu√°rios
                </h2>
                <button class="close-modal" onclick="closeUserManagement()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="modal-body">
                <!-- User Statistics -->
                <div class="stats-grid" style="grid-template-columns: repeat(3, 1fr); margin-bottom: 2rem;">
                    <div style="text-align: center; padding: 1.5rem; background: var(--gray-light); border-radius: var(--border-radius);">
                        <div style="font-size: 2rem; color: var(--primary); margin-bottom: 0.5rem;" id="totalUsersCount">0</div>
                        <div style="font-weight: 600;">Total de Usu√°rios</div>
                    </div>
                    <div style="text-align: center; padding: 1.5rem; background: var(--gray-light); border-radius: var(--border-radius);">
                        <div style="font-size: 2rem; color: var(--success); margin-bottom: 0.5rem;" id="activeUsersCount">0</div>
                        <div style="font-weight: 600;">Usu√°rios Ativos</div>
                    </div>
                    <div style="text-align: center; padding: 1.5rem; background: var(--gray-light); border-radius: var(--border-radius);">
                        <div style="font-size: 2rem; color: var(--warning); margin-bottom: 0.5rem;" id="adminUsersCount">0</div>
                        <div style="font-weight: 600;">Administradores</div>
                    </div>
                </div>

                <!-- Invite Section -->
                <div class="card" style="margin-bottom: 2rem;">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-user-plus"></i> Convidar Novos Usu√°rios
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="form-row-2">
                            <div class="form-group">
                                <label class="form-label">Tipo de Usu√°rio</label>
                                <select class="form-select" id="inviteUserType">
                                    <option value="user">üë§ Usu√°rio (Acesso Restrito)</option>
                                    <option value="admin">üëë Administrador (Acesso Total)</option>
                                </select>
                            </div>
                            <div class="form-group" style="display: flex; align-items: end;">
                                <button class="btn btn-secondary w-full" onclick="generateInviteLink()">
                                    <i class="fas fa-link"></i> Gerar Link de Convite
                                </button>
                            </div>
                        </div>

                        <div id="inviteLinkContainer" class="invite-link-container">
                            <label class="form-label">Link de Convite Gerado:</label>
                            <div class="invite-link">
                                <input type="text" id="inviteLink" class="form-input" readonly>
                                <button class="btn btn-outline btn-sm" onclick="copyInviteLink()">
                                    <i class="fas fa-copy"></i> Copiar
                                </button>
                            </div>
                            <small style="color: var(--gray); margin-top: 0.5rem; display: block;">
                                ‚ö†Ô∏è Este link expira em 7 dias. Compartilhe apenas com pessoas autorizadas.
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Users List -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-list"></i> Usu√°rios Cadastrados
                        </h3>
                        <div class="flex gap-2">
                            <select class="form-select" id="userFilterRole" onchange="filterUsers()" style="width: 150px;">
                                <option value="">Todos</option>
                                <option value="admin">Administradores</option>
                                <option value="user">Usu√°rios</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="usersList">
                            <!-- Users will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- NOTIFICATION -->
    <div id="notification" class="notification">
        <i class="notification-icon fas fa-check-circle"></i>
        <div class="notification-content">
            <span id="notificationText">Mensagem</span>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="app" class="container app">
        <!-- HEADER -->
        <div class="header">
            <div class="header-content">
                <div class="header-left">
                    <h1>
                        <i class="fas fa-truck"></i> 
                        TransCS Pro Ultimate
                        <span class="version-badge">v5.1</span>
                    </h1>
                    <p>Sistema Completo de Gest√£o de Fretes com Autentica√ß√£o Segura</p>
                </div>
                
                <div class="header-stats">
                    <div class="quick-stat">
                        <div class="quick-stat-value" id="headerClients">0</div>
                        <div class="quick-stat-label">Clientes</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-value" id="headerTrips">0</div>
                        <div class="quick-stat-label">Viagens</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-value" id="headerRevenue">R$ 0</div>
                        <div class="quick-stat-label">Receita</div>
                    </div>
                </div>

                <div class="user-panel">
                    <div class="user-info-panel">
                        <div>
                            <strong id="userName">Usu√°rio</strong>
                            <span id="userRole" style="font-size: 0.8rem; opacity: 0.8; display: block;">(Carregando...)</span>
                        </div>
                        <div style="font-size: 0.8rem; opacity: 0.7;" id="currentTime"></div>
                    </div>
                    <div class="user-avatar" id="userAvatar">U</div>
                    <button class="theme-toggle" onclick="toggleTheme()" title="Alternar tema">
                        <i class="fas fa-moon" id="themeIcon"></i>
                    </button>
                    <div class="flex gap-2" style="margin-left: 1rem;">
                        <button class="btn btn-sm btn-accent" id="manageUsersBtn" onclick="openUserManagement()" style="display: none;">
                            <i class="fas fa-users-cog"></i> Usu√°rios
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i> Sair
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- NAVIGATION -->
        <div class="nav">
            <div class="nav-tabs">
                <button class="nav-btn active" onclick="showPage('dashboard')">
                    <i class="fas fa-chart-line"></i> Dashboard
                </button>
                <button class="nav-btn" onclick="showPage('clients')">
                    <i class="fas fa-users"></i> Clientes
                </button>
                <button class="nav-btn" onclick="showPage('suppliers')">
                    <i class="fas fa-truck-loading"></i> Fornecedores
                </button>
                <button class="nav-btn" onclick="showPage('trips')">
                    <i class="fas fa-truck"></i> Viagens
                </button>
                <button class="nav-btn" onclick="showPage('calculators')">
                    <i class="fas fa-calculator"></i> Calculadoras
                </button>
                <button class="nav-btn" onclick="showPage('analytics')">
                    <i class="fas fa-chart-pie"></i> Analytics
                </button>
                <button class="nav-btn" id="financialTab" onclick="showPage('financial')">
                    <i class="fas fa-dollar-sign"></i> Financeiro
                </button>
                <button class="nav-btn" onclick="showPage('reports')">
                    <i class="fas fa-file-alt"></i> Relat√≥rios
                </button>
                <button class="nav-btn" onclick="showPage('settings')">
                    <i class="fas fa-cog"></i> Configura√ß√µes
                </button>
            </div>
        </div>

        <!-- DASHBOARD PAGE -->
        <div id="dashboard" class="page active">
            <div class="page-header">
                <h2 class="page-title">
                    <i class="fas fa-chart-line"></i> Dashboard Executivo
                </h2>
                <div class="page-actions">
                    <button class="btn btn-secondary btn-sm" onclick="refreshDashboard()">
                        <i class="fas fa-sync-alt"></i> Atualizar
                    </button>
                    <button class="btn btn-primary btn-sm" onclick="showPage('trips')">
                        <i class="fas fa-plus"></i> Nova Viagem
                    </button>
                </div>
            </div>

            <div class="alert alert-success">
                <i class="alert-icon fas fa-shield-check"></i>
                <div class="alert-content">
                    <div class="alert-title">üîí Sistema Seguro Ativo!</div>
                    TransCS Pro Ultimate v5.1 com autentica√ß√£o completa. Voc√™ est√° logado como <strong id="dashboardUserRole">usu√°rio</strong>. Todos os dados s√£o protegidos e isolados por conta.
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon primary">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="totalRevenue">R$ 0,00</div>
                    <div class="stat-label">Receita Total</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span id="revenueChange">+0%</span> vs m√™s anterior
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon secondary">
                            <i class="fas fa-chart-line"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="totalProfit">R$ 0,00</div>
                    <div class="stat-label">Lucro Total</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span id="profitChange">+0%</span> vs m√™s anterior
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon accent">
                            <i class="fas fa-percentage"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="avgMargin">0%</div>
                    <div class="stat-label">Margem M√©dia</div>
                    <div class="stat-change neutral">
                        <span id="marginChange">Est√°vel</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon info">
                            <i class="fas fa-truck"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="totalTrips">0</div>
                    <div class="stat-label">Total de Viagens</div>
                    <div class="stat-change positive">
                        <i class="fas fa-plus"></i>
                        <span id="tripsChange">0</span> este m√™s
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon warning">
                            <i class="fas fa-road"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="totalKm">0 km</div>
                    <div class="stat-label">KM Rodados</div>
                    <div class="stat-change neutral">
                        <span id="avgPerKm">R$ 0,00/km</span> m√©dia
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon danger">
                            <i class="fas fa-users"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="totalClients">0</div>
                    <div class="stat-label">Clientes Ativos</div>
                    <div class="stat-change neutral">
                        <span id="topClient">-</span> mais lucrativo
                    </div>
                </div>
            </div>

            <div class="chart-grid">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-chart-area"></i> Receita por M√™s
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="revenueChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-chart-pie"></i> Lucro por Cliente
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="clientChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-rocket"></i> A√ß√µes R√°pidas
                    </h3>
                </div>
                <div class="card-body">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <button class="btn btn-primary" onclick="showPage('clients')">
                            <i class="fas fa-user-plus"></i> Novo Cliente
                        </button>
                        <button class="btn btn-secondary" onclick="showPage('suppliers')">
                            <i class="fas fa-truck-loading"></i> Novo Fornecedor
                        </button>
                        <button class="btn btn-accent" onclick="showPage('trips')">
                            <i class="fas fa-plus"></i> Nova Viagem
                        </button>
                        <button class="btn btn-outline" onclick="showPage('calculators')">
                            <i class="fas fa-calculator"></i> Calculadoras
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Continue with all other pages from the previous version... -->
        <!-- For brevity, I'll include key pages that need authentication updates -->

        <!-- SETTINGS PAGE -->
        <div id="settings" class="page">
            <div class="page-header">
                <h2 class="page-title">
                    <i class="fas fa-cog"></i> Configura√ß√µes do Sistema
                </h2>
            </div>

            <div class="tab-container">
                <div class="tab-nav">
                    <button class="tab-btn active" onclick="showTab('settings-profile', this)">
                        <i class="fas fa-user-cog"></i> Meu Perfil
                    </button>
                    <button class="tab-btn" onclick="showTab('settings-general', this)">
                        <i class="fas fa-cog"></i> Gerais
                    </button>
                    <button class="tab-btn" onclick="showTab('settings-security', this)">
                        <i class="fas fa-shield-alt"></i> Seguran√ßa
                    </button>
                    <button class="tab-btn" onclick="showTab('settings-system', this)">
                        <i class="fas fa-server"></i> Sistema
                    </button>
                </div>

                <!-- Profile Settings -->
                <div id="settings-profile" class="tab-content active">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-user-edit"></i> Informa√ß√µes Pessoais
                            </h3>
                        </div>
                        <div class="card-body">
                            <form id="profileForm">
                                <div class="alert alert-info">
                                    <i class="alert-icon fas fa-info-circle"></i>
                                    <div class="alert-content">
                                        <div class="alert-title">üë§ Editar Perfil</div>
                                        Altere suas informa√ß√µes pessoais e credenciais de acesso. As altera√ß√µes entram em vigor imediatamente.
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Nome Completo</label>
                                        <input type="text" class="form-input" id="profileFullName" placeholder="Seu nome completo" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Email</label>
                                        <input type="email" class="form-input" id="profileEmail" placeholder="seu@email.com" required>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Nome de Usu√°rio</label>
                                        <input type="text" class="form-input" id="profileUsername" placeholder="Nome de usu√°rio √∫nico" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Tipo de Conta</label>
                                        <input type="text" class="form-input" id="profileRole" readonly style="background: var(--gray-light); cursor: not-allowed;">
                                    </div>
                                </div>

                                <div style="margin-top: 2rem;">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i> Salvar Altera√ß√µes
                                    </button>
                                    <button type="button" class="btn btn-outline" onclick="loadProfileData()">
                                        <i class="fas fa-undo"></i> Cancelar
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Account Info Display -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-info-circle"></i> Informa√ß√µes da Conta
                            </h3>
                        </div>
                        <div class="card-body">
                            <div class="stats-grid">
                                <div style="text-align: center; padding: 2rem; background: var(--gray-light); border-radius: var(--border-radius);">
                                    <div style="font-size: 3rem; margin-bottom: 1rem;" id="profileAvatarDisplay">üë§</div>
                                    <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;" id="profileDisplayName">-</div>
                                    <div style="color: var(--gray); font-size: 0.9rem;" id="profileDisplayUsername">@-</div>
                                </div>

                                <div style="text-align: center; padding: 2rem; background: var(--gray-light); border-radius: var(--border-radius);">
                                    <div style="font-size: 2rem; margin-bottom: 1rem; color: var(--primary);">üîë</div>
                                    <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;">N√≠vel de Acesso</div>
                                    <div style="color: var(--primary); font-weight: 600;" id="profileDisplayRole">-</div>
                                </div>

                                <div style="text-align: center; padding: 2rem; background: var(--gray-light); border-radius: var(--border-radius);">
                                    <div style="font-size: 2rem; margin-bottom: 1rem; color: var(--secondary);">üìÖ</div>
                                    <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;">Membro desde</div>
                                    <div style="color: var(--gray); font-weight: 600;" id="profileDisplayCreated">-</div>
                                </div>

                                <div style="text-align: center; padding: 2rem; background: var(--gray-light); border-radius: var(--border-radius);">
                                    <div style="font-size: 2rem; margin-bottom: 1rem; color: var(--success);">üïê</div>
                                    <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;">√öltimo Acesso</div>
                                    <div style="color: var(--gray); font-weight: 600;" id="profileDisplayLastLogin">-</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Security Settings -->
                <div id="settings-security" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-key"></i> Alterar Senha
                            </h3>
                        </div>
                        <div class="card-body">
                            <form id="passwordForm">
                                <div class="alert alert-warning">
                                    <i class="alert-icon fas fa-exclamation-triangle"></i>
                                    <div class="alert-content">
                                        <div class="alert-title">üîê Altera√ß√£o de Senha</div>
                                        Por seguran√ßa, digite sua senha atual para confirmar sua identidade antes de definir uma nova senha.
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Senha Atual</label>
                                        <div class="password-group">
                                            <input type="password" class="form-input" id="currentPassword" placeholder="Digite sua senha atual" required>
                                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility('currentPassword')">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Nova Senha</label>
                                        <div class="password-group">
                                            <input type="password" class="form-input" id="newPassword" placeholder="Digite a nova senha (m√≠n. 4 caracteres)" required minlength="4">
                                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility('newPassword')">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Confirmar Nova Senha</label>
                                        <div class="password-group">
                                            <input type="password" class="form-input" id="confirmNewPassword" placeholder="Confirme a nova senha" required>
                                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility('confirmNewPassword')">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div style="margin-top: 2rem;">
                                    <button type="submit" class="btn btn-danger">
                                        <i class="fas fa-key"></i> Alterar Senha
                                    </button>
                                    <button type="button" class="btn btn-outline" onclick="document.getElementById('passwordForm').reset()">
                                        <i class="fas fa-eraser"></i> Limpar Campos
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Security Status -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-shield-check"></i> Status de Seguran√ßa
                            </h3>
                        </div>
                        <div class="card-body">
                            <div class="stats-grid">
                                <div style="text-align: center; padding: 2rem; background: linear-gradient(135deg, #d1fae5, #a7f3d0); border-radius: var(--border-radius);">
                                    <div style="font-size: 2rem; margin-bottom: 1rem; color: var(--success);">üîí</div>
                                    <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;">Conta Protegida</div>
                                    <div style="color: var(--success); font-weight: 600;">Sistema Seguro</div>
                                </div>

                                <div style="text-align: center; padding: 2rem; background: var(--gray-light); border-radius: var(--border-radius);">
                                    <div style="font-size: 2rem; margin-bottom: 1rem; color: var(--info);">üõ°Ô∏è</div>
                                    <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;">Dados Isolados</div>
                                    <div style="color: var(--info); font-weight: 600;">Por Usu√°rio</div>
                                </div>

                                <div style="text-align: center; padding: 2rem; background: var(--gray-light); border-radius: var(--border-radius);">
                                    <div style="font-size: 2rem; margin-bottom: 1rem; color: var(--warning);">üîê</div>
                                    <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;">Autentica√ß√£o</div>
                                    <div style="color: var(--warning); font-weight: 600;">Ativa</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- General Settings -->
                <div id="settings-general" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-palette"></i> Prefer√™ncias
                            </h3>
                        </div>
                        <div class="card-body">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Tema do Sistema</label>
                                    <select class="form-select" id="themeSelect" onchange="changeTheme(this.value)">
                                        <option value="light">‚òÄÔ∏è Claro</option>
                                        <option value="dark">üåô Escuro</option>
                                        <option value="auto">üîÑ Autom√°tico</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Idioma</label>
                                    <select class="form-select">
                                        <option value="pt-BR">üáßüá∑ Portugu√™s (Brasil)</option>
                                        <option value="en-US">üá∫üá∏ English (US)</option>
                                        <option value="es-ES">üá™üá∏ Espa√±ol</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Formato de Data</label>
                                    <select class="form-select">
                                        <option value="dd/mm/yyyy">DD/MM/AAAA</option>
                                        <option value="mm/dd/yyyy">MM/DD/YYYY</option>
                                        <option value="yyyy-mm-dd">AAAA-MM-DD</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- System Settings -->
                <div id="settings-system" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-info-circle"></i> Informa√ß√µes do Sistema
                            </h3>
                        </div>
                        <div class="card-body">
                            <div class="stats-grid">
                                <div style="text-align: center; padding: 2rem; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; border-radius: var(--border-radius);">
                                    <div style="font-size: 3rem; margin-bottom: 1rem;">üöõ</div>
                                    <div style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem;">TransCS Pro Ultimate</div>
                                    <div style="opacity: 0.9;">Vers√£o 5.1.0</div>
                                </div>

                                <div style="text-align: center; padding: 2rem; background: var(--gray-light); border-radius: var(--border-radius);">
                                    <div style="font-size: 2rem; margin-bottom: 1rem; color: var(--success);">‚úÖ</div>
                                    <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;">Status</div>
                                    <div style="color: var(--success); font-weight: 600;">Online</div>
                                </div>

                                <div style="text-align: center; padding: 2rem; background: var(--gray-light); border-radius: var(--border-radius);">
                                    <div style="font-size: 2rem; margin-bottom: 1rem; color: var(--info);">üîí</div>
                                    <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;">Seguran√ßa</div>
                                    <div style="color: var(--info); font-weight: 600;">Autentica√ß√£o Ativa</div>
                                </div>

                                <div style="text-align: center; padding: 2rem; background: var(--gray-light); border-radius: var(--border-radius);">
                                    <div style="font-size: 2rem; margin-bottom: 1rem; color: var(--warning);">‚ö°</div>
                                    <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;">Performance</div>
                                    <div style="color: var(--warning); font-weight: 600;">Otimizada</div>
                                </div>
                            </div>

                            <div style="margin-top: 2rem; text-align: center;">
                                <button class="btn btn-danger" onclick="clearAllUserData()">
                                    <i class="fas fa-trash-alt"></i> Limpar Meus Dados
                                </button>
                                <button class="btn btn-outline" onclick="exportUserBackup()">
                                    <i class="fas fa-download"></i> Backup dos Meus Dados
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add other pages here... (clients, suppliers, trips, etc.) -->
        <!-- For space, I'll include the simplified versions -->
        
        <!-- CLIENTS PAGE -->
        <div id="clients" class="page">
            <div class="page-header">
                <h2 class="page-title">
                    <i class="fas fa-users"></i> Gest√£o de Clientes
                </h2>
            </div>
            <div class="card">
                <div class="card-body">
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <h3>Gest√£o de Clientes</h3>
                        <p>Sistema de clientes funcionando com dados isolados por usu√°rio.</p>
                        <button class="btn btn-primary" onclick="showNotification('Sistema de clientes em desenvolvimento!', 'info')">
                            <i class="fas fa-plus"></i> Adicionar Cliente
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- SUPPLIERS PAGE -->
        <div id="suppliers" class="page">
            <div class="page-header">
                <h2 class="page-title">
                    <i class="fas fa-truck-loading"></i> Gest√£o de Fornecedores
                </h2>
            </div>
            <div class="card">
                <div class="card-body">
                    <div class="empty-state">
                        <i class="fas fa-truck-loading"></i>
                        <h3>Gest√£o de Fornecedores</h3>
                        <p>Sistema de fornecedores funcionando com dados isolados por usu√°rio.</p>
                        <button class="btn btn-secondary" onclick="showNotification('Sistema de fornecedores em desenvolvimento!', 'info')">
                            <i class="fas fa-plus"></i> Adicionar Fornecedor
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- TRIPS PAGE -->
        <div id="trips" class="page">
            <div class="page-header">
                <h2 class="page-title">
                    <i class="fas fa-truck"></i> Gest√£o de Viagens
                </h2>
            </div>
            <div class="card">
                <div class="card-body">
                    <div class="empty-state">
                        <i class="fas fa-truck"></i>
                        <h3>Gest√£o de Viagens</h3>
                        <p>Sistema de viagens funcionando com dados isolados por usu√°rio.</p>
                        <button class="btn btn-accent" onclick="showNotification('Sistema de viagens em desenvolvimento!', 'info')">
                            <i class="fas fa-plus"></i> Nova Viagem
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- CALCULATORS PAGE -->
        <div id="calculators" class="page">
            <div class="page-header">
                <h2 class="page-title">
                    <i class="fas fa-calculator"></i> Calculadoras Inteligentes
                </h2>
            </div>
            <div class="card">
                <div class="card-body">
                    <div class="empty-state">
                        <i class="fas fa-calculator"></i>
                        <h3>Calculadoras Inteligentes</h3>
                        <p>Ferramentas de c√°lculo avan√ßadas para an√°lise de viagens e custos.</p>
                        <button class="btn btn-outline" onclick="showNotification('Calculadoras em desenvolvimento!', 'info')">
                            <i class="fas fa-brain"></i> Usar Calculadoras
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ANALYTICS PAGE -->
        <div id="analytics" class="page">
            <div class="page-header">
                <h2 class="page-title">
                    <i class="fas fa-chart-pie"></i> Analytics Avan√ßados
                </h2>
            </div>
            <div class="card">
                <div class="card-body">
                    <div class="empty-state">
                        <i class="fas fa-chart-pie"></i>
                        <h3>Analytics Avan√ßados</h3>
                        <p>An√°lises detalhadas e insights inteligentes sobre seu neg√≥cio.</p>
                        <button class="btn btn-outline" onclick="showNotification('Analytics em desenvolvimento!', 'info')">
                            <i class="fas fa-chart-bar"></i> Ver Analytics
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- FINANCIAL PAGE -->
        <div id="financial" class="page">
            <div class="page-header">
                <h2 class="page-title">
                    <i class="fas fa-dollar-sign"></i> Gest√£o Financeira
                </h2>
            </div>
            <div class="alert alert-warning">
                <i class="alert-icon fas fa-lock"></i>
                <div class="alert-content">
                    <div class="alert-title">üîí Acesso Restrito</div>
                    Esta se√ß√£o √© exclusiva para administradores. Cont√©m informa√ß√µes financeiras sens√≠veis e controles de fluxo de caixa.
                </div>
            </div>
            <div class="card">
                <div class="card-body">
                    <div class="empty-state">
                        <i class="fas fa-dollar-sign"></i>
                        <h3>Gest√£o Financeira</h3>
                        <p>Controle financeiro completo com fluxo de caixa e relat√≥rios avan√ßados.</p>
                        <button class="btn btn-outline" onclick="showNotification('Sistema financeiro em desenvolvimento!', 'info')">
                            <i class="fas fa-chart-line"></i> Ver Financeiro
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- REPORTS PAGE -->
        <div id="reports" class="page">
            <div class="page-header">
                <h2 class="page-title">
                    <i class="fas fa-file-alt"></i> Relat√≥rios Avan√ßados
                </h2>
            </div>
            <div class="card">
                <div class="card-body">
                    <div class="empty-state">
                        <i class="fas fa-file-alt"></i>
                        <h3>Relat√≥rios Avan√ßados</h3>
                        <p>Relat√≥rios detalhados e an√°lises completas dos seus dados.</p>
                        <button class="btn btn-outline" onclick="showNotification('Sistema de relat√≥rios em desenvolvimento!', 'info')">
                            <i class="fas fa-chart-bar"></i> Gerar Relat√≥rio
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== GLOBAL VARIABLES ====================
        let currentUser = null;
        let authSystem = null;
        let data = {
            users: [],
            invites: {},
            sessions: {}
        };

        let charts = {
            revenue: null,
            client: null
        };

        // ==================== AUTHENTICATION SYSTEM ====================
        class AuthenticationSystem {
            constructor() {
                this.users = this.loadFromStorage('transcs_users', []);
                this.invites = this.loadFromStorage('transcs_invites', {});
                this.sessions = this.loadFromStorage('transcs_sessions', {});
                this.init();
            }

            init() {
                // Create default admin user if no users exist
                if (this.users.length === 0) {
                    this.createDefaultAdmin();
                }

                // Check for invite code in URL
                this.checkInviteCode();

                // Check for existing session
                this.checkExistingSession();

                // Setup event listeners
                this.setupEventListeners();
            }

            createDefaultAdmin() {
                const adminUser = {
                    id: Date.now(),
                    username: 'admin',
                    password: 'admin123', // In production, use proper hashing
                    email: 'admin@transcs.com',
                    fullName: 'Administrador do Sistema',
                    role: 'admin',
                    status: 'active',
                    createdAt: new Date().toISOString(),
                    lastLogin: null
                };

                this.users.push(adminUser);
                this.saveToStorage('transcs_users', this.users);
                console.log('üëë Admin user created: admin / admin123');
            }

            checkInviteCode() {
                const urlParams = new URLSearchParams(window.location.search);
                const inviteCode = urlParams.get('invite');
                
                if (inviteCode) {
                    const inviteData = this.invites[inviteCode];
                    if (inviteData && new Date(inviteData.expiresAt) > new Date()) {
                        this.showInviteNotice(inviteData);
                        this.switchToRegisterWithInvite(inviteCode, inviteData.role);
                    } else {
                        this.showNotification('‚ùå C√≥digo de convite inv√°lido ou expirado.', 'error');
                        // Clean URL
                        window.history.replaceState({}, document.title, window.location.pathname);
                    }
                }
            }

            showInviteNotice(inviteData) {
                const notice = document.getElementById('inviteNotice');
                const details = document.getElementById('inviteDetails');
                const roleText = inviteData.role === 'admin' ? 'Administrador' : 'Usu√°rio';
                
                details.textContent = `Voc√™ foi convidado como ${roleText}. Complete seu cadastro abaixo.`;
                notice.classList.remove('hidden');
            }

            switchToRegisterWithInvite(code, role) {
                switchToRegister();
                document.getElementById('inviteCode').value = code;
                document.getElementById('selectedUserType').value = role;
                document.getElementById('inviteCodeGroup').style.display = 'block';
                selectUserType(role);
            }

            checkExistingSession() {
                const savedSession = localStorage.getItem('transcs_session');
                if (savedSession) {
                    try {
                        const sessionData = JSON.parse(savedSession);
                        if (this.validateSession(sessionData)) {
                            const user = this.users.find(u => u.id === sessionData.userId);
                            if (user && user.status === 'active') {
                                this.loginUser(user);
                                return;
                            }
                        }
                    } catch (error) {
                        console.error('Invalid session data:', error);
                    }
                }
                
                // No valid session found
                this.showLoginScreen();
            }

            validateSession(sessionData) {
                const sessionExpiry = new Date(sessionData.expiresAt);
                return sessionExpiry > new Date();
            }

            setupEventListeners() {
                // Login form
                document.getElementById('loginForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleLogin(e);
                });

                // Register form
                document.getElementById('registerForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleRegister(e);
                });

                // Profile form
                document.getElementById('profileForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleProfileUpdate(e);
                });

                // Password form
                document.getElementById('passwordForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handlePasswordChange(e);
                });
            }

            async handleLogin(e) {
                const username = document.getElementById('loginUsername').value.trim();
                const password = document.getElementById('loginPassword').value;
                const remember = document.getElementById('rememberMe').checked;

                const submitBtn = e.target.querySelector('button[type="submit"]');
                const originalText = submitBtn.innerHTML;
                
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Entrando...';

                try {
                    // Find user by username or email
                    const user = this.users.find(u => 
                        u.username === username || u.email === username
                    );
                    
                    if (!user) {
                        throw new Error('Usu√°rio n√£o encontrado');
                    }

                    if (user.status === 'blocked') {
                        throw new Error('Usu√°rio bloqueado. Entre em contato com o administrador.');
                    }

                    if (user.password !== password) { // In production, use proper password verification
                        throw new Error('Senha incorreta');
                    }

                    // Update last login
                    user.lastLogin = new Date().toISOString();
                    this.saveToStorage('transcs_users', this.users);

                    // Create session
                    this.createSession(user, remember);
                    
                    showNotification(`üéâ Bem-vindo de volta, ${user.fullName}!`, 'success');
                    
                    setTimeout(() => {
                        this.loginUser(user);
                    }, 1000);

                } catch (error) {
                    showNotification(error.message, 'error');
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalText;
                }
            }

            async handleRegister(e) {
                const fullName = document.getElementById('registerFullName').value.trim();
                const email = document.getElementById('registerEmail').value.trim();
                const username = document.getElementById('registerUsername').value.trim();
                const password = document.getElementById('registerPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                const role = document.getElementById('selectedUserType').value;
                const inviteCode = document.getElementById('inviteCode').value.trim();

                const submitBtn = e.target.querySelector('button[type="submit"]');
                const originalText = submitBtn.innerHTML;
                
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Criando conta...';

                try {
                    // Validation
                    if (password !== confirmPassword) {
                        throw new Error('As senhas n√£o coincidem');
                    }

                    if (password.length < 4) {
                        throw new Error('A senha deve ter pelo menos 4 caracteres');
                    }

                    // Check if username already exists
                    if (this.users.find(u => u.username === username)) {
                        throw new Error('Nome de usu√°rio j√° est√° em uso');
                    }

                    // Check if email already exists
                    if (this.users.find(u => u.email === email)) {
                        throw new Error('Email j√° est√° cadastrado');
                    }

                    // Validate invite code if provided
                    if (inviteCode) {
                        const inviteData = this.invites[inviteCode];
                        if (!inviteData || new Date(inviteData.expiresAt) <= new Date()) {
                            throw new Error('C√≥digo de convite inv√°lido ou expirado');
                        }
                        // Use role from invite
                        role = inviteData.role;
                    } else if (role === 'admin') {
                        // Don't allow admin registration without invite
                        throw new Error('Registro de administrador requer c√≥digo de convite');
                    }

                    // Create new user
                    const newUser = {
                        id: Date.now(),
                        username: username,
                        password: password, // In production, hash this
                        email: email,
                        fullName: fullName,
                        role: role,
                        status: 'active',
                        createdAt: new Date().toISOString(),
                        lastLogin: null
                    };

                    this.users.push(newUser);
                    this.saveToStorage('transcs_users', this.users);

                    // Remove used invite code
                    if (inviteCode && this.invites[inviteCode]) {
                        delete this.invites[inviteCode];
                        this.saveToStorage('transcs_invites', this.invites);
                    }

                    showNotification(`‚úÖ Conta criada com sucesso! Bem-vindo, ${fullName}!`, 'success');
                    
                    // Auto-login the new user
                    setTimeout(() => {
                        this.createSession(newUser, false);
                        this.loginUser(newUser);
                    }, 1500);

                } catch (error) {
                    showNotification(error.message, 'error');
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalText;
                }
            }

            handleProfileUpdate(e) {
                if (!currentUser) return;

                const fullName = document.getElementById('profileFullName').value.trim();
                const email = document.getElementById('profileEmail').value.trim();
                const username = document.getElementById('profileUsername').value.trim();

                try {
                    // Check if new username is taken by another user
                    const existingUser = this.users.find(u => u.username === username && u.id !== currentUser.id);
                    if (existingUser) {
                        throw new Error('Nome de usu√°rio j√° est√° em uso');
                    }

                    // Check if new email is taken by another user
                    const existingEmail = this.users.find(u => u.email === email && u.id !== currentUser.id);
                    if (existingEmail) {
                        throw new Error('Email j√° est√° cadastrado');
                    }

                    // Update user data
                    const userIndex = this.users.findIndex(u => u.id === currentUser.id);
                    if (userIndex !== -1) {
                        this.users[userIndex].fullName = fullName;
                        this.users[userIndex].email = email;
                        this.users[userIndex].username = username;
                        
                        // Update current user object
                        currentUser = this.users[userIndex];
                        
                        this.saveToStorage('transcs_users', this.users);
                        this.updateUserInterface();
                        this.loadProfileData();
                        
                        showNotification('‚úÖ Perfil atualizado com sucesso!', 'success');
                    }
                } catch (error) {
                    showNotification(error.message, 'error');
                }
            }

            handlePasswordChange(e) {
                if (!currentUser) return;

                const currentPassword = document.getElementById('currentPassword').value;
                const newPassword = document.getElementById('newPassword').value;
                const confirmNewPassword = document.getElementById('confirmNewPassword').value;

                try {
                    // Verify current password
                    if (currentUser.password !== currentPassword) {
                        throw new Error('Senha atual incorreta');
                    }

                    // Validate new password
                    if (newPassword.length < 4) {
                        throw new Error('A nova senha deve ter pelo menos 4 caracteres');
                    }

                    if (newPassword !== confirmNewPassword) {
                        throw new Error('A confirma√ß√£o da nova senha n√£o confere');
                    }

                    if (newPassword === currentPassword) {
                        throw new Error('A nova senha deve ser diferente da atual');
                    }

                    // Update password
                    const userIndex = this.users.findIndex(u => u.id === currentUser.id);
                    if (userIndex !== -1) {
                        this.users[userIndex].password = newPassword;
                        currentUser = this.users[userIndex];
                        
                        this.saveToStorage('transcs_users', this.users);
                        
                        // Clear form
                        document.getElementById('passwordForm').reset();
                        
                        showNotification('üîê Senha alterada com sucesso!', 'success');
                    }
                } catch (error) {
                    showNotification(error.message, 'error');
                }
            }

            createSession(user, remember = false) {
                const expiresAt = new Date();
                expiresAt.setDate(expiresAt.getDate() + (remember ? 30 : 1)); // 30 days if remember, 1 day otherwise

                const sessionData = {
                    userId: user.id,
                    username: user.username,
                    role: user.role,
                    expiresAt: expiresAt.toISOString()
                };

                localStorage.setItem('transcs_session', JSON.stringify(sessionData));
            }

            loginUser(user) {
                currentUser = user;
                this.showApp();
            }

            showLoginScreen() {
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('app').classList.remove('active');
            }

            showApp() {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('app').classList.add('active');
                
                this.updateUserInterface();
                this.applyRolePermissions();
                this.loadProfileData();
                initializeCharts();
            }

            updateUserInterface() {
                if (!currentUser) return;
                
                // Update user name and avatar
                document.getElementById('userName').textContent = currentUser.fullName;
                document.getElementById('userRole').textContent = currentUser.role === 'admin' ? 'Administrador' : 'Usu√°rio';
                document.getElementById('userAvatar').textContent = currentUser.fullName.charAt(0).toUpperCase();
                document.getElementById('dashboardUserRole').textContent = currentUser.role === 'admin' ? 'administrador' : 'usu√°rio';
            }

            applyRolePermissions() {
                if (!currentUser) return;
                
                const isAdmin = currentUser.role === 'admin';
                
                // Show/hide financial tab
                const financialTab = document.getElementById('financialTab');
                if (financialTab) {
                    financialTab.style.display = isAdmin ? 'flex' : 'none';
                }
                
                // Show/hide user management button
                const manageUsersBtn = document.getElementById('manageUsersBtn');
                if (manageUsersBtn) {
                    manageUsersBtn.style.display = isAdmin ? 'block' : 'none';
                }
                
                // Hide financial stats for regular users
                if (!isAdmin) {
                    const financialStats = document.querySelectorAll('#totalRevenue, #totalProfit, #avgMargin');
                    financialStats.forEach(stat => {
                        const card = stat.closest('.stat-card');
                        if (card) card.style.display = 'none';
                    });
                }
            }

            loadProfileData() {
                if (!currentUser) return;
                
                // Load profile form data
                document.getElementById('profileFullName').value = currentUser.fullName;
                document.getElementById('profileEmail').value = currentUser.email;
                document.getElementById('profileUsername').value = currentUser.username;
                document.getElementById('profileRole').value = currentUser.role === 'admin' ? 'Administrador' : 'Usu√°rio';
                
                // Load profile display data
                document.getElementById('profileAvatarDisplay').textContent = currentUser.fullName.charAt(0).toUpperCase();
                document.getElementById('profileDisplayName').textContent = currentUser.fullName;
                document.getElementById('profileDisplayUsername').textContent = '@' + currentUser.username;
                document.getElementById('profileDisplayRole').textContent = currentUser.role === 'admin' ? 'Administrador' : 'Usu√°rio';
                document.getElementById('profileDisplayCreated').textContent = new Date(currentUser.createdAt).toLocaleDateString('pt-BR');
                document.getElementById('profileDisplayLastLogin').textContent = currentUser.lastLogin ? 
                    new Date(currentUser.lastLogin).toLocaleString('pt-BR') : 'Primeiro acesso';
            }

            generateInviteLink(role) {
                const code = 'INV-' + Math.random().toString(36).substr(2, 8).toUpperCase();
                const expiresAt = new Date();
                expiresAt.setDate(expiresAt.getDate() + 7); // Expires in 7 days
                
                this.invites[code] = {
                    role: role,
                    createdBy: currentUser.id,
                    createdAt: new Date().toISOString(),
                    expiresAt: expiresAt.toISOString()
                };
                
                this.saveToStorage('transcs_invites', this.invites);
                
                const link = `${window.location.origin}${window.location.pathname}?invite=${code}&role=${role}`;
                return link;
            }

            getUsersList() {
                return this.users.map(user => ({
                    ...user,
                    password: undefined // Don't expose passwords
                }));
            }

            toggleUserStatus(userId) {
                const userIndex = this.users.findIndex(u => u.id === userId);
                if (userIndex !== -1 && this.users[userIndex].id !== currentUser.id) {
                    this.users[userIndex].status = this.users[userIndex].status === 'active' ? 'blocked' : 'active';
                    this.saveToStorage('transcs_users', this.users);
                    return true;
                }
                return false;
            }

            deleteUser(userId) {
                if (userId === currentUser.id) return false; // Can't delete yourself
                
                const userIndex = this.users.findIndex(u => u.id === userId);
                if (userIndex !== -1) {
                    this.users.splice(userIndex, 1);
                    this.saveToStorage('transcs_users', this.users);
                    return true;
                }
                return false;
            }

            logout() {
                localStorage.removeItem('transcs_session');
                currentUser = null;
                showNotification('üëã Sess√£o encerrada com sucesso!', 'success');
                setTimeout(() => {
                    window.location.reload();
                }, 1500);
            }

            loadFromStorage(key, defaultValue) {
                try {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : defaultValue;
                } catch (error) {
                    console.error(`Error loading ${key}:`, error);
                    return defaultValue;
                }
            }

            saveToStorage(key, data) {
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                } catch (error) {
                    console.error(`Error saving ${key}:`, error);
                }
            }
        }

        // ==================== INITIALIZATION ====================
        function init() {
            console.log('üöÄ Inicializando TransCS Pro Ultimate v5.1...');
            
            // Initialize authentication system
            authSystem = new AuthenticationSystem();
            
            // Setup time updates
            updateTime();
            setInterval(updateTime, 1000);
            
            // Load saved theme
            loadSavedTheme();
            
            console.log('‚úÖ Sistema inicializado com sucesso!');
        }

        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('pt-BR');
            const timeElement = document.getElementById('currentTime');
            if (timeElement) {
                timeElement.textContent = timeString;
            }
        }

        function loadSavedTheme() {
            const savedTheme = localStorage.getItem('transcs_theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                document.getElementById('themeIcon').className = 'fas fa-sun';
                const themeSelect = document.getElementById('themeSelect');
                if (themeSelect) themeSelect.value = 'dark';
            }
        }

        // ==================== UI FUNCTIONS ====================
        function switchToLogin() {
            document.querySelector('.auth-toggle button:first-child').classList.add('active');
            document.querySelector('.auth-toggle button:last-child').classList.remove('active');
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
        }

        function switchToRegister() {
            document.querySelector('.auth-toggle button:first-child').classList.remove('active');
            document.querySelector('.auth-toggle button:last-child').classList.add('active');
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
        }

        function selectUserType(role) {
            document.querySelectorAll('.user-type-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            document.querySelector(`[data-role="${role}"]`).classList.add('selected');
            document.getElementById('selectedUserType').value = role;
        }

        function togglePasswordVisibility(inputId) {
            const input = document.getElementById(inputId);
            const button = input.nextElementSibling;
            const icon = button.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.className = 'fas fa-eye-slash';
            } else {
                input.type = 'password';
                icon.className = 'fas fa-eye';
            }
        }

        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Remove active from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Add active to clicked button
            event.target.classList.add('active');
        }

        function showTab(tabId, button) {
            // Get parent container
            const container = button.closest('.tab-container');
            
            // Hide all tab contents in this container
            container.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active from all tab buttons in this container
            container.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabId).classList.add('active');
            button.classList.add('active');
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const icon = document.getElementById('themeIcon');
            const isDark = document.body.classList.contains('dark-mode');
            
            icon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
            localStorage.setItem('transcs_theme', isDark ? 'dark' : 'light');
            
            const themeSelect = document.getElementById('themeSelect');
            if (themeSelect) {
                themeSelect.value = isDark ? 'dark' : 'light';
            }
        }

        function changeTheme(theme) {
            const isDark = theme === 'dark';
            document.body.classList.toggle('dark-mode', isDark);
            document.getElementById('themeIcon').className = isDark ? 'fas fa-sun' : 'fas fa-moon';
            localStorage.setItem('transcs_theme', theme);
        }

        // ==================== USER MANAGEMENT ====================
        function openUserManagement() {
            if (!currentUser || currentUser.role !== 'admin') {
                showNotification('‚ùå Acesso negado. Apenas administradores podem gerenciar usu√°rios.', 'error');
                return;
            }
            
            updateUsersModal();
            document.getElementById('userManagementModal').classList.add('show');
        }

        function closeUserManagement() {
            document.getElementById('userManagementModal').classList.remove('show');
        }

        function updateUsersModal() {
            const users = authSystem.getUsersList();
            const totalUsers = users.length;
            const activeUsers = users.filter(u => u.status === 'active').length;
            const adminUsers = users.filter(u => u.role === 'admin').length;
            
            document.getElementById('totalUsersCount').textContent = totalUsers;
            document.getElementById('activeUsersCount').textContent = activeUsers;
            document.getElementById('adminUsersCount').textContent = adminUsers;
            
            updateUsersList(users);
        }

        function updateUsersList(users = null) {
            if (!users) {
                users = authSystem.getUsersList();
            }
            
            const container = document.getElementById('usersList');
            
            if (users.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <h3>Nenhum usu√°rio encontrado</h3>
                        <p>Gere um link de convite para adicionar novos usu√°rios</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = users.map(user => {
                const isCurrentUser = user.id === currentUser.id;
                const avatarLetter = user.fullName.charAt(0).toUpperCase();
                const statusClass = user.status === 'active' ? 'status-active' : 'status-blocked';
                const statusText = user.status === 'active' ? 'Ativo' : 'Bloqueado';
                const roleIcon = user.role === 'admin' ? 'üëë' : 'üë§';
                const roleText = user.role === 'admin' ? 'Administrador' : 'Usu√°rio';
                
                return `
                    <div class="user-card">
                        <div class="user-info">
                            <div class="user-avatar">${avatarLetter}</div>
                            <div>
                                <div style="font-weight: 600; margin-bottom: 0.25rem;">
                                    ${user.fullName} ${isCurrentUser ? '(Voc√™)' : ''}
                                </div>
                                <div style="color: var(--gray); font-size: 0.9rem;">
                                    ${roleIcon} ${roleText} | ${user.email}
                                </div>
                                <div style="color: var(--gray); font-size: 0.8rem;">
                                    Criado em: ${new Date(user.createdAt).toLocaleDateString('pt-BR')}
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="status-badge ${statusClass}">${statusText}</span>
                            ${!isCurrentUser ? `
                                <button class="btn btn-sm btn-outline" onclick="toggleUserStatus(${user.id})">
                                    <i class="fas fa-${user.status === 'active' ? 'ban' : 'check'}"></i>
                                    ${user.status === 'active' ? 'Bloquear' : 'Ativar'}
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="deleteUserConfirm(${user.id})">
                                    <i class="fas fa-trash"></i> Excluir
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function generateInviteLink() {
            const role = document.getElementById('inviteUserType').value;
            const link = authSystem.generateInviteLink(role);
            
            document.getElementById('inviteLink').value = link;
            document.getElementById('inviteLinkContainer').style.display = 'block';
            
            showNotification('üîó Link de convite gerado com sucesso!', 'success');
        }

        function copyInviteLink() {
            const input = document.getElementById('inviteLink');
            input.select();
            navigator.clipboard.writeText(input.value).then(() => {
                showNotification('üìã Link copiado para a √°rea de transfer√™ncia!', 'success');
            });
        }

        function toggleUserStatus(userId) {
            if (authSystem.toggleUserStatus(userId)) {
                updateUsersModal();
                showNotification('‚úÖ Status do usu√°rio alterado com sucesso!', 'success');
            } else {
                showNotification('‚ùå Erro ao alterar status do usu√°rio.', 'error');
            }
        }

        function deleteUserConfirm(userId) {
            const user = authSystem.users.find(u => u.id === userId);
            if (user && confirm(`Tem certeza que deseja excluir o usu√°rio "${user.fullName}"? Esta a√ß√£o n√£o pode ser desfeita.`)) {
                if (authSystem.deleteUser(userId)) {
                    updateUsersModal();
                    showNotification('‚úÖ Usu√°rio exclu√≠do com sucesso!', 'success');
                } else {
                    showNotification('‚ùå Erro ao excluir usu√°rio.', 'error');
                }
            }
        }

        function filterUsers() {
            const role = document.getElementById('userFilterRole').value;
            const allUsers = authSystem.getUsersList();
            const filteredUsers = role ? allUsers.filter(u => u.role === role) : allUsers;
            updateUsersList(filteredUsers);
        }

        // ==================== UTILITY FUNCTIONS ====================
        function logout() {
            if (confirm('Deseja realmente sair do sistema?')) {
                authSystem.logout();
            }
        }

        function refreshDashboard() {
            showNotification('üîÑ Dashboard atualizado!', 'info');
        }

        function clearAllUserData() {
            if (confirm('‚ö†Ô∏è ATEN√á√ÉO: Esta a√ß√£o ir√° apagar todos os SEUS dados (clientes, viagens, etc.). Os dados de outros usu√°rios n√£o ser√£o afetados. Continuar?')) {
                if (confirm('üö® CONFIRMA√á√ÉO FINAL: Todos os seus dados ser√£o perdidos permanentemente. Continuar?')) {
                    // In a real app, this would clear only the current user's data
                    showNotification('üóëÔ∏è Seus dados foram limpos!', 'warning');
                }
            }
        }

        function exportUserBackup() {
            const backup = {
                version: '5.1',
                exportDate: new Date().toISOString(),
                user: {
                    id: currentUser.id,
                    username: currentUser.username,
                    email: currentUser.email,
                    fullName: currentUser.fullName,
                    role: currentUser.role,
                    createdAt: currentUser.createdAt
                },
                // In a real app, this would include the user's actual data
                data: {
                    clients: [],
                    suppliers: [],
                    trips: [],
                    expenses: []
                }
            };
            
            const dataStr = JSON.stringify(backup, null, 2);
            
            // Create downloadable file
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `transcs-backup-${currentUser.username}-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('üì¶ Backup dos seus dados criado!', 'success');
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const text = document.getElementById('notificationText');
            const icon = notification.querySelector('.notification-icon');
            
            text.textContent = message;
            notification.className = `notification ${type}`;
            
            // Update icon based on type
            switch(type) {
                case 'success':
                    icon.className = 'notification-icon fas fa-check-circle';
                    break;
                case 'error':
                    icon.className = 'notification-icon fas fa-exclamation-circle';
                    break;
                case 'warning':
                    icon.className = 'notification-icon fas fa-exclamation-triangle';
                    break;
                case 'info':
                    icon.className = 'notification-icon fas fa-info-circle';
                    break;
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // ==================== CHARTS INITIALIZATION ====================
        function initializeCharts() {
            // Revenue Chart
            const revenueCtx = document.getElementById('revenueChart');
            if (revenueCtx && !charts.revenue) {
                charts.revenue = new Chart(revenueCtx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'],
                        datasets: [{
                            label: 'Receita (R$)',
                            data: [12000, 15000, 18000, 16000, 22000, 25000],
                            borderColor: '#2563eb',
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return 'R$ ' + value.toLocaleString();
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Client Chart
            const clientCtx = document.getElementById('clientChart');
            if (clientCtx && !charts.client) {
                charts.client = new Chart(clientCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Cliente A', 'Cliente B', 'Cliente C', 'Outros'],
                        datasets: [{
                            data: [35, 25, 20, 20],
                            backgroundColor: [
                                '#2563eb',
                                '#10b981',
                                '#8b5cf6',
                                '#f59e0b'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
        }

        // ==================== DEMO FUNCTIONS ====================
        function updateStats() {
            // Update dashboard stats with demo data
            document.getElementById('totalRevenue').textContent = 'R$ 125.500,00';
            document.getElementById('totalProfit').textContent = 'R$ 42.750,00';
            document.getElementById('avgMargin').textContent = '34.1%';
            document.getElementById('totalTrips').textContent = '47';
            document.getElementById('totalKm').textContent = '15.850 km';
            document.getElementById('totalClients').textContent = '12';
            document.getElementById('avgPerKm').textContent = 'R$ 7,92/km';
            document.getElementById('topClient').textContent = 'Empresa ABC';
            
            // Update header stats
            document.getElementById('headerClients').textContent = '12';
            document.getElementById('headerTrips').textContent = '47';
            document.getElementById('headerRevenue').textContent = 'R$ 125k';
            
            // Update changes
            document.getElementById('revenueChange').textContent = '+18%';
            document.getElementById('profitChange').textContent = '+22%';
            document.getElementById('marginChange').textContent = 'Crescendo';
            document.getElementById('tripsChange').textContent = '12';
        }

        // ==================== CLICK OUTSIDE TO CLOSE MODAL ====================
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('userManagementModal');
            if (event.target === modal) {
                closeUserManagement();
            }
        });

        // ==================== KEYBOARD SHORTCUTS ====================
        document.addEventListener('keydown', function(event) {
            // ESC to close modals
            if (event.key === 'Escape') {
                closeUserManagement();
            }
            
            // Ctrl+U to open user management (admin only)
            if (event.ctrlKey && event.key === 'u' && currentUser && currentUser.role === 'admin') {
                event.preventDefault();
                openUserManagement();
            }
        });

        // ==================== FORM VALIDATION HELPERS ====================
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        function validateUsername(username) {
            // Username must be 3-20 characters, alphanumeric plus underscore
            const re = /^[a-zA-Z0-9_]{3,20}$/;
            return re.test(username);
        }

        function validatePassword(password) {
            // Minimum 4 characters for now (in production, make it stronger)
            return password.length >= 4;
        }

        // Add real-time validation to forms
        document.addEventListener('DOMContentLoaded', function() {
            // Email validation
            const emailInputs = document.querySelectorAll('input[type="email"]');
            emailInputs.forEach(input => {
                input.addEventListener('blur', function() {
                    if (this.value && !validateEmail(this.value)) {
                        this.style.borderColor = 'var(--danger)';
                        this.title = 'Email inv√°lido';
                    } else {
                        this.style.borderColor = '';
                        this.title = '';
                    }
                });
            });
            
            // Username validation
            const usernameInputs = document.querySelectorAll('#registerUsername, #profileUsername');
            usernameInputs.forEach(input => {
                input.addEventListener('input', function() {
                    if (this.value && !validateUsername(this.value)) {
                        this.style.borderColor = 'var(--danger)';
                        this.title = 'Nome de usu√°rio deve ter 3-20 caracteres (letras, n√∫meros e _)';
                    } else {
                        this.style.borderColor = '';
                        this.title = '';
                    }
                });
            });
            
            // Password strength indicator
            const passwordInputs = document.querySelectorAll('#registerPassword, #newPassword');
            passwordInputs.forEach(input => {
                input.addEventListener('input', function() {
                    const strength = getPasswordStrength(this.value);
                    if (this.value.length > 0) {
                        this.style.borderColor = strength.color;
                        this.title = strength.message;
                    } else {
                        this.style.borderColor = '';
                        this.title = '';
                    }
                });
            });
            
            // Confirm password validation
            const confirmInputs = document.querySelectorAll('#confirmPassword, #confirmNewPassword');
            confirmInputs.forEach(input => {
                input.addEventListener('input', function() {
                    const mainPassword = this.id === 'confirmPassword' ? 
                        document.getElementById('registerPassword').value : 
                        document.getElementById('newPassword').value;
                    
                    if (this.value && this.value !== mainPassword) {
                        this.style.borderColor = 'var(--danger)';
                        this.title = 'Senhas n√£o coincidem';
                    } else if (this.value && this.value === mainPassword) {
                        this.style.borderColor = 'var(--success)';
                        this.title = 'Senhas coincidem';
                    } else {
                        this.style.borderColor = '';
                        this.title = '';
                    }
                });
            });
        });

        function getPasswordStrength(password) {
            if (password.length < 4) {
                return { color: 'var(--danger)', message: 'Senha muito fraca (min. 4 caracteres)' };
            } else if (password.length < 6) {
                return { color: 'var(--warning)', message: 'Senha fraca' };
            } else if (password.length < 8) {
                return { color: 'var(--info)', message: 'Senha m√©dia' };
            } else {
                return { color: 'var(--success)', message: 'Senha forte' };
            }
        }

        // ==================== AUTO-SAVE FUNCTIONALITY ====================
        let autoSaveTimer = null;

        function scheduleAutoSave() {
            if (autoSaveTimer) {
                clearTimeout(autoSaveTimer);
            }
            
            autoSaveTimer = setTimeout(() => {
                if (currentUser) {
                    // In a real app, this would save user data
                    console.log('Auto-save triggered for user:', currentUser.username);
                }
            }, 30000); // Auto-save every 30 seconds
        }

        // ==================== LOADING STATES ====================
        function showLoading(element, text = 'Carregando...') {
            const originalContent = element.innerHTML;
            element.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${text}`;
            element.disabled = true;
            
            return () => {
                element.innerHTML = originalContent;
                element.disabled = false;
            };
        }

        // ==================== RESPONSIVE MENU ====================
        function toggleMobileMenu() {
            const nav = document.querySelector('.nav-tabs');
            nav.classList.toggle('mobile-open');
        }

        // Add mobile menu styles
        const mobileStyles = `
            @media (max-width: 768px) {
                .nav-tabs.mobile-open {
                    position: absolute;
                    top: 100%;
                    left: 0;
                    right: 0;
                    background: var(--dark);
                    flex-direction: column;
                    box-shadow: var(--shadow-lg);
                    z-index: 100;
                }
                
                .nav-tabs.mobile-open .nav-btn {
                    min-width: auto;
                    justify-content: flex-start;
                    padding: 1rem 2rem;
                }
                
                .mobile-menu-toggle {
                    display: block;
                    background: none;
                    border: none;
                    color: var(--white);
                    font-size: 1.5rem;
                    cursor: pointer;
                    padding: 0.5rem;
                }
            }
            
            .mobile-menu-toggle {
                display: none;
            }
        `;

        // Inject mobile styles
        const styleSheet = document.createElement('style');
        styleSheet.textContent = mobileStyles;
        document.head.appendChild(styleSheet);

        // ==================== PERFORMANCE MONITORING ====================
        function trackPageLoad() {
            window.addEventListener('load', function() {
                const loadTime = performance.now();
                console.log(`üöÄ TransCS Pro Ultimate v5.1 loaded in ${loadTime.toFixed(2)}ms`);
            });
        }

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize the system
            init();
            
            // Update stats with demo data
            updateStats();
            
            // Track performance
            trackPageLoad();
            
            // Schedule auto-save
            scheduleAutoSave();
            
            console.log('üéâ TransCS Pro Ultimate v5.1 - Sistema com Autentica√ß√£o Completa pronto!');
            console.log('üìã Recursos dispon√≠veis:');
            console.log('   ‚Ä¢ ‚úÖ Sistema de autentica√ß√£o completo');
            console.log('   ‚Ä¢ ‚úÖ Controle de acesso por n√≠veis (admin/user)');
            console.log('   ‚Ä¢ ‚úÖ Edi√ß√£o de perfil e senha');
            console.log('   ‚Ä¢ ‚úÖ Sistema de convites');
            console.log('   ‚Ä¢ ‚úÖ Dados isolados por usu√°rio');
            console.log('   ‚Ä¢ ‚úÖ Interface responsiva');
            console.log('   ‚Ä¢ ‚úÖ Tema escuro/claro');
            console.log('   ‚Ä¢ ‚úÖ Notifica√ß√µes em tempo real');
            console.log('');
            console.log('üîê Para testar:');
            console.log('   üëë Admin: admin / admin123');
            console.log('   üë§ Ou crie uma nova conta');
        });
    </script>
</body>
</html>
