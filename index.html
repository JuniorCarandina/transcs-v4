<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TransCS - Sistema de Fretes</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f0f2f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; min-height: 100vh; }
        .header { background: #1e3a8a; color: white; padding: 20px; text-align: center; }
        .header h1 { font-size: 2rem; }
        .tabs { display: flex; background: #1e40af; }
        .tab { flex: 1; padding: 15px; background: #1e40af; color: white; border: none; cursor: pointer; }
        .tab.active { background: #3b82f6; }
        .content { padding: 20px; }
        .hidden { display: none; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 20px 0; }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { margin-bottom: 5px; font-weight: bold; }
        .form-group input, select { padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
        .btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        .btn-primary { background: #3b82f6; color: white; }
        .btn-success { background: #10b981; color: white; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .stat-card { background: #f8fafc; padding: 20px; border-radius: 10px; text-align: center; }
        .stat-value { font-size: 1.5rem; font-weight: bold; color: #1e40af; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { padding: 10px; border: 1px solid #ddd; text-align: left; }
        th { background: #f0f9ff; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸš› TransCS</h1>
            <p>Sistema de Gerenciamento de Fretes</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('dashboard')">Dashboard</button>
            <button class="tab" onclick="showTab('cadastro')">Cadastro</button>
            <button class="tab" onclick="showTab('relatorios')">RelatÃ³rios</button>
        </div>
        
        <div class="content">
            <div id="dashboard">
                <h2>ðŸ“Š Dashboard</h2>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value" id="totalReceita">R$ 0,00</div>
                        <div>Receita Total</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalLucro">R$ 0,00</div>
                        <div>Lucro Total</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalViagens">0</div>
                        <div>Total Viagens</div>
                    </div>
                </div>
                <canvas id="grafico" width="400" height="200"></canvas>
            </div>
            
            <div id="cadastro" class="hidden">
                <h2>âž• Nova Viagem</h2>
                <form id="formViagem">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Cliente:</label>
                            <input type="text" id="cliente" required>
                        </div>
                        <div class="form-group">
                            <label>Data:</label>
                            <input type="date" id="data" required>
                        </div>
                        <div class="form-group">
                            <label>KM:</label>
                            <input type="number" id="km" required>
                        </div>
                        <div class="form-group">
                            <label>Receita (R$):</label>
                            <input type="number" step="0.01" id="receita" required>
                        </div>
                        <div class="form-group">
                            <label>Custo Total (R$):</label>
                            <input type="number" step="0.01" id="custo" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Salvar Viagem</button>
                </form>
            </div>
            
            <div id="relatorios" class="hidden">
                <h2>ðŸ“‹ RelatÃ³rios</h2>
                <button onclick="exportarCSV()" class="btn btn-success">Exportar CSV</button>
                <table>
                    <thead>
                        <tr>
                            <th>Cliente</th>
                            <th>Data</th>
                            <th>KM</th>
                            <th>Receita</th>
                            <th>Lucro</th>
                        </tr>
                    </thead>
                    <tbody id="tabela">
                        <tr><td colspan="5" style="text-align: center;">Nenhuma viagem cadastrada</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let viagens = JSON.parse(localStorage.getItem('viagens') || '[]');
        let chart = null;

        function showTab(tab) {
            document.querySelectorAll('.content > div').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
            document.getElementById(tab).classList.remove('hidden');
            event.target.classList.add('active');
        }

        document.getElementById('formViagem').addEventListener('submit', function(e) {
            e.preventDefault();
            const viagem = {
                id: Date.now(),
                cliente: document.getElementById('cliente').value,
                data: document.getElementById('data').value,
                km: parseFloat(document.getElementById('km').value),
                receita: parseFloat(document.getElementById('receita').value),
                custo: parseFloat(document.getElementById('custo').value)
            };
            viagem.lucro = viagem.receita - viagem.custo;
            viagens.push(viagem);
            localStorage.setItem('viagens', JSON.stringify(viagens));
            this.reset();
            document.getElementById('data').value = new Date().toISOString().split('T')[0];
            atualizarDados();
            alert('Viagem salva!');
        });

        function atualizarDados() {
            const totalReceita = viagens.reduce((sum, v) => sum + v.receita, 0);
            const totalLucro = viagens.reduce((sum, v) => sum + v.lucro, 0);
            
            document.getElementById('totalReceita').textContent = `R$ ${totalReceita.toFixed(2)}`;
            document.getElementById('totalLucro').textContent = `R$ ${totalLucro.toFixed(2)}`;
            document.getElementById('totalViagens').textContent = viagens.length;

            const tabela = document.getElementById('tabela');
            if (viagens.length === 0) {
                tabela.innerHTML = '<tr><td colspan="5" style="text-align: center;">Nenhuma viagem cadastrada</td></tr>';
            } else {
                tabela.innerHTML = viagens.map(v => `
                    <tr>
                        <td>${v.cliente}</td>
                        <td>${new Date(v.data).toLocaleDateString('pt-BR')}</td>
                        <td>${v.km}</td>
                        <td>R$ ${v.receita.toFixed(2)}</td>
                        <td>R$ ${v.lucro.toFixed(2)}</td>
                    </tr>
                `).join('');
            }

            atualizarGrafico();
        }

        function atualizarGrafico() {
            const ctx = document.getElementById('grafico').getContext('2d');
            const dados = {};
            viagens.forEach(v => {
                const mes = v.data.substring(0, 7);
                dados[mes] = (dados[mes] || 0) + v.lucro;
            });

            if (chart) chart.destroy();
            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(dados),
                    datasets: [{
                        label: 'Lucro Mensal',
                        data: Object.values(dados),
                        backgroundColor: '#3b82f6'
                    }]
                }
            });
        }

        function exportarCSV() {
            if (viagens.length === 0) return alert('Nenhum dado para exportar');
            const csv = 'Cliente,Data,KM,Receita,Custo,Lucro\n' + 
                viagens.map(v => `${v.cliente},${v.data},${v.km},${v.receita},${v.custo},${v.lucro}`).join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'relatorio.csv';
            a.click();
        }

        // Inicializar
        document.getElementById('data').value = new Date().toISOString().split('T')[0];
        atualizarDados();
    </script>
</body>
</html>
