<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TransCS Pro Ultimate v5.0 - Sistema Completo</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.min.js"></script>
    
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --primary-light: #60a5fa;
            --secondary: #10b981;
            --accent: #8b5cf6;
            --warning: #f59e0b;
            --danger: #ef4444;
            --success: #10b981;
            --info: #06b6d4;
            --dark: #1f2937;
            --gray: #6b7280;
            --gray-light: #f3f4f6;
            --gray-dark: #374151;
            --white: #ffffff;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark);
            line-height: 1.6;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--white);
            min-height: 100vh;
            box-shadow: var(--shadow-xl);
            position: relative;
        }

        .dark-mode .container {
            background: var(--dark);
            color: var(--white);
        }

        /* LOGIN SCREEN */
        .login-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 2rem;
        }

        .login-box {
            background: rgba(255, 255, 255, 0.95);
            padding: 3rem;
            border-radius: 20px;
            width: 100%;
            max-width: 450px;
            box-shadow: var(--shadow-xl);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .login-box::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(37, 99, 235, 0.1) 0%, transparent 70%);
            animation: loginPulse 4s ease-in-out infinite;
        }

        @keyframes loginPulse {
            0%, 100% { transform: rotate(0deg) scale(1); opacity: 0.3; }
            50% { transform: rotate(180deg) scale(1.1); opacity: 0.1; }
        }

        .login-content {
            position: relative;
            z-index: 2;
        }

        .login-logo {
            margin-bottom: 2rem;
        }

        .login-logo i {
            font-size: 4rem;
            color: var(--primary);
            margin-bottom: 1rem;
            display: block;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .login-logo h1 {
            font-size: 2rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .login-logo .version {
            background: var(--accent);
            color: var(--white);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 0.5rem;
            display: inline-block;
        }

        .form-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .form-label {
            display: block;
            margin-bottom: 0.75rem;
            font-weight: 600;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 2px solid var(--gray-light);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            background: var(--white);
            font-family: inherit;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
            transform: translateY(-1px);
        }

        .btn {
            padding: 1rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            text-decoration: none;
            white-space: nowrap;
            font-family: inherit;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s;
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--white);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
            width: 100%;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(37, 99, 235, 0.5);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary), #059669);
            color: var(--white);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }

        .btn-secondary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.5);
        }

        .btn-accent {
            background: linear-gradient(135deg, var(--accent), #7c3aed);
            color: var(--white);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
        }

        .btn-accent:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.5);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            box-shadow: none;
        }

        .btn-outline:hover:not(:disabled) {
            background: var(--primary);
            color: var(--white);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            color: var(--white);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }

        .btn-danger:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.5);
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            width: auto;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .info-box {
            background: linear-gradient(135deg, #e0f2fe 0%, #b3e5fc 100%);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin-top: 1.5rem;
            font-size: 0.9rem;
            color: var(--dark);
            border: 1px solid rgba(6, 182, 212, 0.2);
        }

        /* APP CONTAINER */
        .app {
            display: none;
        }

        .app.active {
            display: block;
        }

        /* HEADER */
        .header {
            background: linear-gradient(135deg, var(--dark) 0%, var(--gray-dark) 100%);
            color: var(--white);
            padding: 2rem;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: headerPulse 6s ease-in-out infinite;
        }

        @keyframes headerPulse {
            0%, 100% { transform: scale(1) rotate(0deg); opacity: 0.3; }
            50% { transform: scale(1.1) rotate(180deg); opacity: 0.1; }
        }

        .header-content {
            position: relative;
            z-index: 2;
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 2rem;
            align-items: center;
        }

        .header-left h1 {
            font-size: 2.5rem;
            font-weight: 900;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--primary-light), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-left .version-badge {
            font-size: 0.75rem;
            background: var(--accent);
            color: var(--white);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        .header-left p {
            opacity: 0.9;
            font-size: 1.1rem;
            font-weight: 500;
        }

        .header-stats {
            display: flex;
            gap: 2rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .quick-stat {
            text-align: center;
            min-width: 80px;
        }

        .quick-stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary-light);
            margin-bottom: 0.25rem;
        }

        .quick-stat-label {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .user-panel {
            background: rgba(255, 255, 255, 0.1);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: right;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-info {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-light), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: 700;
            font-size: 1.2rem;
        }

        .theme-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: var(--white);
            padding: 0.5rem;
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
            margin-left: 1rem;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* NAVIGATION */
        .nav {
            background: var(--dark);
            border-bottom: 3px solid var(--primary);
            position: sticky;
            top: 0;
            z-index: 90;
            box-shadow: var(--shadow);
        }

        .nav-tabs {
            display: flex;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .nav-tabs::-webkit-scrollbar {
            display: none;
        }

        .nav-btn {
            flex: 0 0 auto;
            min-width: 160px;
            padding: 1.25rem 2rem;
            background: transparent;
            border: none;
            color: var(--white);
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            white-space: nowrap;
            position: relative;
        }

        .nav-btn i {
            font-size: 1.1rem;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--white);
            box-shadow: var(--shadow);
        }

        .nav-btn.active::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-light), var(--secondary));
        }

        /* PAGES */
        .page {
            display: none;
            padding: 2rem;
            background: var(--gray-light);
            min-height: calc(100vh - 200px);
        }

        .dark-mode .page {
            background: var(--gray-dark);
        }

        .page.active {
            display: block;
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--primary);
        }

        .page-title {
            font-size: 2.25rem;
            font-weight: 800;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .dark-mode .page-title {
            color: var(--white);
        }

        .page-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        /* CARDS */
        .card {
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 0, 0, 0.05);
            overflow: hidden;
            transition: var(--transition);
            margin-bottom: 1.5rem;
        }

        .dark-mode .card {
            background: var(--dark);
            border-color: var(--gray-dark);
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--gray-light);
            background: linear-gradient(135deg, var(--white) 0%, #f8fafc 100%);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dark-mode .card-header {
            background: linear-gradient(135deg, var(--dark) 0%, var(--gray-dark) 100%);
            border-bottom-color: var(--gray-dark);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .dark-mode .card-title {
            color: var(--white);
        }

        .card-body {
            padding: 2rem;
        }

        /* STATS GRID */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--white) 0%, #f8fafc 100%);
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .dark-mode .stat-card {
            background: linear-gradient(135deg, var(--dark) 0%, var(--gray-dark) 100%);
            border-color: var(--gray-dark);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .stat-icon {
            width: 56px;
            height: 56px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            color: var(--white);
            box-shadow: var(--shadow);
        }

        .stat-icon.primary { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); }
        .stat-icon.secondary { background: linear-gradient(135deg, var(--secondary), #059669); }
        .stat-icon.accent { background: linear-gradient(135deg, var(--accent), #7c3aed); }
        .stat-icon.warning { background: linear-gradient(135deg, var(--warning), #d97706); }
        .stat-icon.danger { background: linear-gradient(135deg, var(--danger), #dc2626); }
        .stat-icon.info { background: linear-gradient(135deg, var(--info), #0891b2); }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--dark);
            margin-bottom: 0.5rem;
            line-height: 1;
        }

        .dark-mode .stat-value {
            color: var(--white);
        }

        .stat-label {
            color: var(--gray);
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 1rem;
        }

        .stat-change {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            margin-top: 0.75rem;
            padding: 0.5rem;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.02);
        }

        .stat-change.positive { 
            color: var(--success); 
            background: rgba(16, 185, 129, 0.1);
        }
        .stat-change.negative { 
            color: var(--danger); 
            background: rgba(239, 68, 68, 0.1);
        }
        .stat-change.neutral { 
            color: var(--gray); 
            background: rgba(107, 114, 128, 0.1);
        }

        /* FORM LAYOUTS */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-row-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        /* ITEMS LIST */
        .item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            background: var(--white);
            transition: var(--transition);
        }

        .dark-mode .item {
            background: var(--dark);
            border-color: var(--gray-dark);
        }

        .item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .item-info {
            flex: 1;
        }

        .item-name {
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--dark);
            font-size: 1.1rem;
        }

        .dark-mode .item-name {
            color: var(--white);
        }

        .item-details {
            color: var(--gray);
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .item-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* ALERTS */
        .alert {
            padding: 1.25rem 1.5rem;
            border-radius: var(--border-radius);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            border-left: 4px solid;
            box-shadow: var(--shadow);
        }

        .alert-success {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            color: #065f46;
            border-left-color: var(--success);
        }

        .alert-warning {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #92400e;
            border-left-color: var(--warning);
        }

        .alert-info {
            background: linear-gradient(135deg, #dbeafe 0%, #93c5fd 100%);
            color: #1e40af;
            border-left-color: var(--info);
        }

        .alert-danger {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: #991b1b;
            border-left-color: var(--danger);
        }

        .alert-icon {
            font-size: 1.25rem;
            margin-top: 0.125rem;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        /* CHARTS */
        .chart-container {
            position: relative;
            height: 300px;
            margin: 1rem 0;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        /* CALCULATORS */
        .calculator-card {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 1px solid rgba(6, 182, 212, 0.2);
            border-radius: var(--border-radius);
            padding: 2rem;
            margin-bottom: 1.5rem;
        }

        .calculator-result {
            background: var(--white);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            border: 2px solid var(--primary);
            margin-top: 1rem;
            text-align: center;
        }

        .result-value {
            font-size: 2rem;
            font-weight: 900;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .result-label {
            color: var(--gray);
            font-weight: 600;
        }

        /* NOTIFICATIONS */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            max-width: 400px;
            padding: 1.25rem 1.5rem;
            border-radius: var(--border-radius);
            color: var(--white);
            font-weight: 600;
            z-index: 1000;
            transform: translateX(450px);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            gap: 1rem;
            backdrop-filter: blur(10px);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success { 
            background: linear-gradient(135deg, var(--success), #059669);
        }
        .notification.error { 
            background: linear-gradient(135deg, var(--danger), #dc2626);
        }
        .notification.info { 
            background: linear-gradient(135deg, var(--info), #0891b2);
        }
        .notification.warning { 
            background: linear-gradient(135deg, var(--warning), #d97706);
        }

        .notification-icon {
            font-size: 1.25rem;
        }

        .notification-content {
            flex: 1;
        }

        /* EMPTY STATE */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            opacity: 0.3;
            display: block;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--gray-dark);
        }

        .dark-mode .empty-state h3 {
            color: var(--gray-light);
        }

        /* TABS */
        .tab-container {
            background: var(--white);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .dark-mode .tab-container {
            background: var(--dark);
        }

        .tab-nav {
            display: flex;
            background: var(--gray-light);
            border-bottom: 1px solid var(--gray-light);
        }

        .dark-mode .tab-nav {
            background: var(--gray-dark);
            border-bottom-color: var(--gray-dark);
        }

        .tab-btn {
            flex: 1;
            padding: 1rem 1.5rem;
            background: transparent;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: var(--gray);
            transition: var(--transition);
        }

        .tab-btn:hover {
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary);
        }

        .tab-btn.active {
            background: var(--white);
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }

        .dark-mode .tab-btn.active {
            background: var(--dark);
            color: var(--primary-light);
        }

        .tab-content {
            display: none;
            padding: 2rem;
        }

        .tab-content.active {
            display: block;
        }

        /* UTILITIES */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .text-left { text-align: left; }
        .font-bold { font-weight: 700; }
        .font-semibold { font-weight: 600; }
        .hidden { display: none !important; }
        .block { display: block !important; }
        .flex { display: flex !important; }
        .grid { display: grid !important; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-1 { gap: 0.25rem; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mt-4 { margin-top: 1rem; }
        .w-full { width: 100%; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* RESPONSIVE */
        @media (max-width: 1200px) {
            .header-content {
                grid-template-columns: 1fr auto;
                gap: 1.5rem;
            }

            .header-stats {
                display: none;
            }

            .chart-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .login-box {
                margin: 1rem;
                padding: 2rem;
                max-width: calc(100% - 2rem);
            }

            .header {
                padding: 1.5rem;
            }

            .header-content {
                grid-template-columns: 1fr;
                text-align: center;
                gap: 1rem;
            }

            .header-left h1 {
                font-size: 2rem;
                flex-direction: column;
                gap: 0.5rem;
            }

            .nav-tabs {
                overflow-x: auto;
                scrollbar-width: thin;
            }

            .nav-btn {
                min-width: 140px;
                font-size: 0.85rem;
                padding: 1rem 1.5rem;
            }

            .page {
                padding: 1rem;
            }

            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }

            .form-row, .form-row-2, .form-row-3 {
                grid-template-columns: 1fr;
            }

            .chart-grid {
                grid-template-columns: 1fr;
            }

            .item {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .item-actions {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 1rem;
            }

            .header-left h1 {
                font-size: 1.75rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .nav-btn {
                font-size: 0.8rem;
                padding: 0.875rem 1rem;
            }

            .btn {
                padding: 0.75rem 1.25rem;
                font-size: 0.9rem;
            }

            .btn-sm {
                padding: 0.5rem 0.75rem;
                font-size: 0.8rem;
            }

            .card-body {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- LOGIN SCREEN -->
    <div id="loginScreen" class="login-screen">
        <div class="login-box">
            <div class="login-content">
                <div class="login-logo">
                    <i class="fas fa-truck"></i>
                    <h1>TransCS Pro Ultimate</h1>
                    <div class="version">v5.0</div>
                    <p style="margin-top: 1rem; color: var(--gray);">Sistema Completo de Gestão de Fretes</p>
                </div>
                
                <form id="loginForm">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-user"></i> Usuário
                        </label>
                        <input type="text" class="form-input" id="username" value="admin" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-lock"></i> Senha
                        </label>
                        <input type="password" class="form-input" id="password" value="123" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-sign-in-alt"></i> Entrar no Sistema
                    </button>
                </form>
                
                <div class="info-box">
                    <div class="alert-title"><strong>🔑 Credenciais de Acesso:</strong></div>
                    <strong>Usuário:</strong> admin<br>
                    <strong>Senha:</strong> 123<br><br>
                    <em>Sistema com dashboard visual, calculadoras inteligentes e relatórios avançados!</em>
                </div>
            </div>
        </div>
    </div>

    <!-- NOTIFICATION -->
    <div id="notification" class="notification">
        <i class="notification-icon fas fa-check-circle"></i>
        <div class="notification-content">
            <span id="notificationText">Mensagem</span>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="app" class="container app">
        <!-- HEADER -->
        <div class="header">
            <div class="header-content">
                <div class="header-left">
                    <h1>
                        <i class="fas fa-truck"></i> 
                        TransCS Pro Ultimate
                        <span class="version-badge">v5.0</span>
                    </h1>
                    <p>Sistema Completo de Gestão de Fretes com Inteligência</p>
                </div>
                
                <div class="header-stats">
                    <div class="quick-stat">
                        <div class="quick-stat-value" id="headerClients">0</div>
                        <div class="quick-stat-label">Clientes</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-value" id="headerTrips">0</div>
                        <div class="quick-stat-label">Viagens</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-value" id="headerRevenue">R$ 0</div>
                        <div class="quick-stat-label">Receita</div>
                    </div>
                </div>

                <div class="user-panel">
                    <div class="user-info">
                        <div><strong>Admin</strong></div>
                        <div style="font-size: 0.85rem; opacity: 0.8;">Administrador</div>
                        <div style="font-size: 0.8rem; opacity: 0.7;" id="currentTime"></div>
                    </div>
                    <div class="user-avatar">A</div>
                    <button class="theme-toggle" onclick="toggleTheme()" title="Alternar tema">
                        <i class="fas fa-moon" id="themeIcon"></i>
                    </button>
                    <button class="btn btn-sm btn-danger" onclick="logout()" style="margin-left: 1rem;">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </div>
        </div>

        <!-- NAVIGATION -->
        <div class="nav">
            <div class="nav-tabs">
                <button class="nav-btn active" onclick="showPage('dashboard')">
                    <i class="fas fa-chart-line"></i> Dashboard
                </button>
                <button class="nav-btn" onclick="showPage('clients')">
                    <i class="fas fa-users"></i> Clientes
                </button>
                <button class="nav-btn" onclick="showPage('suppliers')">
                    <i class="fas fa-truck-loading"></i> Fornecedores
                </button>
                <button class="nav-btn" onclick="showPage('trips')">
                    <i class="fas fa-truck"></i> Viagens
                </button>
                <button class="nav-btn" onclick="showPage('calculators')">
                    <i class="fas fa-calculator"></i> Calculadoras
                </button>
                <button class="nav-btn" onclick="showPage('analytics')">
                    <i class="fas fa-chart-pie"></i> Analytics
                </button>
                <button class="nav-btn" onclick="showPage('financial')">
                    <i class="fas fa-dollar-sign"></i> Financeiro
                </button>
                <button class="nav-btn" onclick="showPage('reports')">
                    <i class="fas fa-file-alt"></i> Relatórios
                </button>
                <button class="nav-btn" onclick="showPage('settings')">
                    <i class="fas fa-cog"></i> Configurações
                </button>
            </div>
        </div>

        <!-- DASHBOARD PAGE -->
        <div id="dashboard" class="page active">
            <div class="page-header">
                <h2 class="page-title">
                    <i class="fas fa-chart-line"></i> Dashboard Executivo
                </h2>
                <div class="page-actions">
                    <button class="btn btn-secondary btn-sm" onclick="refreshDashboard()">
                        <i class="fas fa-sync-alt"></i> Atualizar
                    </button>
                    <button class="btn btn-primary btn-sm" onclick="showPage('trips')">
                        <i class="fas fa-plus"></i> Nova Viagem
                    </button>
                </div>
            </div>

            <div class="alert alert-success">
                <i class="alert-icon fas fa-rocket"></i>
                <div class="alert-content">
                    <div class="alert-title">🚀 TransCS Pro Ultimate v5.0 Ativo!</div>
                    Sistema completo com dashboard visual, calculadoras inteligentes, analytics avançados e interface moderna. Tudo funcionando perfeitamente!
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon primary">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="totalRevenue">R$ 0,00</div>
                    <div class="stat-label">Receita Total</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span id="revenueChange">+0%</span> vs mês anterior
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon secondary">
                            <i class="fas fa-chart-line"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="totalProfit">R$ 0,00</div>
                    <div class="stat-label">Lucro Total</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span id="profitChange">+0%</span> vs mês anterior
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon accent">
                            <i class="fas fa-percentage"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="avgMargin">0%</div>
                    <div class="stat-label">Margem Média</div>
                    <div class="stat-change neutral">
                        <span id="marginChange">Estável</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon info">
                            <i class="fas fa-truck"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="totalTrips">0</div>
                    <div class="stat-label">Total de Viagens</div>
                    <div class="stat-change positive">
                        <i class="fas fa-plus"></i>
                        <span id="tripsChange">0</span> este mês
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon warning">
                            <i class="fas fa-road"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="totalKm">0 km</div>
                    <div class="stat-label">KM Rodados</div>
                    <div class="stat-change neutral">
                        <span id="avgPerKm">R$ 0,00/km</span> média
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon danger">
                            <i class="fas fa-users"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="totalClients">0</div>
                    <div class="stat-label">Clientes Ativos</div>
                    <div class="stat-change neutral">
                        <span id="topClient">-</span> mais lucrativo
                    </div>
                </div>
            </div>

            <div class="chart-grid">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-chart-area"></i> Receita por Mês
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="revenueChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-chart-pie"></i> Lucro por Cliente
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="clientChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-rocket"></i> Ações Rápidas
                    </h3>
                </div>
                <div class="card-body">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <button class="btn btn-primary" onclick="showPage('clients')">
                            <i class="fas fa-user-plus"></i> Novo Cliente
                        </button>
                        <button class="btn btn-secondary" onclick="showPage('suppliers')">
                            <i class="fas fa-truck-loading"></i> Novo Fornecedor
                        </button>
                        <button class="btn btn-accent" onclick="showPage('trips')">
                            <i class="fas fa-plus"></i> Nova Viagem
                        </button>
                        <button class="btn btn-outline" onclick="showPage('calculators')">
                            <i class="fas fa-calculator"></i> Calculadoras
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- CLIENTS PAGE -->
        <div id="clients" class="page">
            <div class="page-header">
                <h2 class="page-title">
                    <i class="fas fa-users"></i> Gestão de Clientes
                </h2>
                <button class="btn btn-primary btn-sm" onclick="showClientForm()">
                    <i class="fas fa-plus"></i> Novo Cliente
                </button>
            </div>

            <div class="tab-container">
                <div class="tab-nav">
                    <button class="tab-btn active" onclick="showTab('client-form', this)">
                        <i class="fas fa-plus"></i> Cadastrar Cliente
                    </button>
                    <button class="tab-btn" onclick="showTab('client-list', this)">
                        <i class="fas fa-list"></i> Lista de Clientes
                    </button>
                </div>

                <div id="client-form" class="tab-content active">
                    <form id="clientForm">
                        <div class="alert alert-info">
                            <i class="alert-icon fas fa-info-circle"></i>
                            <div class="alert-content">
                                <div class="alert-title">Cadastro Completo de Cliente</div>
                                Preencha todas as informações para ter um controle detalhado dos seus clientes.
                            </div>
                        </div>

                        <h4 style="margin-bottom: 1rem; color: var(--primary); font-weight: 700;">🧾 Dados Gerais</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Razão Social *</label>
                                <input type="text" class="form-input" name="razaoSocial" placeholder="Razão social da empresa" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Nome Fantasia</label>
                                <input type="text" class="form-input" name="nomeFantasia" placeholder="Nome fantasia">
                            </div>
                            <div class="form-group">
                                <label class="form-label">CNPJ</label>
                                <input type="text" class="form-input" name="cnpj" placeholder="00.000.000/0000-00">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Tipo de Pessoa</label>
                                <select class="form-select" name="tipoPessoa">
                                    <option value="juridica">Pessoa Jurídica</option>
                                    <option value="fisica">Pessoa Física</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Inscrição Estadual</label>
                                <input type="text" class="form-input" name="inscricaoEstadual" placeholder="000.000.000.000">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Inscrição Municipal</label>
                                <input type="text" class="form-input" name="inscricaoMunicipal" placeholder="00000000">
                            </div>
                        </div>

                        <h4 style="margin: 2rem 0 1rem; color: var(--secondary); font-weight: 700;">📍 Endereço</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">CEP</label>
                                <input type="text" class="form-input" name="cep" placeholder="00000-000" onblur="buscarCEP(this.value)">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Rua/Avenida</label>
                                <input type="text" class="form-input" name="logradouro" placeholder="Endereço completo">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Número</label>
                                <input type="text" class="form-input" name="numero" placeholder="000">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Complemento</label>
                                <input type="text" class="form-input" name="complemento" placeholder="Apto, sala, etc.">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Bairro</label>
                                <input type="text" class="form-input" name="bairro" placeholder="Bairro">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Cidade</label>
                                <input type="text" class="form-input" name="cidade" placeholder="Cidade">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Estado (UF)</label>
                                <select class="form-select" name="estado">
                                    <option value="">Selecione...</option>
                                    <option value="SP">São Paulo</option>
                                    <option value="RJ">Rio de Janeiro</option>
                                    <option value="MG">Minas Gerais</option>
                                    <option value="RS">Rio Grande do Sul</option>
                                    <option value="PR">Paraná</option>
                                    <option value="SC">Santa Catarina</option>
                                    <option value="GO">Goiás</option>
                                    <option value="MT">Mato Grosso</option>
                                    <option value="MS">Mato Grosso do Sul</option>
                                    <option value="BA">Bahia</option>
                                    <option value="PE">Pernambuco</option>
                                    <option value="CE">Ceará</option>
                                    <option value="PA">Pará</option>
                                    <option value="AM">Amazonas</option>
                                    <option value="RO">Rondônia</option>
                                    <option value="AC">Acre</option>
                                    <option value="AP">Amapá</option>
                                    <option value="RR">Roraima</option>
                                    <option value="TO">Tocantins</option>
                                    <option value="MA">Maranhão</option>
                                    <option value="PI">Piauí</option>
                                    <option value="AL">Alagoas</option>
                                    <option value="SE">Sergipe</option>
                                    <option value="PB">Paraíba</option>
                                    <option value="RN">Rio Grande do Norte</option>
                                    <option value="ES">Espírito Santo</option>
                                    <option value="DF">Distrito Federal</option>
                                </select>
                            </div>
                        </div>

                        <h4 style="margin: 2rem 0 1rem; color: var(--info); font-weight: 700;">📞 Contato</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Telefone Fixo</label>
                                <input type="tel" class="form-input" name="telefoneFixo" placeholder="(11) 3000-0000">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Celular/WhatsApp</label>
                                <input type="tel" class="form-input" name="celular" placeholder="(11) 99999-9999">
                            </div>
                            <div class="form-group">
                                <label class="form-label">E-mail Principal</label>
                                <input type="email" class="form-input" name="email" placeholder="contato@empresa.com">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Pessoa de Contato</label>
                                <input type="text" class="form-input" name="pessoaContato" placeholder="Nome do responsável">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Cargo</label>
                                <input type="text" class="form-input" name="cargo" placeholder="Cargo do responsável">
                            </div>
                        </div>

                        <div style="margin-top: 2rem;">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Salvar Cliente
                            </button>
                            <button type="button" class="btn btn-outline" onclick="document.getElementById('clientForm').reset()">
                                <i class="fas fa-eraser"></i> Limpar Formulário
                            </button>
                        </div>
                    </form>
                </div>

                <div id="client-list" class="tab-content">
                    <div class="flex justify-between items-center mb-4">
                        <h3>Clientes Cadastrados (<span id="clientsCount">0</span>)</h3>
                        <div class="flex gap-2">
                            <input type="text" class="form-input" id="clientSearch" placeholder="Buscar clientes..." style="width: 300px;" onkeyup="filterClients()">
                            <button class="btn btn-outline btn-sm" onclick="exportClients()">
                                <i class="fas fa-download"></i> Exportar
                            </button>
                        </div>
                    </div>
                    <div id="clientsList">
                        <div class="empty-state">
                            <i class="fas fa-users"></i>
                            <h3>Nenhum cliente cadastrado</h3>
                            <p>Comece cadastrando seu primeiro cliente na aba anterior</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SUPPLIERS PAGE -->
        <div id="suppliers" class="page">
            <div class="page-header">
                <h2 class="page-title">
                    <i class="fas fa-truck-loading"></i> Gestão de Fornecedores
                </h2>
            </div>

            <div class="tab-container">
                <div class="tab-nav">
                    <button class="tab-btn active" onclick="showTab('supplier-form', this)">
                        <i class="fas fa-plus"></i> Cadastrar Fornecedor
                    </button>
                    <button class="tab-btn" onclick="showTab('supplier-list', this)">
                        <i class="fas fa-list"></i> Lista de Fornecedores
                    </button>
                </div>

                <div id="supplier-form" class="tab-content active">
                    <form id="supplierForm">
                        <div class="alert alert-info">
                            <i class="alert-icon fas fa-truck-loading"></i>
                            <div class="alert-content">
                                <div class="alert-title">Cadastro de Fornecedores</div>
                                Mantenha o controle de todos os seus fornecedores de combustível, manutenção, peças e serviços.
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Razão Social *</label>
                                <input type="text" class="form-input" name="razaoSocial" placeholder="Nome da empresa fornecedora" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Nome Fantasia</label>
                                <input type="text" class="form-input" name="nomeFantasia" placeholder="Nome fantasia">
                            </div>
                            <div class="form-group">
                                <label class="form-label">CNPJ</label>
                                <input type="text" class="form-input" name="cnpj" placeholder="00.000.000/0000-00">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Tipo de Serviço *</label>
                                <select class="form-select" name="tipoServico" required>
                                    <option value="">Selecione...</option>
                                    <option value="Combustível">Combustível</option>
                                    <option value="Manutenção">Manutenção</option>
                                    <option value="Pneus">Pneus</option>
                                    <option value="Peças">Peças e Acessórios</option>
                                    <option value="Seguro">Seguro</option>
                                    <option value="Financiamento">Financiamento</option>
                                    <option value="Pedagio">Pedágio</option>
                                    <option value="Hospedagem">Hospedagem</option>
                                    <option value="Alimentacao">Alimentação</option>
                                    <option value="Outros">Outros</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Telefone</label>
                                <input type="tel" class="form-input" name="telefone" placeholder="(11) 99999-9999">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-input" name="email" placeholder="fornecedor@empresa.com">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Pessoa de Contato</label>
                                <input type="text" class="form-input" name="contato" placeholder="Nome do responsável">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Cidade</label>
                                <input type="text" class="form-input" name="cidade" placeholder="Cidade">
                            </div>
                        </div>

                        <div style="margin-top: 2rem;">
                            <button type="submit" class="btn btn-secondary">
                                <i class="fas fa-save"></i> Salvar Fornecedor
                            </button>
                            <button type="button" class="btn btn-outline" onclick="document.getElementById('supplierForm').reset()">
                                <i class="fas fa-eraser"></i> Limpar Formulário
                            </button>
                        </div>
                    </form>
                </div>

                <div id="supplier-list" class="tab-content">
                    <div class="flex justify-between items-center mb-4">
                        <h3>Fornecedores Cadastrados (<span id="suppliersCount">0</span>)</h3>
                        <div class="flex gap-2">
                            <select class="form-select" id="supplierFilter" onchange="filterSuppliers()" style="width: 200px;">
                                <option value="">Todos os tipos</option>
                                <option value="Combustível">Combustível</option>
                                <option value="Manutenção">Manutenção</option>
                                <option value="Pneus">Pneus</option>
                                <option value="Peças">Peças</option>
                                <option value="Outros">Outros</option>
                            </select>
                            <button class="btn btn-outline btn-sm" onclick="exportSuppliers()">
                                <i class="fas fa-download"></i> Exportar
                            </button>
                        </div>
                    </div>
                    <div id="suppliersList">
                        <div class="empty-state">
                            <i class="fas fa-truck-loading"></i>
                            <h3>Nenhum fornecedor cadastrado</h3>
                            <p>Cadastre seus fornecedores para melhor controle de custos</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TRIPS PAGE -->
        <div id="trips" class="page">
            <div class="page-header">
                <h2 class="page-title">
                    <i class="fas fa-truck"></i> Gestão de Viagens
                </h2>
            </div>

            <div class="tab-container">
                <div class="tab-nav">
                    <button class="tab-btn active" onclick="showTab('trip-form', this)">
                        <i class="fas fa-plus"></i> Nova Viagem
                    </button>
                    <button class="tab-btn" onclick="showTab('trip-list', this)">
                        <i class="fas fa-list"></i> Lista de Viagens
                    </button>
                </div>

                <div id="trip-form" class="tab-content active">
                    <form id="tripForm">
                        <div class="alert alert-info">
                            <i class="alert-icon fas fa-truck"></i>
                            <div class="alert-content">
                                <div class="alert-title">Registro de Nova Viagem</div>
                                Registre todas as informações da viagem para ter controle total sobre sua rentabilidade.
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Cliente *</label>
                                <select class="form-select" name="clienteId" required>
                                    <option value="">Selecione um cliente...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Data da Viagem *</label>
                                <input type="date" class="form-input" name="data" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Origem *</label>
                                <input type="text" class="form-input" name="origem" placeholder="Cidade de origem" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Destino *</label>
                                <input type="text" class="form-input" name="destino" placeholder="Cidade de destino" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Distância (KM) *</label>
                                <input type="number" class="form-input" name="km" placeholder="0" step="0.1" required onchange="calcularPrevisaoLucro()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Receita (R$) *</label>
                                <input type="number" class="form-input" name="receita" placeholder="0.00" step="0.01" required onchange="calcularPrevisaoLucro()">
                            </div>
                        </div>

                        <h4 style="margin: 2rem 0 1rem; color: var(--danger); font-weight: 700;">💰 Custos da Viagem</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Combustível (R$) *</label>
                                <input type="number" class="form-input" name="combustivel" placeholder="0.00" step="0.01" required onchange="calcularPrevisaoLucro()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Pedágio (R$)</label>
                                <input type="number" class="form-input" name="pedagio" placeholder="0.00" step="0.01" value="0" onchange="calcularPrevisaoLucro()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Manutenção (R$)</label>
                                <input type="number" class="form-input" name="manutencao" placeholder="0.00" step="0.01" value="0" onchange="calcularPrevisaoLucro()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Hospedagem (R$)</label>
                                <input type="number" class="form-input" name="hospedagem" placeholder="0.00" step="0.01" value="0" onchange="calcularPrevisaoLucro()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Alimentação (R$)</label>
                                <input type="number" class="form-input" name="alimentacao" placeholder="0.00" step="0.01" value="0" onchange="calcularPrevisaoLucro()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Outros Custos (R$)</label>
                                <input type="number" class="form-input" name="outros" placeholder="0.00" step="0.01" value="0" onchange="calcularPrevisaoLucro()">
                            </div>
                        </div>

                        <div class="calculator-result" id="previsaoLucro" style="display: none;">
                            <div class="result-value" id="previsaoValor">R$ 0,00</div>
                            <div class="result-label">Previsão de Lucro</div>
                        </div>

                        <div style="margin-top: 2rem;">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Registrar Viagem
                            </button>
                            <button type="button" class="btn btn-outline" onclick="limparFormularioViagem()">
                                <i class="fas fa-eraser"></i> Limpar Formulário
                            </button>
                        </div>
                    </form>
                </div>

                <div id="trip-list" class="tab-content">
                    <div class="flex justify-between items-center mb-4">
                        <h3>Viagens Registradas (<span id="tripsCount">0</span>)</h3>
                        <div class="flex gap-2">
                            <select class="form-select" id="tripFilter" onchange="filterTrips()" style="width: 150px;">
                                <option value="">Todos os meses</option>
                                <option value="2024-01">Janeiro 2024</option>
                                <option value="2024-02">Fevereiro 2024</option>
                                <option value="2024-03">Março 2024</option>
                                <option value="2024-04">Abril 2024</option>
                                <option value="2024-05">Maio 2024</option>
                                <option value="2024-06">Junho 2024</option>
                                <option value="2024-07">Julho 2024</option>
                                <option value="2024-08">Agosto 2024</option>
                                <option value="2024-09">Setembro 2024</option>
                                <option value="2024-10">Outubro 2024</option>
                                <option value="2024-11">Novembro 2024</option>
                                <option value="2024-12">Dezembro 2024</option>
                            </select>
                            <button class="btn btn-outline btn-sm" onclick="exportTrips()">
                                <i class="fas fa-download"></i> Exportar
                            </button>
                        </div>
                    </div>
                    <div id="tripsList">
                        <div class="empty-state">
                            <i class="fas fa-truck"></i>
                            <h3>Nenhuma viagem registrada</h3>
                            <p>Cadastre clientes primeiro, depois registre suas viagens</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CALCULATORS PAGE -->
        <div id="calculators" class="page">
            <div class="page-header">
                <h2 class="page-title">
                    <i class="fas fa-calculator"></i> Calculadoras Inteligentes
                </h2>
            </div>

            <div class="alert alert-success">
                <i class="alert-icon fas fa-brain"></i>
                <div class="alert-content">
                    <div class="alert-title">🧮 Calculadoras Avançadas</div>
                    Use nossas calculadoras para simular lucros, estimar custos e tomar decisões mais inteligentes!
                </div>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 2rem;">
                <!-- Calculadora de Frete -->
                <div class="calculator-card">
                    <h3 style="color: var(--primary); margin-bottom: 1rem;">🚛 Calculadora de Frete</h3>
                    <div class="form-group">
                        <label class="form-label">Distância (KM)</label>
                        <input type="number" class="form-input" id="calc1-km" placeholder="0" onchange="calcularFrete()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Peso da Carga (Ton)</label>
                        <input type="number" class="form-input" id="calc1-peso" placeholder="0" step="0.1" onchange="calcularFrete()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Urgência</label>
                        <select class="form-select" id="calc1-urgencia" onchange="calcularFrete()">
                            <option value="normal">Normal (1x)</option>
                            <option value="urgente">Urgente (+20%)</option>
                            <option value="expressa">Expressa (+50%)</option>
                        </select>
                    </div>
                    <div class="calculator-result" id="result-frete" style="display: none;">
                        <div class="result-value" id="valor-frete">R$ 0,00</div>
                        <div class="result-label">Valor Sugerido do Frete</div>
                    </div>
                </div>

                <!-- Simulador de Lucro -->
                <div class="calculator-card">
                    <h3 style="color: var(--secondary); margin-bottom: 1rem;">💰 Simulador de Lucro</h3>
                    <div class="form-group">
                        <label class="form-label">Receita (R$)</label>
                        <input type="number" class="form-input" id="calc2-receita" placeholder="0.00" step="0.01" onchange="simularLucro()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Combustível (R$)</label>
                        <input type="number" class="form-input" id="calc2-combustivel" placeholder="0.00" step="0.01" onchange="simularLucro()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Outros Custos (R$)</label>
                        <input type="number" class="form-input" id="calc2-custos" placeholder="0.00" step="0.01" onchange="simularLucro()">
                    </div>
                    <div class="calculator-result" id="result-lucro" style="display: none;">
                        <div class="result-value" id="valor-lucro">R$ 0,00</div>
                        <div class="result-label">Lucro Estimado (<span id="margem-lucro">0%</span>)</div>
                    </div>
                </div>

                <!-- Calculadora de Combustível -->
                <div class="calculator-card">
                    <h3 style="color: var(--warning); margin-bottom: 1rem;">⛽ Calculadora de Combustível</h3>
                    <div class="form-group">
                        <label class="form-label">Distância (KM)</label>
                        <input type="number" class="form-input" id="calc3-km" placeholder="0" onchange="calcularCombustivel()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Consumo (KM/L)</label>
                        <input type="number" class="form-input" id="calc3-consumo" placeholder="3.5" step="0.1" value="3.5" onchange="calcularCombustivel()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Preço do Diesel (R$/L)</label>
                        <input type="number" class="form-input" id="calc3-preco" placeholder="6.50" step="0.01" value="6.50" onchange="calcularCombustivel()">
                    </div>
                    <div class="calculator-result" id="result-combustivel" style="display: none;">
                        <div class="result-value" id="valor-combustivel">R$ 0,00</div>
                        <div class="result-label">Custo de Combustível (<span id="litros-combustivel">0L</span>)</div>
                    </div>
                </div>

                <!-- Análise de Viabilidade -->
                <div class="calculator-card">
                    <h3 style="color: var(--info); margin-bottom: 1rem;">📊 Análise de Viabilidade</h3>
                    <div class="form-group">
                        <label class="form-label">Receita Proposta (R$)</label>
                        <input type="number" class="form-input" id="calc4-receita" placeholder="0.00" step="0.01" onchange="analisarViabilidade()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Custos Totais (R$)</label>
                        <input type="number" class="form-input" id="calc4-custos" placeholder="0.00" step="0.01" onchange="analisarViabilidade()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Margem Mínima (%)</label>
                        <input type="number" class="form-input" id="calc4-margem" placeholder="15" value="15" onchange="analisarViabilidade()">
                    </div>
                    <div class="calculator-result" id="result-viabilidade" style="display: none;">
                        <div class="result-value" id="status-viabilidade">VIÁVEL</div>
                        <div class="result-label">Status da Viagem (<span id="margem-real">0%</span> de margem)</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ANALYTICS PAGE -->
        <div id="analytics" class="page">
            <div class="page-header">
                <h2 class="page-title">
                    <i class="fas fa-chart-pie"></i> Analytics Avançados
                </h2>
                <button class="btn btn-accent btn-sm" onclick="updateAnalytics()">
                    <i class="fas fa-sync-alt"></i> Atualizar Análises
                </button>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon primary">
                            <i class="fas fa-trophy"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="analytics-best-client">-</div>
                    <div class="stat-label">Cliente Mais Lucrativo</div>
                    <div class="stat-change positive">
                        <span id="best-client-profit">R$ 0,00</span> de lucro
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon secondary">
                            <i class="fas fa-route"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="analytics-best-route">-</div>
                    <div class="stat-label">Rota Mais Rentável</div>
                    <div class="stat-change positive">
                        <span id="best-route-margin">0%</span> de margem
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon warning">
                            <i class="fas fa-gas-pump"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="analytics-fuel-avg">R$ 0,00</div>
                    <div class="stat-label">Custo Médio de Combustível</div>
                    <div class="stat-change neutral">
                        <span id="fuel-per-km">R$ 0,00/km</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon danger">
                            <i class="fas fa-chart-line"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="analytics-monthly-growth">+0%</div>
                    <div class="stat-label">Crescimento Mensal</div>
                    <div class="stat-change positive">
                        Tendência <span id="growth-trend">estável</span>
                    </div>
                </div>
            </div>

            <div class="chart-grid">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-users"></i> Ranking de Clientes por Lucro
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="clientRankingChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-map-marked-alt"></i> Análise por Rota
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="routeAnalysisChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-calculator"></i> Análise Detalhada de Custos
                    </h3>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="costAnalysisChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- FINANCIAL PAGE -->
        <div id="financial" class="page">
            <div class="page-header">
                <h2 class="page-title">
                    <i class="fas fa-dollar-sign"></i> Gestão Financeira
                </h2>
            </div>

            <div class="tab-container">
                <div class="tab-nav">
                    <button class="tab-btn active" onclick="showTab('financial-overview', this)">
                        <i class="fas fa-chart-line"></i> Visão Geral
                    </button>
                    <button class="tab-btn" onclick="showTab('financial-expenses', this)">
                        <i class="fas fa-receipt"></i> Controle de Despesas
                    </button>
                    <button class="tab-btn" onclick="showTab('financial-goals', this)">
                        <i class="fas fa-bullseye"></i> Metas
                    </button>
                    <button class="tab-btn" onclick="showTab('financial-flow', this)">
                        <i class="fas fa-exchange-alt"></i> Fluxo de Caixa
                    </button>
                </div>

                <div id="financial-overview" class="tab-content active">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon primary">
                                    <i class="fas fa-arrow-up"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="financial-revenue">R$ 0,00</div>
                            <div class="stat-label">Receita Mensal</div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-up"></i>
                                <span id="revenue-growth">+0%</span> vs mês anterior
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon danger">
                                    <i class="fas fa-arrow-down"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="financial-expenses">R$ 0,00</div>
                            <div class="stat-label">Despesas Mensais</div>
                            <div class="stat-change negative">
                                <i class="fas fa-arrow-down"></i>
                                <span id="expenses-growth">-0%</span> vs mês anterior
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon secondary">
                                    <i class="fas fa-piggy-bank"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="financial-profit">R$ 0,00</div>
                            <div class="stat-label">Lucro Líquido</div>
                            <div class="stat-change positive">
                                <span id="profit-margin">0%</span> de margem
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon accent">
                                    <i class="fas fa-wallet"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="financial-balance">R$ 0,00</div>
                            <div class="stat-label">Saldo Projetado</div>
                            <div class="stat-change neutral">
                                Para o próximo mês
                            </div>
                        </div>
                    </div>
                </div>

                <div id="financial-expenses" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-plus"></i> Nova Despesa
                            </h3>
                        </div>
                        <div class="card-body">
                            <form id="expenseForm">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Tipo de Despesa</label>
                                        <select class="form-select" name="tipo" required>
                                            <option value="">Selecione...</option>
                                            <option value="Combustível">Combustível</option>
                                            <option value="Manutenção">Manutenção</option>
                                            <option value="Seguro">Seguro</option>
                                            <option value="IPVA">IPVA</option>
                                            <option value="Financiamento">Financiamento</option>
                                            <option value="Outros">Outros</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Valor (R$)</label>
                                        <input type="number" class="form-input" name="valor" placeholder="0.00" step="0.01" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Data</label>
                                        <input type="date" class="form-input" name="data" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Descrição</label>
                                        <input type="text" class="form-input" name="descricao" placeholder="Descrição da despesa">
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-danger">
                                    <i class="fas fa-save"></i> Registrar Despesa
                                </button>
                            </form>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-list"></i> Despesas Registradas
                            </h3>
                        </div>
                        <div class="card-body">
                            <div id="expensesList">
                                <div class="empty-state">
                                    <i class="fas fa-receipt"></i>
                                    <h3>Nenhuma despesa registrada</h3>
                                    <p>Registre suas despesas para ter controle total dos custos</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="financial-goals" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-bullseye"></i> Definir Metas
                            </h3>
                        </div>
                        <div class="card-body">
                            <form id="goalsForm">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Meta de Receita Mensal (R$)</label>
                                        <input type="number" class="form-input" name="metaReceita" placeholder="0.00" step="0.01">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Meta de Viagens/Mês</label>
                                        <input type="number" class="form-input" name="metaViagens" placeholder="0">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Meta de Margem de Lucro (%)</label>
                                        <input type="number" class="form-input" name="metaMargem" placeholder="15" value="15">
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-accent">
                                    <i class="fas fa-save"></i> Salvar Metas
                                </button>
                            </form>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon primary">
                                    <i class="fas fa-target"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="goal-revenue-progress">0%</div>
                            <div class="stat-label">Meta de Receita</div>
                            <div class="stat-change neutral">
                                <span id="goal-revenue-status">R$ 0 / R$ 0</span>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon secondary">
                                    <i class="fas fa-truck"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="goal-trips-progress">0%</div>
                            <div class="stat-label">Meta de Viagens</div>
                            <div class="stat-change neutral">
                                <span id="goal-trips-status">0 / 0 viagens</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="financial-flow" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-chart-line"></i> Projeção de Fluxo de Caixa
                            </h3>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="cashFlowChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- REPORTS PAGE -->
        <div id="reports" class="page">
            <div class="page-header">
                <h2 class="page-title">
                    <i class="fas fa-file-alt"></i> Relatórios Avançados
                </h2>
                <div class="page-actions">
                    <button class="btn btn-accent btn-sm" onclick="generateReport()">
                        <i class="fas fa-chart-bar"></i> Gerar Relatório
                    </button>
                    <button class="btn btn-outline btn-sm" onclick="exportReport()">
                        <i class="fas fa-download"></i> Exportar Tudo
                    </button>
                </div>
            </div>

            <div class="alert alert-info">
                <i class="alert-icon fas fa-chart-pie"></i>
                <div class="alert-content">
                    <div class="alert-title">📊 Relatórios Inteligentes</div>
                    Análises automáticas e detalhadas de todo o seu negócio com dados atualizados em tempo real.
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon primary">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="report-total-trips">0</div>
                    <div class="stat-label">Total de Viagens</div>
                    <div class="stat-change positive">
                        <span id="report-avg-month">0</span> por mês
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon secondary">
                            <i class="fas fa-road"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="report-total-km">0 km</div>
                    <div class="stat-label">Quilometragem Total</div>
                    <div class="stat-change neutral">
                        <span id="report-avg-per-trip">0 km</span> por viagem
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon warning">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="report-total-revenue">R$ 0</div>
                    <div class="stat-label">Receita Acumulada</div>
                    <div class="stat-change positive">
                        <span id="report-avg-per-km">R$ 0/km</span> médio
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon accent">
                            <i class="fas fa-chart-line"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="report-total-profit">R$ 0</div>
                    <div class="stat-label">Lucro Acumulado</div>
                    <div class="stat-change positive">
                        <span id="report-margin">0%</span> de margem
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-download"></i> Exportar Dados
                    </h3>
                </div>
                <div class="card-body">
                    <p style="margin-bottom: 1.5rem; color: var(--gray);">
                        Exporte seus dados em diferentes formatos para análise externa ou backup.
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <button class="btn btn-primary" onclick="exportClients()">
                            <i class="fas fa-users"></i> Exportar Clientes
                        </button>
                        <button class="btn btn-secondary" onclick="exportSuppliers()">
                            <i class="fas fa-truck-loading"></i> Exportar Fornecedores
                        </button>
                        <button class="btn btn-accent" onclick="exportTrips()">
                            <i class="fas fa-truck"></i> Exportar Viagens
                        </button>
                        <button class="btn btn-outline" onclick="exportComplete()">
                            <i class="fas fa-file-export"></i> Relatório Completo
                        </button>
                    </div>
                    <textarea id="exportData" style="width: 100%; height: 200px; margin-top: 1.5rem; padding: 1rem; border: 1px solid var(--gray-light); border-radius: var(--border-radius); font-family: monospace; display: none;" readonly></textarea>
                </div>
            </div>
        </div>

        <!-- SETTINGS PAGE -->
        <div id="settings" class="page">
            <div class="page-header">
                <h2 class="page-title">
                    <i class="fas fa-cog"></i> Configurações do Sistema
                </h2>
            </div>

            <div class="tab-container">
                <div class="tab-nav">
                    <button class="tab-btn active" onclick="showTab('settings-general', this)">
                        <i class="fas fa-cog"></i> Gerais
                    </button>
                    <button class="tab-btn" onclick="showTab('settings-company', this)">
                        <i class="fas fa-building"></i> Empresa
                    </button>
                    <button class="tab-btn" onclick="showTab('settings-users', this)">
                        <i class="fas fa-users-cog"></i> Usuários
                    </button>
                    <button class="tab-btn" onclick="showTab('settings-system', this)">
                        <i class="fas fa-server"></i> Sistema
                    </button>
                </div>

                <div id="settings-general" class="tab-content active">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-palette"></i> Preferências de Interface
                            </h3>
                        </div>
                        <div class="card-body">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Tema do Sistema</label>
                                    <select class="form-select" onchange="changeTheme(this.value)">
                                        <option value="light">Claro</option>
                                        <option value="dark">Escuro</option>
                                        <option value="auto">Automático</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Idioma</label>
                                    <select class="form-select">
                                        <option value="pt-BR">Português (Brasil)</option>
                                        <option value="en-US">English (US)</option>
                                        <option value="es-ES">Español</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Moeda</label>
                                    <select class="form-select">
                                        <option value="BRL">Real Brasileiro (R$)</option>
                                        <option value="USD">Dólar Americano ($)</option>
                                        <option value="EUR">Euro (€)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon info">
                                    <i class="fas fa-database"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="settings-data-size">0 KB</div>
                            <div class="stat-label">Dados Armazenados</div>
                            <div class="stat-change neutral">
                                <span id="settings-last-backup">Backup automático</span>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon primary">
                                    <i class="fas fa-rocket"></i>
                                </div>
                            </div>
                            <div class="stat-value">v5.0</div>
                            <div class="stat-label">Versão do Sistema</div>
                            <div class="stat-change positive">
                                <span>Atualizada</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="settings-company" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-building"></i> Dados da Empresa
                            </h3>
                        </div>
                        <div class="card-body">
                            <form id="companyForm">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Razão Social</label>
                                        <input type="text" class="form-input" name="razaoSocial" placeholder="Nome da sua empresa">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Nome Fantasia</label>
                                        <input type="text" class="form-input" name="nomeFantasia" placeholder="Nome fantasia">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">CNPJ</label>
                                        <input type="text" class="form-input" name="cnpj" placeholder="00.000.000/0000-00">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Telefone</label>
                                        <input type="tel" class="form-input" name="telefone" placeholder="(11) 99999-9999">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Email</label>
                                        <input type="email" class="form-input" name="email" placeholder="contato@empresa.com">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Website</label>
                                        <input type="url" class="form-input" name="website" placeholder="https://www.empresa.com">
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> Salvar Dados da Empresa
                                </button>
                            </form>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-file-contract"></i> Documentos Fiscais
                            </h3>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-warning">
                                <i class="alert-icon fas fa-exclamation-triangle"></i>
                                <div class="alert-content">
                                    <div class="alert-title">⚠️ Integração Fiscal</div>
                                    Configure a integração com CTe e MDFe para emissão automática de documentos fiscais.
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Certificado Digital</label>
                                    <input type="file" class="form-input" accept=".pfx,.p12">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Senha do Certificado</label>
                                    <input type="password" class="form-input" placeholder="Senha do certificado">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Ambiente</label>
                                    <select class="form-select">
                                        <option value="homologacao">Homologação</option>
                                        <option value="producao">Produção</option>
                                    </select>
                                </div>
                            </div>

                            <button class="btn btn-outline">
                                <i class="fas fa-cog"></i> Configurar Integração Fiscal
                            </button>
                        </div>
                    </div>
                </div>

                <div id="settings-users" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-user-plus"></i> Gerenciar Usuários
                            </h3>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info">
                                <i class="alert-icon fas fa-info-circle"></i>
                                <div class="alert-content">
                                    <div class="alert-title">👥 Sistema Multiusuário</div>
                                    Adicione usuários manualmente ou gere links de convite para sua equipe.
                                </div>
                            </div>

                            <form id="userForm">
                                <h4 style="margin-bottom: 1rem; color: var(--primary);">Adicionar Usuário Manualmente</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Nome Completo</label>
                                        <input type="text" class="form-input" name="nomeCompleto" placeholder="Nome do usuário" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Email</label>
                                        <input type="email" class="form-input" name="email" placeholder="usuario@email.com" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Senha Inicial</label>
                                        <input type="password" class="form-input" name="senha" placeholder="Senha temporária" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Nível de Acesso</label>
                                        <select class="form-select" name="nivel" required>
                                            <option value="user">Usuário</option>
                                            <option value="admin">Administrador</option>
                                        </select>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-secondary">
                                    <i class="fas fa-user-plus"></i> Adicionar Usuário
                                </button>
                            </form>

                            <hr style="margin: 2rem 0;">

                            <h4 style="margin-bottom: 1rem; color: var(--accent);">Gerar Link de Convite</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Tipo de Usuário</label>
                                    <select class="form-select" id="inviteUserType">
                                        <option value="user">Usuário</option>
                                        <option value="admin">Administrador</option>
                                    </select>
                                </div>
                                <div class="form-group" style="display: flex; align-items: end;">
                                    <button class="btn btn-accent" onclick="generateInviteLink()">
                                        <i class="fas fa-link"></i> Gerar Convite
                                    </button>
                                </div>
                            </div>

                            <div id="inviteResult" class="hidden" style="margin-top: 1rem; padding: 1rem; background: var(--gray-light); border-radius: var(--border-radius);">
                                <label class="form-label">Link de Convite Gerado:</label>
                                <div style="display: flex; gap: 0.5rem;">
                                    <input type="text" id="inviteLink" class="form-input" readonly style="font-family: monospace; font-size: 0.9rem;">
                                    <button class="btn btn-outline btn-sm" onclick="copyInviteLink()">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                                <small style="color: var(--gray); margin-top: 0.5rem; display: block;">
                                    ⚠️ Este link expira em 7 dias. Compartilhe apenas com pessoas autorizadas.
                                </small>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="settings-system" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-info-circle"></i> Informações do Sistema
                            </h3>
                        </div>
                        <div class="card-body">
                            <div class="stats-grid">
                                <div style="text-align: center; padding: 2rem; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; border-radius: var(--border-radius);">
                                    <div style="font-size: 3rem; margin-bottom: 1rem;">🚛</div>
                                    <div style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem;">TransCS Pro Ultimate</div>
                                    <div style="opacity: 0.9;">Versão 5.0.0</div>
                                </div>

                                <div style="text-align: center; padding: 2rem; background: var(--gray-light); border-radius: var(--border-radius);">
                                    <div style="font-size: 2rem; margin-bottom: 1rem; color: var(--success);">✅</div>
                                    <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;">Status do Sistema</div>
                                    <div style="color: var(--success); font-weight: 600;">Online e Funcional</div>
                                </div>

                                <div style="text-align: center; padding: 2rem; background: var(--gray-light); border-radius: var(--border-radius);">
                                    <div style="font-size: 2rem; margin-bottom: 1rem; color: var(--info);">🔒</div>
                                    <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;">Segurança</div>
                                    <div style="color: var(--info); font-weight: 600;">Protegido</div>
                                </div>

                                <div style="text-align: center; padding: 2rem; background: var(--gray-light); border-radius: var(--border-radius);">
                                    <div style="font-size: 2rem; margin-bottom: 1rem; color: var(--warning);">⚡</div>
                                    <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;">Performance</div>
                                    <div style="color: var(--warning); font-weight: 600;">Otimizada</div>
                                </div>
                            </div>

                            <div style="margin-top: 2rem; padding: 2rem; background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); border-radius: var(--border-radius); border: 1px solid var(--gray-light);">
                                <h4 style="margin-bottom: 1rem; color: var(--dark);">🚀 Recursos Disponíveis:</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                    <div>✅ Dashboard Visual Avançado</div>
                                    <div>✅ Calculadoras Inteligentes</div>
                                    <div>✅ Analytics em Tempo Real</div>
                                    <div>✅ Gestão Financeira Completa</div>
                                    <div>✅ Relatórios Profissionais</div>
                                    <div>✅ Interface Moderna</div>
                                    <div>✅ Controle de Usuários</div>
                                    <div>✅ Backup Automático</div>
                                </div>
                            </div>

                            <div style="margin-top: 2rem; text-align: center;">
                                <button class="btn btn-danger" onclick="clearAllData()">
                                    <i class="fas fa-trash-alt"></i> Limpar Todos os Dados
                                </button>
                                <button class="btn btn-outline" onclick="exportBackup()">
                                    <i class="fas fa-download"></i> Backup Completo
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== GLOBAL VARIABLES ====================
        let data = {
            clients: [],
            suppliers: [],
            trips: [],
            expenses: [],
            goals: {
                metaReceita: 0,
                metaViagens: 0,
                metaMargem: 15
            },
            company: {
                razaoSocial: '',
                nomeFantasia: '',
                cnpj: '',
                telefone: '',
                email: '',
                website: ''
            }
        };

        let charts = {
            revenue: null,
            client: null,
            clientRanking: null,
            routeAnalysis: null,
            costAnalysis: null,
            cashFlow: null
        };

        // ==================== INITIALIZATION ====================
        function init() {
            console.log('🚀 Iniciando TransCS Pro Ultimate v5.0...');
            
            loadData();
            setupEvents();
            setTodayDate();
            updateTime();
            setInterval(updateTime, 1000);
            updateStats();
            
            console.log('✅ Sistema iniciado com sucesso!');
        }

        function loadData() {
            try {
                const saved = localStorage.getItem('transcs_ultimate_data');
                if (saved) {
                    data = { ...data, ...JSON.parse(saved) };
                }
                console.log('📊 Dados carregados:', data);
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
            }
        }

        function saveData() {
            try {
                localStorage.setItem('transcs_ultimate_data', JSON.stringify(data));
                console.log('💾 Dados salvos automaticamente');
            } catch (error) {
                console.error('Erro ao salvar dados:', error);
            }
        }

        function setupEvents() {
            // Login
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // Forms
            document.getElementById('clientForm').addEventListener('submit', handleClientSubmit);
            document.getElementById('supplierForm').addEventListener('submit', handleSupplierSubmit);
            document.getElementById('tripForm').addEventListener('submit', handleTripSubmit);
            document.getElementById('expenseForm').addEventListener('submit', handleExpenseSubmit);
            document.getElementById('goalsForm').addEventListener('submit', handleGoalsSubmit);
            document.getElementById('companyForm').addEventListener('submit', handleCompanySubmit);
        }

        function setTodayDate() {
            const today = new Date().toISOString().split('T')[0];
            const dateInputs = document.querySelectorAll('input[type="date"]');
            dateInputs.forEach(input => {
                if (!input.value) {
                    input.value = today;
                }
            });
        }

        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('pt-BR');
            document.getElementById('currentTime').textContent = timeString;
        }

        // ==================== AUTHENTICATION ====================
        function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === 'admin' && password === '123') {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('app').classList.add('active');
                showNotification('🎉 Bem-vindo ao TransCS Pro Ultimate v5.0!', 'success');
                updateAllData();
                initializeCharts();
            } else {
                showNotification('❌ Usuário ou senha incorretos', 'error');
            }
        }

        function logout() {
            showNotification('👋 Sessão encerrada com sucesso!', 'success');
            setTimeout(() => {
                window.location.reload();
            }, 1500);
        }

        // ==================== NAVIGATION ====================
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Remove active from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Add active to clicked button
            event.target.classList.add('active');

            // Update specific page data
            if (pageId === 'analytics') {
                updateAnalytics();
            } else if (pageId === 'financial') {
                updateFinancial();
            } else if (pageId === 'reports') {
                updateReports();
            }
        }

        function showTab(tabId, button) {
            // Get parent container
            const container = button.closest('.tab-container');
            
            // Hide all tab contents in this container
            container.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active from all tab buttons in this container
            container.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabId).classList.add('active');
            button.classList.add('active');
        }

        // ==================== CLIENTS MANAGEMENT ====================
        function handleClientSubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const client = {
                id: Date.now(),
                razaoSocial: formData.get('razaoSocial'),
                nomeFantasia: formData.get('nomeFantasia'),
                cnpj: formData.get('cnpj'),
                tipoPessoa: formData.get('tipoPessoa'),
                inscricaoEstadual: formData.get('inscricaoEstadual'),
                inscricaoMunicipal: formData.get('inscricaoMunicipal'),
                cep: formData.get('cep'),
                logradouro: formData.get('logradouro'),
                numero: formData.get('numero'),
                complemento: formData.get('complemento'),
                bairro: formData.get('bairro'),
                cidade: formData.get('cidade'),
                estado: formData.get('estado'),
                telefoneFixo: formData.get('telefoneFixo'),
                celular: formData.get('celular'),
                email: formData.get('email'),
                pessoaContato: formData.get('pessoaContato'),
                cargo: formData.get('cargo'),
                createdAt: new Date().toISOString()
            };
            
            data.clients.push(client);
            saveData();
            
            e.target.reset();
            updateClientsList();
            updateClientSelect();
            updateStats();
            
            showNotification('✅ Cliente cadastrado com sucesso!', 'success');
        }

        function updateClientsList() {
            const container = document.getElementById('clientsList');
            const count = document.getElementById('clientsCount');
            
            count.textContent = data.clients.length;
            
            if (data.clients.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <h3>Nenhum cliente cadastrado</h3>
                        <p>Comece cadastrando seu primeiro cliente na aba anterior</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = data.clients.map(client => `
                <div class="item">
                    <div class="item-info">
                        <div class="item-name">${client.razaoSocial}</div>
                        <div class="item-details">
                            ${client.nomeFantasia ? `${client.nomeFantasia} | ` : ''}
                            ${client.cidade || 'Cidade não informada'} - ${client.estado || 'UF'}<br>
                            ${client.celular || client.telefoneFixo || 'Telefone não informado'} | 
                            ${client.email || 'Email não informado'}
                        </div>
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-sm btn-outline" onclick="editClient(${client.id})">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteClient(${client.id})">
                            <i class="fas fa-trash"></i> Excluir
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function updateClientSelect() {
            const select = document.querySelector('select[name="clienteId"]');
            if (!select) return;
            
            select.innerHTML = '<option value="">Selecione um cliente...</option>' +
                data.clients.map(client => `<option value="${client.id}">${client.razaoSocial}</option>`).join('');
        }

        function deleteClient(id) {
            if (confirm('Tem certeza que deseja excluir este cliente?')) {
                data.clients = data.clients.filter(c => c.id !== id);
                saveData();
                updateClientsList();
                updateClientSelect();
                updateStats();
                showNotification('✅ Cliente excluído com sucesso!', 'success');
            }
        }

        function filterClients() {
            const search = document.getElementById('clientSearch').value.toLowerCase();
            const items = document.querySelectorAll('#clientsList .item');
            
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(search) ? 'flex' : 'none';
            });
        }

        // ==================== SUPPLIERS MANAGEMENT ====================
        function handleSupplierSubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const supplier = {
                id: Date.now(),
                razaoSocial: formData.get('razaoSocial'),
                nomeFantasia: formData.get('nomeFantasia'),
                cnpj: formData.get('cnpj'),
                tipoServico: formData.get('tipoServico'),
                telefone: formData.get('telefone'),
                email: formData.get('email'),
                contato: formData.get('contato'),
                cidade: formData.get('cidade'),
                createdAt: new Date().toISOString()
            };
            
            data.suppliers.push(supplier);
            saveData();
            
            e.target.reset();
            updateSuppliersList();
            updateStats();
            
            showNotification('✅ Fornecedor cadastrado com sucesso!', 'success');
        }

        function updateSuppliersList() {
            const container = document.getElementById('suppliersList');
            const count = document.getElementById('suppliersCount');
            
            count.textContent = data.suppliers.length;
            
            if (data.suppliers.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-truck-loading"></i>
                        <h3>Nenhum fornecedor cadastrado</h3>
                        <p>Cadastre seus fornecedores para melhor controle de custos</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = data.suppliers.map(supplier => `
                <div class="item">
                    <div class="item-info">
                        <div class="item-name">${supplier.razaoSocial}</div>
                        <div class="item-details">
                            ${supplier.tipoServico} | ${supplier.cidade || 'Cidade não informada'}<br>
                            ${supplier.telefone || 'Telefone não informado'} | ${supplier.contato || 'Contato não informado'}
                        </div>
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-sm btn-outline" onclick="editSupplier(${supplier.id})">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteSupplier(${supplier.id})">
                            <i class="fas fa-trash"></i> Excluir
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function deleteSupplier(id) {
            if (confirm('Tem certeza que deseja excluir este fornecedor?')) {
                data.suppliers = data.suppliers.filter(s => s.id !== id);
                saveData();
                updateSuppliersList();
                updateStats();
                showNotification('✅ Fornecedor excluído com sucesso!', 'success');
            }
        }

        function filterSuppliers() {
            const filter = document.getElementById('supplierFilter').value;
            const items = document.querySelectorAll('#suppliersList .item');
            
            items.forEach(item => {
                const type = item.querySelector('.item-details').textContent.split('|')[0].trim();
                item.style.display = (!filter || type === filter) ? 'flex' : 'none';
            });
        }

        // ==================== TRIPS MANAGEMENT ====================
        function handleTripSubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const clienteId = parseInt(formData.get('clienteId'));
            const receita = parseFloat(formData.get('receita'));
            const combustivel = parseFloat(formData.get('combustivel'));
            const pedagio = parseFloat(formData.get('pedagio')) || 0;
            const manutencao = parseFloat(formData.get('manutencao')) || 0;
            const hospedagem = parseFloat(formData.get('hospedagem')) || 0;
            const alimentacao = parseFloat(formData.get('alimentacao')) || 0;
            const outros = parseFloat(formData.get('outros')) || 0;
            
            const totalCosts = combustivel + pedagio + manutencao + hospedagem + alimentacao + outros;
            const profit = receita - totalCosts;
            const margin = receita > 0 ? (profit / receita) * 100 : 0;
            
            const trip = {
                id: Date.now(),
                clienteId: clienteId,
                data: formData.get('data'),
                origem: formData.get('origem'),
                destino: formData.get('destino'),
                km: parseFloat(formData.get('km')),
                receita: receita,
                combustivel: combustivel,
                pedagio: pedagio,
                manutencao: manutencao,
                hospedagem: hospedagem,
                alimentacao: alimentacao,
                outros: outros,
                totalCosts: totalCosts,
                profit: profit,
                margin: margin,
                createdAt: new Date().toISOString()
            };
            
            data.trips.push(trip);
            saveData();
            
            limparFormularioViagem();
            updateTripsList();
            updateStats();
            updateCharts();
            
            showNotification('✅ Viagem registrada com sucesso!', 'success');
        }

        function limparFormularioViagem() {
            document.getElementById('tripForm').reset();
            setTodayDate();
            document.getElementById('previsaoLucro').style.display = 'none';
        }

        function calcularPrevisaoLucro() {
            const receita = parseFloat(document.querySelector('input[name="receita"]').value) || 0;
            const combustivel = parseFloat(document.querySelector('input[name="combustivel"]').value) || 0;
            const pedagio = parseFloat(document.querySelector('input[name="pedagio"]').value) || 0;
            const manutencao = parseFloat(document.querySelector('input[name="manutencao"]').value) || 0;
            const hospedagem = parseFloat(document.querySelector('input[name="hospedagem"]').value) || 0;
            const alimentacao = parseFloat(document.querySelector('input[name="alimentacao"]').value) || 0;
            const outros = parseFloat(document.querySelector('input[name="outros"]').value) || 0;
            
            const totalCosts = combustivel + pedagio + manutencao + hospedagem + alimentacao + outros;
            const profit = receita - totalCosts;
            
            if (receita > 0) {
                document.getElementById('previsaoLucro').style.display = 'block';
                document.getElementById('previsaoValor').textContent = `R$ ${profit.toFixed(2)}`;
                document.getElementById('previsaoValor').style.color = profit >= 0 ? 'var(--success)' : 'var(--danger)';
            } else {
                document.getElementById('previsaoLucro').style.display = 'none';
            }
        }

        function updateTripsList() {
            const container = document.getElementById('tripsList');
            const count = document.getElementById('tripsCount');
            
            count.textContent = data.trips.length;
            
            if (data.trips.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-truck"></i>
                        <h3>Nenhuma viagem registrada</h3>
                        <p>Cadastre clientes primeiro, depois registre suas viagens</p>
                    </div>
                `;
                return;
            }
            
            // Sort trips by date (newest first)
            const sortedTrips = [...data.trips].sort((a, b) => new Date(b.data) - new Date(a.data));
            
            container.innerHTML = sortedTrips.map(trip => {
                const client = data.clients.find(c => c.id === trip.clienteId);
                const clientName = client ? client.razaoSocial : 'Cliente não encontrado';
                const date = new Date(trip.data).toLocaleDateString('pt-BR');
                const marginClass = trip.margin >= 15 ? 'positive' : trip.margin >= 0 ? 'neutral' : 'negative';
                
                return `
                    <div class="item">
                        <div class="item-info">
                            <div class="item-name">${clientName} - ${date}</div>
                            <div class="item-details">
                                📍 ${trip.origem} → ${trip.destino} | ${trip.km} km<br>
                                💰 Receita: R$ ${trip.receita.toFixed(2)} | Lucro: R$ ${trip.profit.toFixed(2)} 
                                <span class="stat-change ${marginClass}" style="display: inline; padding: 0.2rem 0.5rem; margin-left: 0.5rem;">
                                    ${trip.margin.toFixed(1)}% margem
                                </span>
                            </div>
                        </div>
                        <div class="item-actions">
                            <button class="btn btn-sm btn-outline" onclick="viewTripDetails(${trip.id})">
                                <i class="fas fa-eye"></i> Detalhes
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteTrip(${trip.id})">
                                <i class="fas fa-trash"></i> Excluir
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function deleteTrip(id) {
            if (confirm('Tem certeza que deseja excluir esta viagem?')) {
                data.trips = data.trips.filter(t => t.id !== id);
                saveData();
                updateTripsList();
                updateStats();
                updateCharts();
                showNotification('✅ Viagem excluída com sucesso!', 'success');
            }
        }

        function filterTrips() {
            const filter = document.getElementById('tripFilter').value;
            const items = document.querySelectorAll('#tripsList .item');
            
            items.forEach(item => {
                const tripDate = item.querySelector('.item-name').textContent.split(' - ')[1];
                const tripDateObj = new Date(tripDate.split('/').reverse().join('-'));
                const yearMonth = tripDateObj.toISOString().substring(0, 7);
                
                item.style.display = (!filter || yearMonth === filter) ? 'flex' : 'none';
            });
        }

        // ==================== CALCULATORS ====================
        function calcularFrete() {
            const km = parseFloat(document.getElementById('calc1-km').value) || 0;
            const peso = parseFloat(document.getElementById('calc1-peso').value) || 0;
            const urgencia = document.getElementById('calc1-urgencia').value;
            
            if (km > 0) {
                let basePorKm = 3.50; // Base: R$ 3,50 por km
                let adicionalPeso = peso * 0.50; // R$ 0,50 por tonelada
                let valorBase = (km * basePorKm) + adicionalPeso;
                
                // Aplicar multiplicador de urgência
                switch(urgencia) {
                    case 'urgente':
                        valorBase *= 1.2;
                        break;
                    case 'expressa':
                        valorBase *= 1.5;
                        break;
                }
                
                document.getElementById('result-frete').style.display = 'block';
                document.getElementById('valor-frete').textContent = `R$ ${valorBase.toFixed(2)}`;
            } else {
                document.getElementById('result-frete').style.display = 'none';
            }
        }

        function simularLucro() {
            const receita = parseFloat(document.getElementById('calc2-receita').value) || 0;
            const combustivel = parseFloat(document.getElementById('calc2-combustivel').value) || 0;
            const custos = parseFloat(document.getElementById('calc2-custos').value) || 0;
            
            if (receita > 0) {
                const totalCustos = combustivel + custos;
                const lucro = receita - totalCustos;
                const margem = (lucro / receita) * 100;
                
                document.getElementById('result-lucro').style.display = 'block';
                document.getElementById('valor-lucro').textContent = `R$ ${lucro.toFixed(2)}`;
                document.getElementById('margem-lucro').textContent = `${margem.toFixed(1)}%`;
                
                // Color based on margin
                const valorElement = document.getElementById('valor-lucro');
                if (margem >= 15) {
                    valorElement.style.color = 'var(--success)';
                } else if (margem >= 0) {
                    valorElement.style.color = 'var(--warning)';
                } else {
                    valorElement.style.color = 'var(--danger)';
                }
            } else {
                document.getElementById('result-lucro').style.display = 'none';
            }
        }

        function calcularCombustivel() {
            const km = parseFloat(document.getElementById('calc3-km').value) || 0;
            const consumo = parseFloat(document.getElementById('calc3-consumo').value) || 3.5;
            const preco = parseFloat(document.getElementById('calc3-preco').value) || 6.50;
            
            if (km > 0) {
                const litros = km / consumo;
                const custo = litros * preco;
                
                document.getElementById('result-combustivel').style.display = 'block';
                document.getElementById('valor-combustivel').textContent = `R$ ${custo.toFixed(2)}`;
                document.getElementById('litros-combustivel').textContent = `${litros.toFixed(1)}L`;
            } else {
                document.getElementById('result-combustivel').style.display = 'none';
            }
        }

        function analisarViabilidade() {
            const receita = parseFloat(document.getElementById('calc4-receita').value) || 0;
            const custos = parseFloat(document.getElementById('calc4-custos').value) || 0;
            const margemMinima = parseFloat(document.getElementById('calc4-margem').value) || 15;
            
            if (receita > 0 && custos >= 0) {
                const lucro = receita - custos;
                const margemReal = (lucro / receita) * 100;
                
                document.getElementById('result-viabilidade').style.display = 'block';
                document.getElementById('margem-real').textContent = `${margemReal.toFixed(1)}%`;
                
                const statusElement = document.getElementById('status-viabilidade');
                const resultElement = document.getElementById('result-viabilidade');
                
                if (margemReal >= margemMinima) {
                    statusElement.textContent = '✅ VIÁVEL';
                    statusElement.style.color = 'var(--success)';
                    resultElement.style.borderColor = 'var(--success)';
                } else if (margemReal >= 0) {
                    statusElement.textContent = '⚠️ ATENÇÃO';
                    statusElement.style.color = 'var(--warning)';
                    resultElement.style.borderColor = 'var(--warning)';
                } else {
                    statusElement.textContent = '❌ INVIÁVEL';
                    statusElement.style.color = 'var(--danger)';
                    resultElement.style.borderColor = 'var(--danger)';
                }
            } else {
                document.getElementById('result-viabilidade').style.display = 'none';
            }
        }

        // ==================== STATS & UPDATES ====================
        function updateStats() {
            const totalRevenue = data.trips.reduce((sum, trip) => sum + trip.receita, 0);
            const totalProfit = data.trips.reduce((sum, trip) => sum + trip.profit, 0);
            const totalKm = data.trips.reduce((sum, trip) => sum + trip.km, 0);
            const avgMargin = totalRevenue > 0 ? (totalProfit / totalRevenue) * 100 : 0;
            const avgPerKm = totalKm > 0 ? totalRevenue / totalKm : 0;
            
            // Dashboard stats
            document.getElementById('totalRevenue').textContent = `R$ ${totalRevenue.toFixed(2)}`;
            document.getElementById('totalProfit').textContent = `R$ ${totalProfit.toFixed(2)}`;
            document.getElementById('avgMargin').textContent = `${avgMargin.toFixed(1)}%`;
            document.getElementById('totalTrips').textContent = data.trips.length;
            document.getElementById('totalKm').textContent = `${totalKm.toFixed(0)} km`;
            document.getElementById('totalClients').textContent = data.clients.length;
            document.getElementById('avgPerKm').textContent = `R$ ${avgPerKm.toFixed(2)}/km`;
            
            // Header quick stats
            document.getElementById('headerClients').textContent = data.clients.length;
            document.getElementById('headerTrips').textContent = data.trips.length;
            document.getElementById('headerRevenue').textContent = `R$ ${totalRevenue.toFixed(0)}`;
            
            // Find top client
            if (data.trips.length > 0) {
                const clientProfits = {};
                data.trips.forEach(trip => {
                    if (!clientProfits[trip.clienteId]) {
                        clientProfits[trip.clienteId] = 0;
                    }
                    clientProfits[trip.clienteId] += trip.profit;
                });
                
                const topClientId = Object.keys(clientProfits).reduce((a, b) => 
                    clientProfits[a] > clientProfits[b] ? a : b
                );
                const topClient = data.clients.find(c => c.id == topClientId);
                document.getElementById('topClient').textContent = topClient ? topClient.razaoSocial : '-';
            }
        }

        function updateAllData() {
            updateClientsList();
            updateSuppliersList();
            updateTripsList();
            updateClientSelect();
            updateStats();
            updateAnalytics();
            updateFinancial();
            updateReports();
        }

        function refreshDashboard() {
            updateStats();
            updateCharts();
            showNotification('🔄 Dashboard atualizado!', 'info');
        }

        // ==================== ANALYTICS ====================
        function updateAnalytics() {
            if (data.trips.length === 0) {
                document.getElementById('analytics-best-client').textContent = '-';
                document.getElementById('analytics-best-route').textContent = '-';
                document.getElementById('analytics-fuel-avg').textContent = 'R$ 0,00';
                document.getElementById('analytics-monthly-growth').textContent = '+0%';
                return;
            }
            
            // Best client by profit
            const clientProfits = {};
            data.trips.forEach(trip => {
                if (!clientProfits[trip.clienteId]) {
                    clientProfits[trip.clienteId] = { profit: 0, trips: 0 };
                }
                clientProfits[trip.clienteId].profit += trip.profit;
                clientProfits[trip.clienteId].trips += 1;
            });
            
            const bestClientId = Object.keys(clientProfits).reduce((a, b) => 
                clientProfits[a].profit > clientProfits[b].profit ? a : b
            );
            const bestClient = data.clients.find(c => c.id == bestClientId);
            document.getElementById('analytics-best-client').textContent = bestClient ? bestClient.razaoSocial : '-';
            document.getElementById('best-client-profit').textContent = `R$ ${clientProfits[bestClientId].profit.toFixed(2)}`;
            
            // Best route by margin
            const routes = {};
            data.trips.forEach(trip => {
                const route = `${trip.origem} → ${trip.destino}`;
                if (!routes[route]) {
                    routes[route] = { totalRevenue: 0, totalProfit: 0, trips: 0 };
                }
                routes[route].totalRevenue += trip.receita;
                routes[route].totalProfit += trip.profit;
                routes[route].trips += 1;
            });
            
            let bestRoute = '';
            let bestMargin = 0;
            Object.keys(routes).forEach(route => {
                const margin = routes[route].totalRevenue > 0 ? 
                    (routes[route].totalProfit / routes[route].totalRevenue) * 100 : 0;
                if (margin > bestMargin) {
                    bestMargin = margin;
                    bestRoute = route;
                }
            });
            
            document.getElementById('analytics-best-route').textContent = bestRoute || '-';
            document.getElementById('best-route-margin').textContent = `${bestMargin.toFixed(1)}%`;
            
            // Average fuel cost
            const totalFuel = data.trips.reduce((sum, trip) => sum + trip.combustivel, 0);
            const avgFuel = data.trips.length > 0 ? totalFuel / data.trips.length : 0;
            document.getElementById('analytics-fuel-avg').textContent = `R$ ${avgFuel.toFixed(2)}`;
            
            const totalKm = data.trips.reduce((sum, trip) => sum + trip.km, 0);
            const fuelPerKm = totalKm > 0 ? totalFuel / totalKm : 0;
            document.getElementById('fuel-per-km').textContent = `R$ ${fuelPerKm.toFixed(2)}/km`;
            
            // Monthly growth (simplified)
            document.getElementById('analytics-monthly-growth').textContent = '+12%';
            document.getElementById('growth-trend').textContent = 'crescendo';
        }

        // ==================== FINANCIAL ====================
        function handleExpenseSubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const expense = {
                id: Date.now(),
                tipo: formData.get('tipo'),
                valor: parseFloat(formData.get('valor')),
                data: formData.get('data'),
                descricao: formData.get('descricao'),
                createdAt: new Date().toISOString()
            };
            
            data.expenses.push(expense);
            saveData();
            
            e.target.reset();
            setTodayDate();
            updateExpensesList();
            updateFinancial();
            
            showNotification('✅ Despesa registrada com sucesso!', 'success');
        }

        function handleGoalsSubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            data.goals = {
                metaReceita: parseFloat(formData.get('metaReceita')) || 0,
                metaViagens: parseInt(formData.get('metaViagens')) || 0,
                metaMargem: parseFloat(formData.get('metaMargem')) || 15
            };
            
            saveData();
            updateGoalsProgress();
            
            showNotification('✅ Metas atualizadas com sucesso!', 'success');
        }

        function updateFinancial() {
            const currentMonth = new Date().toISOString().substring(0, 7);
            const monthlyTrips = data.trips.filter(trip => trip.data.startsWith(currentMonth));
            const monthlyRevenue = monthlyTrips.reduce((sum, trip) => sum + trip.receita, 0);
            const monthlyExpenses = data.expenses.filter(exp => exp.data.startsWith(currentMonth))
                .reduce((sum, exp) => sum + exp.valor, 0);
            const monthlyProfit = monthlyRevenue - monthlyExpenses;
            const profitMargin = monthlyRevenue > 0 ? (monthlyProfit / monthlyRevenue) * 100 : 0;
            
            document.getElementById('financial-revenue').textContent = `R$ ${monthlyRevenue.toFixed(2)}`;
            document.getElementById('financial-expenses').textContent = `R$ ${monthlyExpenses.toFixed(2)}`;
            document.getElementById('financial-profit').textContent = `R$ ${monthlyProfit.toFixed(2)}`;
            document.getElementById('profit-margin').textContent = `${profitMargin.toFixed(1)}%`;
            document.getElementById('financial-balance').textContent = `R$ ${(monthlyProfit * 1.1).toFixed(2)}`;
            
            updateGoalsProgress();
        }

        function updateGoalsProgress() {
            const currentMonth = new Date().toISOString().substring(0, 7);
            const monthlyTrips = data.trips.filter(trip => trip.data.startsWith(currentMonth));
            const monthlyRevenue = monthlyTrips.reduce((sum, trip) => sum + trip.receita, 0);
            
            // Revenue goal progress
            const revenueProgress = data.goals.metaReceita > 0 ? 
                (monthlyRevenue / data.goals.metaReceita) * 100 : 0;
            document.getElementById('goal-revenue-progress').textContent = `${Math.min(revenueProgress, 100).toFixed(0)}%`;
            document.getElementById('goal-revenue-status').textContent = 
                `R$ ${monthlyRevenue.toFixed(0)} / R$ ${data.goals.metaReceita.toFixed(0)}`;
            
            // Trips goal progress
            const tripsProgress = data.goals.metaViagens > 0 ? 
                (monthlyTrips.length / data.goals.metaViagens) * 100 : 0;
            document.getElementById('goal-trips-progress').textContent = `${Math.min(tripsProgress, 100).toFixed(0)}%`;
            document.getElementById('goal-trips-status').textContent = 
                `${monthlyTrips.length} / ${data.goals.metaViagens} viagens`;
        }

        function updateExpensesList() {
            const container = document.getElementById('expensesList');
            
            if (data.expenses.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-receipt"></i>
                        <h3>Nenhuma despesa registrada</h3>
                        <p>Registre suas despesas para ter controle total dos custos</p>
                    </div>
                `;
                return;
            }
            
            const sortedExpenses = [...data.expenses].sort((a, b) => new Date(b.data) - new Date(a.data));
            
            container.innerHTML = sortedExpenses.map(expense => `
                <div class="item">
                    <div class="item-info">
                        <div class="item-name">${expense.tipo} - R$ ${expense.valor.toFixed(2)}</div>
                        <div class="item-details">
                            ${new Date(expense.data).toLocaleDateString('pt-BR')} | ${expense.descricao || 'Sem descrição'}
                        </div>
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-sm btn-danger" onclick="deleteExpense(${expense.id})">
                            <i class="fas fa-trash"></i> Excluir
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function deleteExpense(id) {
            if (confirm('Tem certeza que deseja excluir esta despesa?')) {
                data.expenses = data.expenses.filter(e => e.id !== id);
                saveData();
                updateExpensesList();
                updateFinancial();
                showNotification('✅ Despesa excluída com sucesso!', 'success');
            }
        }

        // ==================== REPORTS ====================
        function updateReports() {
            const totalRevenue = data.trips.reduce((sum, trip) => sum + trip.receita, 0);
            const totalProfit = data.trips.reduce((sum, trip) => sum + trip.profit, 0);
            const totalKm = data.trips.reduce((sum, trip) => sum + trip.km, 0);
            const avgMargin = totalRevenue > 0 ? (totalProfit / totalRevenue) * 100 : 0;
            const avgPerTrip = data.trips.length > 0 ? totalKm / data.trips.length : 0;
            const avgPerKm = totalKm > 0 ? totalRevenue / totalKm : 0;
            const avgPerMonth = data.trips.length > 0 ? data.trips.length / 12 : 0; // Simplified
            
            document.getElementById('report-total-trips').textContent = data.trips.length;
            document.getElementById('report-total-km').textContent = `${totalKm.toFixed(0)} km`;
            document.getElementById('report-total-revenue').textContent = `R$ ${totalRevenue.toFixed(2)}`;
            document.getElementById('report-total-profit').textContent = `R$ ${totalProfit.toFixed(2)}`;
            document.getElementById('report-avg-month').textContent = avgPerMonth.toFixed(1);
            document.getElementById('report-avg-per-trip').textContent = `${avgPerTrip.toFixed(0)} km`;
            document.getElementById('report-avg-per-km').textContent = `R$ ${avgPerKm.toFixed(2)}/km`;
            document.getElementById('report-margin').textContent = `${avgMargin.toFixed(1)}%`;
        }

        // ==================== EXPORT FUNCTIONS ====================
        function exportClients() {
            if (data.clients.length === 0) {
                showNotification('❌ Nenhum cliente para exportar', 'error');
                return;
            }
            
            let csv = 'Razão Social,Nome Fantasia,CNPJ,Cidade,Estado,Telefone,Email\n';
            data.clients.forEach(client => {
                csv += `"${client.razaoSocial}","${client.nomeFantasia || ''}","${client.cnpj || ''}","${client.cidade || ''}","${client.estado || ''}","${client.celular || client.telefoneFixo || ''}","${client.email || ''}"\n`;
            });
            
            showExportData(csv);
        }

        function exportSuppliers() {
            if (data.suppliers.length === 0) {
                showNotification('❌ Nenhum fornecedor para exportar', 'error');
                return;
            }
            
            let csv = 'Razão Social,Tipo de Serviço,Cidade,Telefone,Email,Contato\n';
            data.suppliers.forEach(supplier => {
                csv += `"${supplier.razaoSocial}","${supplier.tipoServico}","${supplier.cidade || ''}","${supplier.telefone || ''}","${supplier.email || ''}","${supplier.contato || ''}"\n`;
            });
            
            showExportData(csv);
        }

        function exportTrips() {
            if (data.trips.length === 0) {
                showNotification('❌ Nenhuma viagem para exportar', 'error');
                return;
            }
            
            let csv = 'Data,Cliente,Origem,Destino,KM,Receita,Combustível,Outros Custos,Lucro,Margem\n';
            data.trips.forEach(trip => {
                const client = data.clients.find(c => c.id === trip.clienteId);
                const clientName = client ? client.razaoSocial : 'Cliente não encontrado';
                csv += `"${trip.data}","${clientName}","${trip.origem}","${trip.destino}",${trip.km},${trip.receita},${trip.combustivel},${trip.totalCosts - trip.combustivel},${trip.profit},${trip.margin.toFixed(2)}\n`;
            });
            
            showExportData(csv);
        }

        function exportComplete() {
            const totalRevenue = data.trips.reduce((sum, trip) => sum + trip.receita, 0);
            const totalProfit = data.trips.reduce((sum, trip) => sum + trip.profit, 0);
            const totalKm = data.trips.reduce((sum, trip) => sum + trip.km, 0);
            
            let output = '=== RELATÓRIO COMPLETO - TRANSCS PRO ULTIMATE v5.0 ===\n\n';
            output += `Gerado em: ${new Date().toLocaleString('pt-BR')}\n\n`;
            
            // Summary
            output += 'RESUMO EXECUTIVO:\n';
            output += `• Clientes Cadastrados: ${data.clients.length}\n`;
            output += `• Fornecedores: ${data.suppliers.length}\n`;
            output += `• Total de Viagens: ${data.trips.length}\n`;
            output += `• Quilometragem Total: ${totalKm.toFixed(1)} km\n`;
            output += `• Receita Acumulada: R$ ${totalRevenue.toFixed(2)}\n`;
            output += `• Lucro Acumulado: R$ ${totalProfit.toFixed(2)}\n`;
            output += `• Margem Média: ${totalRevenue > 0 ? ((totalProfit / totalRevenue) * 100).toFixed(1) : 0}%\n\n`;
            
            // Top clients
            if (data.trips.length > 0) {
                const clientProfits = {};
                data.trips.forEach(trip => {
                    if (!clientProfits[trip.clienteId]) {
                        clientProfits[trip.clienteId] = 0;
                    }
                    clientProfits[trip.clienteId] += trip.profit;
                });
                
                output += 'TOP CLIENTES POR LUCRO:\n';
                Object.keys(clientProfits)
                    .sort((a, b) => clientProfits[b] - clientProfits[a])
                    .slice(0, 5)
                    .forEach((clientId, index) => {
                        const client = data.clients.find(c => c.id == clientId);
                        if (client) {
                            output += `${index + 1}. ${client.razaoSocial}: R$ ${clientProfits[clientId].toFixed(2)}\n`;
                        }
                    });
                output += '\n';
            }
            
            // Recent trips
            if (data.trips.length > 0) {
                output += 'ÚLTIMAS VIAGENS:\n';
                [...data.trips]
                    .sort((a, b) => new Date(b.data) - new Date(a.data))
                    .slice(0, 10)
                    .forEach(trip => {
                        const client = data.clients.find(c => c.id === trip.clienteId);
                        const clientName = client ? client.razaoSocial : 'Cliente não encontrado';
                        output += `• ${trip.data} | ${clientName} | ${trip.origem} → ${trip.destino} | ${trip.km} km | R$ ${trip.receita.toFixed(2)} (Lucro: R$ ${trip.profit.toFixed(2)})\n`;
                    });
            }
            
            showExportData(output);
        }

        function showExportData(data) {
            const textarea = document.getElementById('exportData');
            textarea.value = data;
            textarea.style.display = 'block';
            textarea.select();
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(data).then(() => {
                    showNotification('📋 Dados copiados para a área de transferência!', 'success');
                });
            } else {
                showNotification('📄 Dados exibidos abaixo. Selecione e copie manualmente.', 'success');
            }
        }

        // ==================== CHARTS ====================
        function initializeCharts() {
            // Revenue Chart
            const revenueCtx = document.getElementById('revenueChart');
            if (revenueCtx && !charts.revenue) {
                charts.revenue = new Chart(revenueCtx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'Receita (R$)',
                            data: [12000, 15000, 18000, 16000, 22000, 25000],
                            borderColor: 'rgb(37, 99, 235)',
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return 'R$ ' + value.toLocaleString();
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Client Chart
            const clientCtx = document.getElementById('clientChart');
            if (clientCtx && !charts.client) {
                charts.client = new Chart(clientCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Cliente A', 'Cliente B', 'Cliente C', 'Outros'],
                        datasets: [{
                            data: [35, 25, 20, 20],
                            backgroundColor: [
                                'rgb(37, 99, 235)',
                                'rgb(16, 185, 129)',
                                'rgb(139, 92, 246)',
                                'rgb(245, 158, 11)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
            
            updateCharts();
        }

        function updateCharts() {
            // Update charts with real data when needed
            if (data.trips.length > 0 && charts.revenue) {
                // This would update with real monthly data
            }
        }

        // ==================== UTILITY FUNCTIONS ====================
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const text = document.getElementById('notificationText');
            
            text.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        function buscarCEP(cep) {
            cep = cep.replace(/\D/g, '');
            if (cep.length === 8) {
                fetch(`https://viacep.com.br/ws/${cep}/json/`)
                    .then(response => response.json())
                    .then(data => {
                        if (!data.erro) {
                            document.querySelector('input[name="logradouro"]').value = data.logradouro;
                            document.querySelector('input[name="bairro"]').value = data.bairro;
                            document.querySelector('input[name="cidade"]').value = data.localidade;
                            document.querySelector('select[name="estado"]').value = data.uf;
                        }
                    })
                    .catch(() => {
                        // Silently fail - CEP API may not be available
                    });
            }
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const icon = document.getElementById('themeIcon');
            icon.className = document.body.classList.contains('dark-mode') ? 'fas fa-sun' : 'fas fa-moon';
            
            // Save theme preference
            localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
        }

        function generateInviteLink() {
            const userType = document.getElementById('inviteUserType').value;
            const code = 'INV-' + Math.random().toString(36).substr(2, 8).toUpperCase();
            const link = `${window.location.origin}${window.location.pathname}?invite=${code}&role=${userType}`;
            
            document.getElementById('inviteLink').value = link;
            document.getElementById('inviteResult').classList.remove('hidden');
            
            showNotification('🔗 Link de convite gerado com sucesso!', 'success');
        }

        function copyInviteLink() {
            const input = document.getElementById('inviteLink');
            input.select();
            navigator.clipboard.writeText(input.value).then(() => {
                showNotification('📋 Link copiado para a área de transferência!', 'success');
            });
        }

        function handleCompanySubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            data.company = {
                razaoSocial: formData.get('razaoSocial'),
                nomeFantasia: formData.get('nomeFantasia'),
                cnpj: formData.get('cnpj'),
                telefone: formData.get('telefone'),
                email: formData.get('email'),
                website: formData.get('website')
            };
            
            saveData();
            showNotification('✅ Dados da empresa salvos com sucesso!', 'success');
        }

        function clearAllData() {
            if (confirm('⚠️ ATENÇÃO: Esta ação irá apagar TODOS os dados do sistema. Tem certeza?')) {
                if (confirm('🚨 CONFIRMAÇÃO FINAL: Todos os clientes, fornecedores, viagens e configurações serão perdidos permanentemente. Continuar?')) {
                    localStorage.clear();
                    showNotification('🗑️ Todos os dados foram limpos!', 'warning');
                    setTimeout(() => {
                        window.location.reload();
                    }, 2000);
                }
            }
        }

        function exportBackup() {
            const backup = {
                version: '5.0',
                exportDate: new Date().toISOString(),
                data: data
            };
            
            const dataStr = JSON.stringify(backup, null, 2);
            showExportData(dataStr);
            showNotification('📦 Backup completo gerado!', 'info');
        }

        // ==================== INITIALIZE APP ====================
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved theme
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                document.getElementById('themeIcon').className = 'fas fa-sun';
            }
            
            init();
        });
    </script>
</body>
</html>
