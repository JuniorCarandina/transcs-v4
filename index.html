// ==================== FINANCIAL MANAGEMENT ====================
        function handleRevenueSubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const revenue = {
                id: Date.now(),
                type: 'receita',
                fornecedor: formData.get('fornecedor'),
                dataCompetencia: formData.get('dataCompetencia'),
                descricao: formData.get('descricao'),
                valor: parseFloat(formData.get('valor')),
                categoria: formData.get('categoria'),
                centroCusto: formData.get('centroCusto'),
                codigoReferencia: formData.get('codigoReferencia'),
                repetirLancamento: formData.get('repetirLancamento') === 'on',
                tipoRepeticao: formData.get('tipoRepeticao'),
                diaSemana: formData.get('diaSemana'),
                primeiroVencimento: formData.get('primeiroVencimento'),
                formaPagamento: formData.get('formaPagamento'),
                contaPagamento: formData.get('contaPagamento'),
                createdAt: new Date().toISOString()
            };
            
            data.financialEntries.push(revenue);
            saveData();
            
            e.target.reset();
            setTodayDate();
            updateFinancialEntriesList();
            updateFinancial();
            
            showNotification('‚úÖ Receita cadastrada com sucesso!', 'success');
        }

        function handleNewExpenseSubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const expense = {
                id: Date.now(),
                type: 'despesa',
                fornecedor: formData.get('fornecedor'),
                dataCompetencia: formData.get('dataCompetencia'),
                descricao: formData.get('descricao'),
                valor: parseFloat(formData.get('valor')),
                categoria: formData.get('categoria'),
                centroCusto: formData.get('centroCusto'),
                codigoReferencia: formData.get('codigoReferencia'),
                repetirLancamento: formData.get('repetirLancamento') === 'on',
                tipoRepeticao: formData.get('tipoRepeticao'),
                diaSemana: formData.get('diaSemana'),
                primeiroVencimento: formData.get('primeiroVencimento'),
                formaPagamento: formData.get('formaPagamento'),
                contaPagamento: formData.get('contaPagamento'),
                createdAt: new Date().toISOString()
            };
            
            data.financialEntries.push(expense);
            saveData();
            
            e.target.reset();
            setTodayDate();
            updateFinancialEntriesList();
            updateFinancial();
            
            showNotification('‚úÖ Despesa cadastrada com sucesso!', 'success');
        }

        function updateFinancialEntriesList() {
            const container = document.getElementById('financialEntriesList');
            
            if (data.financialEntries.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-money-bill-wave"></i>
                        <h3>Nenhum lan√ßamento registrado</h3>
                        <p>Adicione receitas e despesas para come√ßar o controle financeiro</p>
                    </div>
                `;
                return;
            }
            
            const sortedEntries = [...data.financialEntries].sort((a, b) => new Date(b.dataCompetencia) - new Date(a.dataCompetencia));
            
            container.innerHTML = sortedEntries.map(entry => {
                const fornecedorName = getFornecedorName(entry.fornecedor);
                const date = new Date(entry.dataCompetencia).toLocaleDateString('pt-BR');
                const isReceita = entry.type === 'receita';
                const icon = isReceita ? 'fas fa-arrow-up' : 'fas fa-arrow-down';
                const colorClass = isReceita ? 'positive' : 'negative';
                const typeText = isReceita ? 'RECEITA' : 'DESPESA';
                
                return `
                    <div class="item">
                        <div class="item-info">
                            <div class="item-name">
                                <span class="stat-change ${colorClass}" style="display: inline-block; padding: 0.2rem 0.5rem; margin-right: 1rem;">
                                    <i class="${icon}"></i> ${typeText}
                                </span>
                                ${entry.descricao}
                            </div>
                            <div class="item-details">
                                üìÖ ${date} | üè¢ ${fornecedorName} | üìÇ ${entry.categoria}<br>
                                üí∞ R$ ${entry.valor.toFixed(2)} | üîó ${entry.codigoReferencia || 'Sem c√≥digo'} | üí≥ ${entry.formaPagamento || 'N√£o informado'}
                            </div>
                        </div>
                        <div class="item-actions">
                            <button class="btn btn-sm btn-outline" onclick="editFinancialEntry(${entry.id})">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteFinancialEntry(${entry.id})">
                                <i class="fas fa-trash"></i> Excluir
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getFornecedorName(fornecedorId) {
            if (!fornecedorId) return 'N√£o informado';
            
            const client = data.clients.find(c => c.id == fornecedorId);
            if (client) return client.razaoSocial;
            
            const supplier = data.suppliers.find(s => s.id == fornecedorId);
            if (supplier) return supplier.razaoSocial;
            
            return 'Fornecedor n√£o encontrado';
        }

        function deleteFinancialEntry(id) {
            if (confirm('Tem certeza que deseja excluir este lan√ßamento?')) {
                data.financialEntries = data.financialEntries.filter(e => e.id !== id);
                saveData();
                updateFinancialEntriesList();
                updateFinancial();
                showNotification('‚úÖ Lan√ßamento exclu√≠do com sucesso!', 'success');
            }
        }

        function filterEntries() {
            const filter = document.getElementById('entryFilter').value;
            const items = document.querySelectorAll('#financialEntriesList .item');
            
            items.forEach(item => {
                const typeSpan = item.querySelector('.stat-change');
                const isReceita = typeSpan.textContent.includes('RECEITA');
                const isDespesa = typeSpan.textContent.includes('DESPESA');
                
                let show = true;
                if (filter === 'receita' && !isReceita) show = false;
                if (filter === 'despesa' && !isDespesa) show = false;
                
                item.style.display = show ? 'flex' : 'none';
            });
        }

        function exportFinancialEntries() {
            if (data.financialEntries.length === 0) {
                showNotification('‚ùå Nenhum lan√ßamento para exportar', 'error');
                return;
            }
            
            let csv = 'Tipo,Data,Descri√ß√£o,Categoria,Valor,Fornecedor,Forma Pagamento,C√≥digo Refer√™ncia\n';
            data.financialEntries.forEach(entry => {
                const fornecedorName = getFornecedorName(entry.fornecedor);
                csv += `"${entry.type}","${entry.dataCompetencia}","${entry.descricao}","${entry.categoria}",${entry.valor},"${fornecedorName}","${entry.formaPagamento || ''}","${entry.codigoReferencia || ''}"\n`;
            });
            
            showExportData(csv);
        }

        function toggleRateio(checkbox) {
            // Fun√ß√£o para habilitar/desabilitar rateio (futura implementa√ß√£o)
            console.log('Rateio:', checkbox.checked);
        }

        function toggleRepeticao(checkbox) {
            const form = checkbox.closest('form');
            const configDiv = form.querySelector('[id*="configRepeticao"]');
            
            if (configDiv) {
                configDiv.style.display = checkbox.checked ? 'block' : 'none';
            }
        }                <div id="financial-expenses" class="tab-content">
                    <div class="tab-container">
                        <div class="tab-nav">
                            <button class="tab-btn active" onclick="showTab('revenue-form', this)">
                                <i class="fas fa-plus-circle"></i> Nova Receita
                            </button>
                            <button class="tab-btn" onclick="showTab('expense-form', this)">
                                <i class="fas fa-minus-circle"></i> Nova Despesa
                            </button>
                            <button class="tab-btn" onclick="showTab('financial-entries-list', this)">
                                <i class="fas fa-list"></i> Lan√ßamentos
                            </button>
                        </div>

                        <!-- NOVA RECEITA -->
                        <div id="revenue-form" class="tab-content active">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">
                                        <i class="fas fa-plus-circle"></i> Adicionar Nova Receita
                                    </h3>
                                </div>
                                <div class="card-body">
                                    <form id="revenueForm">
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label class="form-label">Fornecedor/Cliente</label>
                                                <select class="form-select" name="fornecedor">
                                                    <option value="">Selecione...</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Data de compet√™ncia *</label>
                                                <input type="date" class="form-input" name="dataCompetencia" required>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Descri√ß√£o *</label>
                                                <input type="text" class="form-input" name="descricao" placeholder="Descri√ß√£o da receita" required>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Valor *</label>
                                                <div style="display: flex; align-items: center;">
                                                    <span style="padding: 0.75rem; background: var(--gray-light); border: 2px solid var(--gray-light); border-right: none; border-radius: var(--border-radius) 0 0 var(--border-radius); font-weight: 600;">R$</span>
                                                    <input type="number" class="form-input" name="valor" placeholder="0,00" step="0.01" style="border-radius: 0 var(--border-radius) var(--border-radius) 0; border-left: none;" required>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-row">
                                            <div class="form-group">
                                                <label class="form-label">
                                                    <input type="checkbox" name="habilitarRateio" onchange="toggleRateio(this)"> 
                                                    Habilitar rateio
                                                </label>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Categoria *</label>
                                                <select class="form-select" name="categoria" required>
                                                    <option value="">Selecione...</option>
                                                    <option value="Frete">Frete</option>
                                                    <option value="Servi√ßos">Servi√ßos</option>
                                                    <option value="Vendas">Vendas</option>
                                                    <option value="Outros">Outros</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Centro de custo</label>
                                                <select class="form-select" name="centroCusto">
                                                    <option value="">Selecione...</option>
                                                    <option value="Operacional">Operacional</option>
                                                    <option value="Administrativo">Administrativo</option>
                                                    <option value="Vendas">Vendas</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">C√≥digo de refer√™ncia</label>
                                                <input type="text" class="form-input" name="codigoReferencia" placeholder="C√≥digo/NF">
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">
                                                <input type="checkbox" name="repetirLancamento" onchange="toggleRepeticao(this)"> 
                                                Repetir lan√ßamento?
                                            </label>
                                        </div>

                                        <div id="configRepeticao" style="display: none; margin-top: 1rem; padding: 1rem; background: var(--gray-light); border-radius: var(--border-radius);">
                                            <div class="form-group">
                                                <label class="form-label">Configura√ß√µes de repeti√ß√£o *</label>
                                                <select class="form-select" name="tipoRepeticao">
                                                    <option value="semanal">Semanal: A cada 1 semana(s), 48 vez(es)</option>
                                                    <option value="mensal">Mensal: A cada 1 m√™s(es), 12 vez(es)</option>
                                                    <option value="anual">Anual: A cada 1 ano(s), 5 vez(es)</option>
                                                </select>
                                            </div>
                                        </div>

                                        <h4 style="margin: 2rem 0 1rem; color: var(--primary); font-weight: 700;">üí∞ Condi√ß√£o de pagamento</h4>
                                        
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label class="form-label">Cobrar sempre no</label>
                                                <select class="form-select" name="diaSemana">
                                                    <option value="segunda">Segunda-feira</option>
                                                    <option value="terca">Ter√ßa-feira</option>
                                                    <option value="quarta">Quarta-feira</option>
                                                    <option value="quinta">Quinta-feira</option>
                                                    <option value="sexta">Sexta-feira</option>
                                                    <option value="sabado">S√°bado</option>
                                                    <option value="domingo">Domingo</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">1¬∫ vencimento *</label>
                                                <input type="date" class="form-input" name="primeiroVencimento" required>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Forma de pagamento</label>
                                                <select class="form-select" name="formaPagamento">
                                                    <option value="">Selecione...</option>
                                                    <option value="dinheiro">Dinheiro</option>
                                                    <option value="pix">PIX</option>
                                                    <option value="transferencia">Transfer√™ncia</option>
                                                    <option value="cartao">Cart√£o</option>
                                                    <option value="boleto">Boleto</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Conta de pagamento</label>
                                                <select class="form-select" name="contaPagamento">
                                                    <option value="conta-corrente">CONTA CORRENTE</option>
                                                    <option value="poupanca">POUPAN√áA</option>
                                                    <option value="caixa">CAIXA</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div style="margin-top: 2rem;">
                                            <button type="submit" class="btn btn-secondary">
                                                <i class="fas fa-save"></i> Salvar Receita
                                            </button>
                                            <button type="button" class="btn btn-outline" onclick="document.getElementById('revenueForm').reset()">
                                                <i class="fas fa-eraser"></i> Limpar
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                                                                <div id="expense-form" class="tab-content">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">
                                        <i class="fas fa-minus-circle"></i> Adicionar Nova Despesa
                                    </h3>
                                </div>
                                <div class="card-body">
                                    <form id="newExpenseForm">
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label class="form-label">Fornecedor</label>
                                                <select class="form-select" name="fornecedor">
                                                    <option value="">Selecione...</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Data de compet√™ncia *</label>
                                                <input type="date" class="form-input" name="dataCompetencia" required>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Descri√ß√£o *</label>
                                                <input type="text" class="form-input" name="descricao" placeholder="Descri√ß√£o da despesa" required>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Valor *</label>
                                                <div style="display: flex; align-items: center;">
                                                    <span style="padding: 0.75rem; background: var(--gray-light); border: 2px solid var(--gray-light); border-right: none; border-radius: var(--border-radius) 0 0 var(--border-radius); font-weight: 600;">R$</span>
                                                    <input type="number" class="form-input" name="valor" placeholder="0,00" step="0.01" style="border-radius: 0 var(--border-radius) var(--border-radius) 0; border-left: none;" required>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-row">
                                            <div class="form-group">
                                                <label class="form-label">
                                                    <input type="checkbox" name="habilitarRateio" onchange="toggleRateio(this)"> 
                                                    Habilitar rateio
                                                </label>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Categoria *</label>
                                                <select class="form-select" name="categoria" required>
                                                    <option value="">Selecione...</option>
                                                    <option value="Combust√≠vel">Combust√≠vel</option>
                                                    <option value="Manuten√ß√£o">Manuten√ß√£o</option>
                                                    <option value="Seguro">Seguro</option>
                                                    <option value="IPVA">IPVA</option>
                                                    <option value="Financiamento">Financiamento</option>
                                                    <option value="Pedagio">Ped√°gio</option>
                                                    <option value="Alimentacao">Alimenta√ß√£o</option>
                                                    <option value="Hospedagem">Hospedagem</option>
                                                    <option value="Outros">Outros</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Centro de custo</label>
                                                <select class="form-select" name="centroCusto">
                                                    <option value="">Selecione...</option>
                                                    <option value="Operacional">Operacional</option>
                                                    <option value="Administrativo">Administrativo</option>
                                                    <option value="Manuten√ß√£o">Manuten√ß√£o</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">C√≥digo de refer√™ncia</label>
                                                <input type="text" class="form-input" name="codigoReferencia" placeholder="C√≥digo/NF">
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">
                                                <input type="checkbox" name="repetirLancamento" onchange="toggleRepeticao(this)"> 
                                                Repetir lan√ßamento?
                                            </label>
                                        </div>

                                        <div id="configRepeticaoDespesa" style="display: none; margin-top: 1rem; padding: 1rem; background: var(--gray-light); border-radius: var(--border-radius);">
                                            <div class="form-group">
                                                <label class="form-label">Configura√ß√µes de repeti√ß√£o *</label>
                                                <select class="form-select" name="tipoRepeticao">
                                                    <option value="semanal">Semanal: A cada 1 semana(s), 48 vez(es)</option>
                                                    <option value="mensal">Mensal: A cada 1 m√™s(es), 12 vez(es)</option>
                                                    <option value="anual">Anual: A cada 1 ano(s), 5 vez(es)</option>
                                                </select>
                                            </div>
                                        </div>

                                        <h4 style="margin: 2rem 0 1rem; color: var(--danger); font-weight: 700;">üí≥ Condi√ß√£o de pagamento</h4>
                                        
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label class="form-label">Cobrar sempre no</label>
                                                <select class="form-select" name="diaSemana">
                                                    <option value="segunda">Segunda-feira</option>
                                                    <option value="terca">Ter√ßa-feira</option>
                                                    <option value="quarta">Quarta-feira</option>
                                                    <option value="quinta">Quinta-feira</option>
                                                    <option value="sexta">Sexta-feira</option>
                                                    <option value="sabado">S√°bado</option>
                                                    <option value="domingo">Domingo</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">1¬∫ vencimento *</label>
                                                <input type="date" class="form-input" name="primeiroVencimento" required>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Forma de pagamento</label>
                                                <select class="form-select" name="formaPagamento">
                                                    <option value="">Selecione...</option>
                                                    <option value="dinheiro">Dinheiro</option>
                                                    <option value="pix">PIX</option>
                                                    <option value="transferencia">Transfer√™ncia</option>
                                                    <option value="cartao">Cart√£o</option>
                                                    <option value="boleto">Boleto</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Conta de pagamento</label>
                                                <select class="form-select" name="contaPagamento">
                                                    <option value="conta-corrente">CONTA CORRENTE</option>
                                                    <option value="poupanca">POUPAN√áA</option>
                                                    <option value="caixa">CAIXA</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div style="margin-top: 2rem;">
                                            <button type="submit" class="btn btn-danger">
                                                <i class="fas fa-save"></i> Salvar Despesa
                                            </button>
                                            <button type="button" class="btn btn-outline" onclick="document.getElementById('newExpenseForm').reset()">
                                                <i class="fas fa-eraser"></i> Limpar
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- LISTA DE LAN√áAMENTOS -->
                        <div id="financial-entries-list" class="tab-content">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">
                                        <i class="fas fa-list"></i> Lan√ßamentos Financeiros
                                    </h3>
                                    <div style="display: flex; gap: 1rem;">
                                        <select class="form-select" id="entryFilter" onchange="filterEntries()" style="width: 200px;">
                                            <option value="">Todos os tipos</option>
                                            <option value="receita">Receitas</option>
                                            <option value="despesa">Despesas</option>
                                        </select>
                                        <button class="btn btn-outline btn-sm" onclick="exportFinancialEntries()">
                                            <i class="fas fa-download"></i> Exportar
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div id="financialEntriesList">
                                        <div class="empty-state">
                                            <i class="fas fa-money-bill-wave"></i>
                                            <h3>Nenhum lan√ßamento registrado</h3>
                                            <p>Adicione receitas e despesas para come√ßar o controle financeiro</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
