<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TransCS Pro Ultimate v5.1 - Sistema com Usu√°rios</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.min.js"></script>
    
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --primary-light: #60a5fa;
            --secondary: #10b981;
            --accent: #8b5cf6;
            --warning: #f59e0b;
            --danger: #ef4444;
            --success: #10b981;
            --info: #06b6d4;
            --dark: #1f2937;
            --gray: #6b7280;
            --gray-light: #f3f4f6;
            --gray-dark: #374151;
            --white: #ffffff;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark);
            line-height: 1.6;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--white);
            min-height: 100vh;
            box-shadow: var(--shadow-xl);
            position: relative;
        }

        .dark-mode .tab-btn.active {
            background: var(--dark);
            color: var(--primary-light);
        }

        .tab-content {
            display: none;
            padding: 2rem;
        }

        .tab-content.active {
            display: block;
        }

        /* UTILITIES */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .text-left { text-align: left; }
        .font-bold { font-weight: 700; }
        .font-semibold { font-weight: 600; }
        .hidden { display: none !important; }
        .block { display: block !important; }
        .flex { display: flex !important; }
        .grid { display: grid !important; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-1 { gap: 0.25rem; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mt-4 { margin-top: 1rem; }
        .w-full { width: 100%; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* RESPONSIVE */
        @media (max-width: 1200px) {
            .header-content {
                grid-template-columns: 1fr auto;
                gap: 1.5rem;
            }

            .header-stats {
                display: none;
            }

            .chart-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .login-box {
                margin: 1rem;
                padding: 2rem;
                max-width: calc(100% - 2rem);
            }

            .header {
                padding: 1.5rem;
            }

            .header-content {
                grid-template-columns: 1fr;
                text-align: center;
                gap: 1rem;
            }

            .header-left h1 {
                font-size: 2rem;
                flex-direction: column;
                gap: 0.5rem;
            }

            .nav-tabs {
                overflow-x: auto;
                scrollbar-width: thin;
            }

            .nav-btn {
                min-width: 140px;
                font-size: 0.85rem;
                padding: 1rem 1.5rem;
            }

            .page {
                padding: 1rem;
            }

            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .chart-grid {
                grid-template-columns: 1fr;
            }

            .item {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .item-actions {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 1rem;
            }

            .header-left h1 {
                font-size: 1.75rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .nav-btn {
                font-size: 0.8rem;
                padding: 0.875rem 1rem;
            }

            .btn {
                padding: 0.75rem 1.25rem;
                font-size: 0.9rem;
            }

            .btn-sm {
                padding: 0.5rem 0.75rem;
                font-size: 0.8rem;
            }

            .card-body {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- LOGIN SCREEN -->
    <div id="loginScreen" class="login-screen">
        <div class="login-box">
            <div class="login-content">
                <div class="login-logo">
                    <i class="fas fa-truck"></i>
                    <h1>TransCS Pro Ultimate</h1>
                    <div class="version">v5.1</div>
                    <p style="margin-top: 1rem; color: var(--gray);">Sistema com Controle de Usu√°rios</p>
                </div>
                
                <!-- Login Form -->
                <form id="loginForm">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-user"></i> Usu√°rio
                        </label>
                        <input type="text" class="form-input" id="username" placeholder="Digite seu usu√°rio" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-lock"></i> Senha
                        </label>
                        <input type="password" class="form-input" id="password" placeholder="Digite sua senha" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-sign-in-alt"></i> Entrar no Sistema
                    </button>
                    
                    <div style="text-align: center; margin-top: 1rem;">
                        <a href="#" class="switch-link" onclick="showRegisterForm()">
                            Recebeu um convite? Cadastre-se aqui
                        </a>
                    </div>
                </form>

                <!-- Register Form (Hidden) -->
                <form id="registerForm" class="hidden">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-user"></i> Nome Completo
                        </label>
                        <input type="text" class="form-input" name="fullName" placeholder="Seu nome completo" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-envelope"></i> Email
                        </label>
                        <input type="email" class="form-input" name="email" placeholder="seu@email.com" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-user-circle"></i> Nome de Usu√°rio
                        </label>
                        <input type="text" class="form-input" name="username" placeholder="Nome de usu√°rio √∫nico" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-lock"></i> Senha
                        </label>
                        <input type="password" class="form-input" name="password" placeholder="Senha segura" minlength="4" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-key"></i> C√≥digo de Convite
                        </label>
                        <input type="text" class="form-input" name="inviteCode" placeholder="Cole o c√≥digo de convite aqui" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-user-plus"></i> Criar Conta
                    </button>
                    
                    <div style="text-align: center; margin-top: 1rem;">
                        <a href="#" class="switch-link" onclick="showLoginForm()">
                            Voltar ao login
                        </a>
                    </div>
                </form>
                
                <div class="info-box">
                    <div class="alert-title"><strong>üîë Usu√°rio Padr√£o:</strong></div>
                    <strong>Usu√°rio:</strong> admin<br>
                    <strong>Senha:</strong> 123<br><br>
                    <em>üéØ Sistema com login individual, edi√ß√£o de perfil e convites por n√≠vel!</em>
                </div>
            </div>
        </div>
    </div>

    <!-- NOTIFICATION -->
    <div id="notification" class="notification">
        <i class="notification-icon fas fa-check-circle"></i>
        <div class="notification-content">
            <span id="notificationText">Mensagem</span>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="app" class="container app">
        <!-- HEADER -->
        <div class="header">
            <div class="header-content">
                <div class="header-left">
                    <h1>
                        <i class="fas fa-truck"></i> 
                        TransCS Pro Ultimate
                        <span class="version-badge">v5.1</span>
                    </h1>
                    <p>Sistema Completo com Controle de Usu√°rios</p>
                </div>
                
                <div class="header-stats">
                    <div class="quick-stat">
                        <div class="quick-stat-value" id="headerClients">0</div>
                        <div class="quick-stat-label">Clientes</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-value" id="headerTrips">0</div>
                        <div class="quick-stat-label">Viagens</div>
                    </div>
                    <div class="quick-stat" id="headerRevenueContainer">
                        <div class="quick-stat-value" id="headerRevenue">R$ 0</div>
                        <div class="quick-stat-label">Receita</div>
                    </div>
                </div>

                <div class="user-panel">
                    <div class="user-info">
                        <div><strong id="userName">Admin</strong></div>
                        <div style="font-size: 0.85rem; opacity: 0.8;" class="user-role">Administrador</div>
                        <div style="font-size: 0.8rem; opacity: 0.7;" id="currentTime"></div>
                    </div>
                    <div class="user-avatar" id="userAvatar">A</div>
                    <button class="theme-toggle" onclick="toggleTheme()" title="Alternar tema">
                        <i class="fas fa-moon" id="themeIcon"></i>
                    </button>
                    <button class="btn btn-sm btn-danger" onclick="logout()" style="margin-left: 1rem;">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </div>
        </div>

        <!-- NAVIGATION -->
        <div class="nav">
            <div class="nav-tabs">
                <button class="nav-btn active" onclick="showPage('dashboard')">
                    <i class="fas fa-chart-line"></i> Dashboard
                </button>
                <button class="nav-btn" onclick="showPage('clients')">
                    <i class="fas fa-users"></i> Clientes
                </button>
                <button class="nav-btn" onclick="showPage('suppliers')">
                    <i class="fas fa-truck-loading"></i> Fornecedores
                </button>
                <button class="nav-btn" onclick="showPage('trips')">
                    <i class="fas fa-truck"></i> Viagens
                </button>
                <button class="nav-btn" onclick="showPage('calculators')">
                    <i class="fas fa-calculator"></i> Calculadoras
                </button>
                <button class="nav-btn" onclick="showPage('analytics')">
                    <i class="fas fa-chart-pie"></i> Analytics
                </button>
                <button class="nav-btn" onclick="showPage('financial')" id="financialNav">
                    <i class="fas fa-dollar-sign"></i> Financeiro
                </button>
                <button class="nav-btn" onclick="showPage('reports')">
                    <i class="fas fa-file-alt"></i> Relat√≥rios
                </button>
                <button class="nav-btn" onclick="showPage('settings')">
                    <i class="fas fa-cog"></i> Configura√ß√µes
                </button>
            </div>
        </div>

        <!-- DASHBOARD PAGE -->
        <div id="dashboard" class="page active">
            <div class="page-header">
                <h2 class="page-title">
                    <i class="fas fa-chart-line"></i> Dashboard Executivo
                </h2>
                <div class="page-actions">
                    <button class="btn btn-secondary btn-sm" onclick="refreshDashboard()">
                        <i class="fas fa-sync-alt"></i> Atualizar
                    </button>
                    <button class="btn btn-primary btn-sm" onclick="showPage('trips')">
                        <i class="fas fa-plus"></i> Nova Viagem
                    </button>
                </div>
            </div>

            <div class="alert alert-success">
                <i class="alert-icon fas fa-rocket"></i>
                <div class="alert-content">
                    <div class="alert-title">üöÄ TransCS Pro Ultimate v5.1 com Sistema de Usu√°rios!</div>
                    Sistema completo com login individual, edi√ß√£o de perfil e controle de acesso por n√≠veis. Tudo funcionando perfeitamente!
                </div>
            </div>

            <div class="stats-grid" id="dashboardStats">
                <div class="stat-card" id="revenueStatCard">
                    <div class="stat-header">
                        <div class="stat-icon primary">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="totalRevenue">R$ 0,00</div>
                    <div class="stat-label">Receita Total</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span id="revenueChange">+0%</span> vs m√™s anterior
                    </div>
                </div>

                <div class="stat-card" id="profitStatCard">
                    <div class="stat-header">
                        <div class="stat-icon secondary">
                            <i class="fas fa-chart-line"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="totalProfit">R$ 0,00</div>
                    <div class="stat-label">Lucro Total</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span id="profitChange">+0%</span> vs m√™s anterior
                    </div>
                </div>

                <div class="stat-card" id="marginStatCard">
                    <div class="stat-header">
                        <div class="stat-icon accent">
                            <i class="fas fa-percentage"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="avgMargin">0%</div>
                    <div class="stat-label">Margem M√©dia</div>
                    <div class="stat-change neutral">
                        <span id="marginChange">Est√°vel</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon info">
                            <i class="fas fa-truck"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="totalTrips">0</div>
                    <div class="stat-label">Total de Viagens</div>
                    <div class="stat-change positive">
                        <i class="fas fa-plus"></i>
                        <span id="tripsChange">0</span> este m√™s
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon warning">
                            <i class="fas fa-road"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="totalKm">0 km</div>
                    <div class="stat-label">KM Rodados</div>
                    <div class="stat-change neutral">
                        <span id="avgPerKm">R$ 0,00/km</span> m√©dia
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon danger">
                            <i class="fas fa-users"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="totalClients">0</div>
                    <div class="stat-label">Clientes Ativos</div>
                    <div class="stat-change neutral">
                        <span id="topClient">-</span> mais lucrativo
                    </div>
                </div>
            </div>

            <div class="chart-grid">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-chart-area"></i> Receita por M√™s
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="revenueChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-chart-pie"></i> Lucro por Cliente
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="clientChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-rocket"></i> A√ß√µes R√°pidas
                    </h3>
                </div>
                <div class="card-body">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <button class="btn btn-primary" onclick="showPage('clients')">
                            <i class="fas fa-user-plus"></i> Novo Cliente
                        </button>
                        <button class="btn btn-secondary" onclick="showPage('suppliers')">
                            <i class="fas fa-truck-loading"></i> Novo Fornecedor
                        </button>
                        <button class="btn btn-accent" onclick="showPage('trips')">
                            <i class="fas fa-plus"></i> Nova Viagem
                        </button>
                        <button class="btn btn-outline" onclick="showPage('calculators')">
                            <i class="fas fa-calculator"></i> Calculadoras
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- CLIENTS PAGE (Simplified for space) -->
        <div id="clients" class="page">
            <div class="page-header">
                <h2 class="page-title">
                    <i class="fas fa-users"></i> Gest√£o de Clientes
                </h2>
                <button class="btn btn-primary btn-sm" onclick="showClientForm()">
                    <i class="fas fa-plus"></i> Novo Cliente
                </button>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-plus"></i> Cadastrar Cliente
                    </h3>
                </div>
                <div class="card-body">
                    <form id="clientForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Nome/Empresa *</label>
                                <input type="text" class="form-input" name="nome" placeholder="Nome do cliente" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Telefone</label>
                                <input type="tel" class="form-input" name="telefone" placeholder="(11) 99999-9999">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-input" name="email" placeholder="cliente@email.com">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Cidade</label>
                                <input type="text" class="form-input" name="cidade" placeholder="Cidade">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Salvar Cliente
                        </button>
                    </form>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-list"></i> Clientes Cadastrados (<span id="clientsCount">0</span>)
                    </h3>
                </div>
                <div class="card-body">
                    <div id="clientsList">
                        <div class="empty-state">
                            <i class="fas fa-users"></i>
                            <h3>Nenhum cliente cadastrado</h3>
                            <p>Cadastre seu primeiro cliente usando o formul√°rio acima</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SUPPLIERS PAGE -->
        <div id="suppliers" class="page">
            <div class="page-header">
                <h2 class="page-title">
                    <i class="fas fa-truck-loading"></i> Fornecedores
                </h2>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-plus"></i> Novo Fornecedor
                    </h3>
                </div>
                <div class="card-body">
                    <form id="supplierForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Nome da Empresa *</label>
                                <input type="text" class="form-input" name="nome" placeholder="Nome da empresa" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Tipo de Servi√ßo</label>
                                <select class="form-select" name="tipo">
                                    <option value="">Selecione...</option>
                                    <option value="Combust√≠vel">Combust√≠vel</option>
                                    <option value="Manuten√ß√£o">Manuten√ß√£o</option>
                                    <option value="Pneus">Pneus</option>
                                    <option value="Pe√ßas">Pe√ßas</option>
                                    <option value="Outros">Outros</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Telefone</label>
                                <input type="tel" class="form-input" name="telefone" placeholder="(11) 99999-9999">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Cidade</label>
                                <input type="text" class="form-input" name="cidade" placeholder="Cidade">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-secondary">
                            <i class="fas fa-save"></i> Salvar Fornecedor
                        </button>
                    </form>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-list"></i> Fornecedores (<span id="suppliersCount">0</span>)
                    </h3>
                </div>
                <div class="card-body">
                    <div id="suppliersList">
                        <div class="empty-state">
                            <i class="fas fa-truck-loading"></i>
                            <h3>Nenhum fornecedor cadastrado</h3>
                            <p>Cadastre seus fornecedores para melhor controle</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TRIPS PAGE -->
        <div id="trips" class="page">
            <div class="page-header">
                <h2 class="page-title">
                    <i class="fas fa-truck"></i> Viagens
                </h2>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-plus"></i> Nova Viagem
                    </h3>
                </div>
                <div class="card-body">
                    <form id="tripForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Cliente *</label>
                                <select class="form-select" name="clienteId" required>
                                    <option value="">Selecione um cliente...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Data *</label>
                                <input type="date" class="form-input" name="data" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">KM *</label>
                                <input type="number" class="form-input" name="km" placeholder="0" step="0.1" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Receita (R$) *</label>
                                <input type="number" class="form-input" name="receita" placeholder="0.00" step="0.01" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Combust√≠vel (R$) *</label>
                                <input type="number" class="form-input" name="combustivel" placeholder="0.00" step="0.01" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Outros Custos (R$)</label>
                                <input type="number" class="form-input" name="custos" placeholder="0.00" step="0.01" value="0">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Salvar Viagem
                        </button>
                    </form>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-list"></i> Viagens (<span id="tripsCount">0</span>)
                    </h3>
                </div>
                <div class="card-body">
                    <div id="tripsList">
                        <div class="empty-state">
                            <i class="fas fa-truck"></i>
                            <h3>Nenhuma viagem cadastrada</h3>
                            <p>Cadastre clientes primeiro, depois adicione viagens</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CALCULATORS PAGE -->
        <div id="calculators" class="page">
            <div class="page-header">
                <h2 class="page-title">
                    <i class="fas fa-calculator"></i> Calculadoras Inteligentes
                </h2>
            </div>

            <div class="alert alert-success">
                <i class="alert-icon fas fa-brain"></i>
                <div class="alert-content">
                    <div class="alert-title">üßÆ Calculadoras Avan√ßadas</div>
                    Use nossas calculadoras para simular lucros, estimar custos e tomar decis√µes mais inteligentes!
                </div>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 2rem;">
                <!-- Calculadora de Frete -->
                <div class="calculator-card">
                    <h3 style="color: var(--primary); margin-bottom: 1rem;">üöõ Calculadora de Frete</h3>
                    <div class="form-group">
                        <label class="form-label">Dist√¢ncia (KM)</label>
                        <input type="number" class="form-input" id="calc1-km" placeholder="0" onchange="calcularFrete()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Peso da Carga (Ton)</label>
                        <input type="number" class="form-input" id="calc1-peso" placeholder="0" step="0.1" onchange="calcularFrete()">
                    </div>
                    <div class="calculator-result" id="result-frete" style="display: none;">
                        <div class="result-value" id="valor-frete">R$ 0,00</div>
                        <div class="result-label">Valor Sugerido do Frete</div>
                    </div>
                </div>

                <!-- Simulador de Lucro -->
                <div class="calculator-card">
                    <h3 style="color: var(--secondary); margin-bottom: 1rem;">üí∞ Simulador de Lucro</h3>
                    <div class="form-group">
                        <label class="form-label">Receita (R$)</label>
                        <input type="number" class="form-input" id="calc2-receita" placeholder="0.00" step="0.01" onchange="simularLucro()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Combust√≠vel (R$)</label>
                        <input type="number" class="form-input" id="calc2-combustivel" placeholder="0.00" step="0.01" onchange="simularLucro()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Outros Custos (R$)</label>
                        <input type="number" class="form-input" id="calc2-custos" placeholder="0.00" step="0.01" onchange="simularLucro()">
                    </div>
                    <div class="calculator-result" id="result-lucro" style="display: none;">
                        <div class="result-value" id="valor-lucro">R$ 0,00</div>
                        <div class="result-label">Lucro Estimado (<span id="margem-lucro">0%</span>)</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ANALYTICS PAGE -->
        <div id="analytics" class="page">
            <div class="page-header">
                <h2 class="page-title">
                    <i class="fas fa-chart-pie"></i> Analytics Avan√ßados
                </h2>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon primary">
                            <i class="fas fa-trophy"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="analytics-best-client">-</div>
                    <div class="stat-label">Cliente Mais Lucrativo</div>
                    <div class="stat-change positive">
                        <span id="best-client-profit">R$ 0,00</span> de lucro
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon secondary">
                            <i class="fas fa-route"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="analytics-avg-km">0 km</div>
                    <div class="stat-label">M√©dia por Viagem</div>
                    <div class="stat-change neutral">
                        <span id="total-routes">0</span> rotas
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-chart-bar"></i> An√°lise de Performance
                    </h3>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="analyticsChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- FINANCIAL PAGE -->
        <div id="financial" class="page">
            <div class="page-header">
                <h2 class="page-title">
                    <i class="fas fa-dollar-sign"></i> Gest√£o Financeira
                </h2>
            </div>

            <div class="alert alert-warning">
                <i class="alert-icon fas fa-lock"></i>
                <div class="alert-content">
                    <div class="alert-title">üîí √Årea Restrita - Administradores</div>
                    Esta se√ß√£o cont√©m informa√ß√µes financeiras sens√≠veis e est√° dispon√≠vel apenas para administradores.
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon primary">
                            <i class="fas fa-arrow-up"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="financial-revenue">R$ 0,00</div>
                    <div class="stat-label">Receita Mensal</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span id="revenue-growth">+0%</span> vs anterior
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon danger">
                            <i class="fas fa-arrow-down"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="financial-costs">R$ 0,00</div>
                    <div class="stat-label">Custos Mensais</div>
                    <div class="stat-change neutral">
                        <span id="cost-avg">M√©dia</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon secondary">
                            <i class="fas fa-piggy-bank"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="financial-profit">R$ 0,00</div>
                    <div class="stat-label">Lucro L√≠quido</div>
                    <div class="stat-change positive">
                        <span id="profit-margin">0%</span> margem
                    </div>
                </div>
            </div>
        </div>

        <!-- REPORTS PAGE -->
        <div id="reports" class="page">
            <div class="page-header">
                <h2 class="page-title">
                    <i class="fas fa-file-alt"></i> Relat√≥rios
                </h2>
                <button class="btn btn-accent btn-sm" onclick="exportAll()">
                    <i class="fas fa-download"></i> Exportar Tudo
                </button>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon info">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="report-total-trips">0</div>
                    <div class="stat-label">Total de Viagens</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon warning">
                            <i class="fas fa-road"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="report-total-km">0 km</div>
                    <div class="stat-label">KM Rodados</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-download"></i> Exportar Dados
                    </h3>
                </div>
                <div class="card-body">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <button class="btn btn-primary" onclick="exportClients()">
                            <i class="fas fa-users"></i> Exportar Clientes
                        </button>
                        <button class="btn btn-secondary" onclick="exportSuppliers()">
                            <i class="fas fa-truck-loading"></i> Exportar Fornecedores
                        </button>
                        <button class="btn btn-accent" onclick="exportTrips()">
                            <i class="fas fa-truck"></i> Exportar Viagens
                        </button>
                    </div>
                    <textarea id="exportData" style="width: 100%; height: 200px; margin-top: 1.5rem; padding: 1rem; border: 1px solid var(--gray-light); border-radius: var(--border-radius); font-family: monospace; display: none;" readonly></textarea>
                </div>
            </div>
        </div>

        <!-- SETTINGS PAGE -->
        <div id="settings" class="page">
            <div class="page-header">
                <h2 class="page-title">
                    <i class="fas fa-cog"></i> Configura√ß√µes
                </h2>
            </div>

            <div class="tab-container">
                <div class="tab-nav">
                    <button class="tab-btn active" onclick="showTab('settings-profile', this)">
                        <i class="fas fa-user-cog"></i> Meu Perfil
                    </button>
                    <button class="tab-btn" onclick="showTab('settings-users', this)" id="usersTabBtn">
                        <i class="fas fa-users-cog"></i> Usu√°rios
                    </button>
                    <button class="tab-btn" onclick="showTab('settings-system', this)">
                        <i class="fas fa-server"></i> Sistema
                    </button>
                </div>

                <!-- PROFILE TAB -->
                <div id="settings-profile" class="tab-content active">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-user-edit"></i> Editar Perfil
                            </h3>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info">
                                <i class="alert-icon fas fa-info-circle"></i>
                                <div class="alert-content">
                                    <div class="alert-title">üë§ Informa√ß√µes Pessoais</div>
                                    Altere suas informa√ß√µes de login e dados pessoais. As altera√ß√µes entram em vigor imediatamente.
                                </div>
                            </div>

                            <form id="profileForm">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Nome Completo</label>
                                        <input type="text" class="form-input" name="fullName" id="profileFullName" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Email</label>
                                        <input type="email" class="form-input" name="email" id="profileEmail" required>
                                    </div>
                                </div>

                                <h4 style="margin: 2rem 0 1rem; color: var(--primary); font-weight: 700;">üîê Credenciais de Acesso</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Nome de Usu√°rio</label>
                                        <input type="text" class="form-input" name="username" id="profileUsername" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">N√≠vel de Acesso</label>
                                        <input type="text" class="form-input" id="profileRole" readonly style="background: var(--gray-light);">
                                    </div>
                                </div>

                                <h4 style="margin: 2rem 0 1rem; color: var(--warning); font-weight: 700;">üîë Alterar Senha</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Senha Atual</label>
                                        <input type="password" class="form-input" name="currentPassword" placeholder="Digite sua senha atual">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Nova Senha</label>
                                        <input type="password" class="form-input" name="newPassword" placeholder="Nova senha (deixe vazio para n√£o alterar)" minlength="4">
                                    </div>
                                </div>

                                <div style="margin-top: 2rem;">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i> Salvar Altera√ß√µes
                                    </button>
                                    <button type="button" class="btn btn-outline" onclick="loadUserProfile()">
                                        <i class="fas fa-undo"></i> Cancelar
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-info-circle"></i> Informa√ß√µes da Conta
                            </h3>
                        </div>
                        <div class="card-body">
                            <div class="stats-grid">
                                <div style="text-align: center; padding: 2rem; background: var(--gray-light); border-radius: var(--border-radius);">
                                    <div style="font-size: 3rem; margin-bottom: 1rem;" id="accountAvatarLarge">üë§</div>
                                    <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;" id="accountFullName">-</div>
                                    <div style="color: var(--gray); font-size: 0.9rem;" id="accountUsername">@-</div>
                                </div>

                                <div style="text-align: center; padding: 2rem; background: var(--gray-light); border-radius: var(--border-radius);">
                                    <div style="font-size: 3rem; margin-bottom: 1rem; color: var(--primary);">üîë</div>
                                    <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;">N√≠vel de Acesso</div>
                                    <div style="color: var(--primary); font-weight: 600;" id="accountRole">-</div>
                                </div>

                                <div style="text-align: center; padding: 2rem; background: var(--gray-light); border-radius: var(--border-radius);">
                                    <div style="font-size: 3rem; margin-bottom: 1rem; color: var(--secondary);">üìÖ</div>
                                    <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;">Criado em</div>
                                    <div style="color: var(--gray); font-weight: 600;" id="accountCreated">-</div>
                                </div>

                                <div style="text-align: center; padding: 2rem; background: var(--gray-light); border-radius: var(--border-radius);">
                                    <div style="font-size: 3rem; margin-bottom: 1rem; color: var(--success);">üïê</div>
                                    <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;">√öltimo Login</div>
                                    <div style="color: var(--gray); font-weight: 600;" id="accountLastLogin">-</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- USERS TAB -->
                <div id="settings-users" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-users"></i> Usu√°rios do Sistema (<span id="totalUsersCount">0</span>)
                            </h3>
                        </div>
                        <div class="card-body">
                            <div id="usersList">
                                <div class="empty-state">
                                    <i class="fas fa-users"></i>
                                    <h3>Carregando usu√°rios...</h3>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-user-plus"></i> Gerenciar Usu√°rios
                            </h3>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info">
                                <i class="alert-icon fas fa-info-circle"></i>
                                <div class="alert-content">
                                    <div class="alert-title">üë• Sistema Multiusu√°rio Avan√ßado</div>
                                    <strong>Admin:</strong> Acesso total ao sistema<br>
                                    <strong>Usu√°rio:</strong> Acesso restrito (sem financeiro)
                                </div>
                            </div>

                            <div class="tab-container">
                                <div class="tab-nav">
                                    <button class="tab-btn active" onclick="showTab('user-invite', this)">
                                        <i class="fas fa-link"></i> Gerar Convite
                                    </button>
                                    <button class="tab-btn" onclick="showTab('user-manual', this)">
                                        <i class="fas fa-user-plus"></i> Adicionar Manualmente
                                    </button>
                                </div>

                                <div id="user-invite" class="tab-content active">
                                    <h4 style="margin-bottom: 1rem; color: var(--primary);">üîó Convidar por Link</h4>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label class="form-label">N√≠vel de Acesso</label>
                                            <select class="form-select" id="inviteUserType">
                                                <option value="user">üë§ Usu√°rio (Acesso Restrito)</option>
                                                <option value="admin">üëë Administrador (Acesso Total)</option>
                                            </select>
                                        </div>
                                        <div class="form-group" style="display: flex; align-items: end;">
                                            <button class="btn btn-accent" onclick="generateInviteLink()">
                                                <i class="fas fa-link"></i> Gerar Link de Convite
                                            </button>
                                        </div>
                                    </div>

                                    <div id="inviteResult" class="hidden" style="margin-top: 1.5rem; padding: 1.5rem; background: var(--gray-light); border-radius: var(--border-radius); border: 1px solid var(--primary);">
                                        <label class="form-label">üéâ Link de Convite Gerado:</label>
                                        <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                                            <input type="text" id="inviteLink" class="form-input" readonly style="font-family: monospace; font-size: 0.9rem;">
                                            <button class="btn btn-outline btn-sm" onclick="copyInviteLink()">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                        </div>
                                        <small style="color: var(--danger); margin-top: 1rem; display: block; font-weight: 600;">
                                            ‚ö†Ô∏è Este link expira em 7 dias. Compartilhe apenas com pessoas autorizadas.
                                        </small>
                                    </div>
                                </div>

                                <div id="user-manual" class="tab-content">
                                    <form id="userForm">
                                        <h4 style="margin-bottom: 1rem; color: var(--secondary);">‚ûï Adicionar Usu√°rio Diretamente</h4>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label class="form-label">Nome Completo</label>
                                                <input type="text" class="form-input" name="nomeCompleto" placeholder="Nome do usu√°rio" required>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Email</label>
                                                <input type="email" class="form-input" name="email" placeholder="usuario@email.com" required>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Nome de Usu√°rio</label>
                                                <input type="text" class="form-input" name="username" placeholder="usuario_unico" required>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Senha Inicial</label>
                                                <input type="password" class="form-input" name="senha" placeholder="Senha tempor√°ria" required minlength="4">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">N√≠vel de Acesso</label>
                                                <select class="form-select" name="nivel" required>
                                                    <option value="user">üë§ Usu√°rio (Acesso Restrito)</option>
                                                    <option value="admin">üëë Administrador (Acesso Total)</option>
                                                </select>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-secondary">
                                            <i class="fas fa-user-plus"></i> Criar Usu√°rio
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SYSTEM TAB -->
                <div id="settings-system" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-info-circle"></i> Informa√ß√µes do Sistema
                            </h3>
                        </div>
                        <div class="card-body">
                            <div class="stats-grid">
                                <div style="text-align: center; padding: 2rem; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; border-radius: var(--border-radius);">
                                    <div style="font-size: 3rem; margin-bottom: 1rem;">üöõ</div>
                                    <div style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem;">TransCS Pro Ultimate</div>
                                    <div style="opacity: 0.9;">Vers√£o 5.1.0</div>
                                </div>

                                <div style="text-align: center; padding: 2rem; background: var(--gray-light); border-radius: var(--border-radius);">
                                    <div style="font-size: 2rem; margin-bottom: 1rem; color: var(--success);">‚úÖ</div>
                                    <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;">Status</div>
                                    <div style="color: var(--success); font-weight: 600;">Online</div>
                                </div>

                                <div style="text-align: center; padding: 2rem; background: var(--gray-light); border-radius: var(--border-radius);">
                                    <div style="font-size: 2rem; margin-bottom: 1rem; color: var(--info);">üîí</div>
                                    <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;">Seguran√ßa</div>
                                    <div style="color: var(--info); font-weight: 600;">Protegido</div>
                                </div>

                                <div style="text-align: center; padding: 2rem; background: var(--gray-light); border-radius: var(--border-radius);">
                                    <div style="font-size: 2rem; margin-bottom: 1rem; color: var(--accent);">üë•</div>
                                    <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;">Usu√°rios</div>
                                    <div style="color: var(--accent); font-weight: 600;" id="systemUsersCount">0</div>
                                </div>
                            </div>

                            <div style="margin-top: 2rem; padding: 2rem; background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); border-radius: var(--border-radius); border: 1px solid var(--gray-light);">
                                <h4 style="margin-bottom: 1rem; color: var(--dark);">üöÄ Recursos Dispon√≠veis:</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                    <div>‚úÖ Sistema de Usu√°rios</div>
                                    <div>‚úÖ Dashboard Visual</div>
                                    <div>‚úÖ Calculadoras Inteligentes</div>
                                    <div>‚úÖ Analytics Avan√ßados</div>
                                    <div>‚úÖ Controle de Acesso</div>
                                    <div>‚úÖ Interface Moderna</div>
                                    <div>‚úÖ Backup Autom√°tico</div>
                                    <div>‚úÖ Modo Escuro/Claro</div>
                                </div>
                            </div>

                            <div style="margin-top: 2rem; text-align: center;">
                                <button class="btn btn-danger" onclick="clearAllData()">
                                    <i class="fas fa-trash-alt"></i> Limpar Todos os Dados
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== GLOBAL VARIABLES ====================
        let currentUser = null;
        let data = {
            users: [],
            invites: {},
            clients: [],
            suppliers: [],
            trips: []
        };

        let charts = {};

        // ==================== INITIALIZATION ====================
        function init() {
            console.log('üöÄ Iniciando TransCS Pro Ultimate v5.1...');
            
            loadData();
            ensureAdminUser();
            checkSession();
            setupEvents();
            setTodayDate();
            updateTime();
            setInterval(updateTime, 1000);
            
            console.log('‚úÖ Sistema iniciado com sucesso!');
        }

        function loadData() {
            try {
                const saved = localStorage.getItem('transcs_ultimate_v51_data');
                if (saved) {
                    data = { ...data, ...JSON.parse(saved) };
                }
                console.log('üìä Dados carregados:', data);
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
            }
        }

        function saveData() {
            try {
                localStorage.setItem('transcs_ultimate_v51_data', JSON.stringify(data));
                console.log('üíæ Dados salvos automaticamente');
            } catch (error) {
                console.error('Erro ao salvar dados:', error);
            }
        }

        function ensureAdminUser() {
            if (data.users.length === 0) {
                const adminUser = {
                    id: Date.now(),
                    username: 'admin',
                    password: '123',
                    fullName: 'Administrador do Sistema',
                    email: 'admin@transcs.com',
                    role: 'admin',
                    status: 'active',
                    createdAt: new Date().toISOString(),
                    lastLogin: null
                };
                
                data.users.push(adminUser);
                saveData();
                console.log('üëë Usu√°rio admin criado: admin/123');
            }
        }

        function checkSession() {
            const savedSession = localStorage.getItem('transcs_current_user');
            if (savedSession) {
                try {
                    const userData = JSON.parse(savedSession);
                    const user = data.users.find(u => u.id === userData.id && u.username === userData.username);
                    if (user && user.status === 'active') {
                        currentUser = user;
                        showApp();
                        return;
                    } else if (user && user.status === 'blocked') {
                        localStorage.removeItem('transcs_current_user');
                        showNotification('üö´ Sua conta foi bloqueada pelo administrador.', 'error');
                    }
                } catch (error) {
                    console.error('Sess√£o inv√°lida:', error);
                    localStorage.removeItem('transcs_current_user');
                }
            }
            
            showLoginScreen();
        }

        function showLoginScreen() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('app').classList.remove('active');
            
            // Limpar campos por seguran√ßa
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        function setupEvents() {
            // Login and Register
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
            
            // Forms
            document.getElementById('clientForm').addEventListener('submit', handleClientSubmit);
            document.getElementById('supplierForm').addEventListener('submit', handleSupplierSubmit);
            document.getElementById('tripForm').addEventListener('submit', handleTripSubmit);
            document.getElementById('profileForm').addEventListener('submit', handleProfileSubmit);
            document.getElementById('userForm').addEventListener('submit', handleUserSubmit);
            
            // Check for invite code
            checkInviteCode();
        }

        function setTodayDate() {
            const today = new Date().toISOString().split('T')[0];
            const dateInputs = document.querySelectorAll('input[type="date"]');
            dateInputs.forEach(input => {
                if (!input.value) {
                    input.value = today;
                }
            });
        }

        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('pt-BR');
            const timeElement = document.getElementById('currentTime');
            if (timeElement) {
                timeElement.textContent = timeString;
            }
        }

        // ==================== AUTHENTICATION ====================
        function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            
            const user = data.users.find(u => u.username === username && u.password === password);
            
            if (!user) {
                showNotification('‚ùå Usu√°rio ou senha incorretos', 'error');
                return;
            }

            if (user.status === 'blocked') {
                showNotification('üö´ Usu√°rio bloqueado. Entre em contato com o administrador.', 'error');
                return;
            }
            
            user.lastLogin = new Date().toISOString();
            currentUser = user;
            
            localStorage.setItem('transcs_current_user', JSON.stringify({
                id: user.id,
                username: user.username,
                role: user.role
            }));
            
            saveData();
            showApp();
            
            showNotification(`üéâ Bem-vindo, ${user.fullName}!`, 'success');
        }

        function handleRegister(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const userData = {
                fullName: formData.get('fullName'),
                email: formData.get('email'),
                username: formData.get('username'),
                password: formData.get('password'),
                inviteCode: formData.get('inviteCode')
            };
            
            // Validate invite code
            const invite = data.invites[userData.inviteCode];
            if (!invite || new Date(invite.expiresAt) < new Date()) {
                showNotification('‚ùå C√≥digo de convite inv√°lido ou expirado', 'error');
                return;
            }
            
            // Check uniqueness
            if (data.users.find(u => u.username === userData.username)) {
                showNotification('‚ùå Nome de usu√°rio j√° existe', 'error');
                return;
            }
            
            if (data.users.find(u => u.email === userData.email)) {
                showNotification('‚ùå Email j√° cadastrado', 'error');
                return;
            }
            
            // Create new user
            const newUser = {
                id: Date.now(),
                username: userData.username,
                password: userData.password,
                fullName: userData.fullName,
                email: userData.email,
                role: invite.role,
                status: 'active',
                createdAt: new Date().toISOString(),
                lastLogin: null
            };
            
            data.users.push(newUser);
            delete data.invites[userData.inviteCode];
            saveData();
            
            showNotification('‚úÖ Conta criada com sucesso! Fa√ßa login.', 'success');
            showLoginForm();
            
            document.getElementById('username').value = userData.username;
            document.getElementById('password').value = '';
        }

        function showApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('app').classList.add('active');
            
            updateUserInterface();
            updateAllData();
            initializeCharts();
            applyRolePermissions();
        }

        function updateUserInterface() {
            if (!currentUser) return;
            
            // Update user info in header
            const userNameElement = document.getElementById('userName');
            if (userNameElement) {
                userNameElement.textContent = currentUser.fullName;
            }
            
            // Update avatar
            const userAvatarElement = document.getElementById('userAvatar');
            if (userAvatarElement) {
                userAvatarElement.textContent = currentUser.fullName.charAt(0).toUpperCase();
            }
            
            // Update role
            const userRoleElements = document.querySelectorAll('.user-role');
            userRoleElements.forEach(el => {
                if (el) el.textContent = currentUser.role === 'admin' ? 'Administrador' : 'Usu√°rio';
            });
        }

        function applyRolePermissions() {
            if (!currentUser) return;
            
            if (currentUser.role === 'user') {
                // Hide financial tab for regular users
                const financialNav = document.getElementById('financialNav');
                if (financialNav) {
                    financialNav.style.display = 'none';
                }
                
                // Hide financial stats in dashboard
                const revenueStatCard = document.getElementById('revenueStatCard');
                const profitStatCard = document.getElementById('profitStatCard');
                const marginStatCard = document.getElementById('marginStatCard');
                const headerRevenueContainer = document.getElementById('headerRevenueContainer');
                
                if (revenueStatCard) revenueStatCard.style.display = 'none';
                if (profitStatCard) profitStatCard.style.display = 'none';
                if (marginStatCard) marginStatCard.style.display = 'none';
                if (headerRevenueContainer) headerRevenueContainer.style.display = 'none';
                
                // Hide users tab
                const usersTabBtn = document.getElementById('usersTabBtn');
                if (usersTabBtn) {
                    usersTabBtn.style.display = 'none';
                }
                
                console.log('üë§ Usu√°rio comum logado - Acesso restrito aplicado');
                
            } else {
                // Admin has full access - show everything
                const hiddenElements = document.querySelectorAll('[style*="display: none"]');
                hiddenElements.forEach(el => {
                    if (el.id === 'financialNav' || 
                        el.id === 'revenueStatCard' || 
                        el.id === 'profitStatCard' || 
                        el.id === 'marginStatCard' ||
                        el.id === 'headerRevenueContainer' ||
                        el.id === 'usersTabBtn') {
                        el.style.display = '';
                    }
                });
                
                console.log('üëë Administrador logado - Acesso total liberado');
            }
        }

        function logout() {
            if (confirm('Deseja realmente sair do sistema?')) {
                localStorage.removeItem('transcs_current_user');
                currentUser = null;
                showNotification('üëã Sess√£o encerrada com sucesso!', 'success');
                setTimeout(() => {
                    window.location.reload();
                }, 1500);
            }
        }

        // ==================== USER MANAGEMENT ====================
        function checkInviteCode() {
            const urlParams = new URLSearchParams(window.location.search);
            const inviteCode = urlParams.get('invite');
            
            if (inviteCode) {
                const invite = data.invites[inviteCode];
                if (invite && new Date(invite.expiresAt) > new Date()) {
                    showRegisterForm();
                    document.querySelector('input[name="inviteCode"]').value = inviteCode;
                    showNotification('üéâ Convite v√°lido! Complete seu cadastro.', 'success');
                } else {
                    showNotification('‚ùå Convite inv√°lido ou expirado.', 'error');
                }
            }
        }

        function showRegisterForm() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
        }

        function showLoginForm() {
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
        }

        function loadUserProfile() {
            if (!currentUser) return;
            
            document.getElementById('profileFullName').value = currentUser.fullName;
            document.getElementById('profileEmail').value = currentUser.email;
            document.getElementById('profileUsername').value = currentUser.username;
            document.getElementById('profileRole').value = currentUser.role === 'admin' ? 'Administrador' : 'Usu√°rio';
            
            // Update account info display
            document.getElementById('accountAvatarLarge').textContent = currentUser.fullName.charAt(0).toUpperCase();
            document.getElementById('accountFullName').textContent = currentUser.fullName;
            document.getElementById('accountUsername').textContent = '@' + currentUser.username;
            document.getElementById('accountRole').textContent = currentUser.role === 'admin' ? 'Administrador' : 'Usu√°rio';
            document.getElementById('accountCreated').textContent = new Date(currentUser.createdAt).toLocaleDateString('pt-BR');
            document.getElementById('accountLastLogin').textContent = currentUser.lastLogin ? 
                new Date(currentUser.lastLogin).toLocaleDateString('pt-BR') : 'Primeiro acesso';
        }

        function handleProfileSubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const currentPassword = formData.get('currentPassword');
            const newPassword = formData.get('newPassword');
            const newFullName = formData.get('fullName');
            const newEmail = formData.get('email');
            const newUsername = formData.get('username');
            
            // If changing password, validate current password
            if (newPassword) {
                if (!currentPassword || currentPassword !== currentUser.password) {
                    showNotification('‚ùå Senha atual incorreta', 'error');
                    return;
                }
            }
            
            // Check if new username is unique
            if (newUsername !== currentUser.username && data.users.find(u => u.username === newUsername && u.id !== currentUser.id)) {
                showNotification('‚ùå Nome de usu√°rio j√° existe', 'error');
                return;
            }
            
            // Check if new email is unique
            if (newEmail !== currentUser.email && data.users.find(u => u.email === newEmail && u.id !== currentUser.id)) {
                showNotification('‚ùå Email j√° cadastrado', 'error');
                return;
            }
            
            // Update user data
            currentUser.fullName = newFullName;
            currentUser.email = newEmail;
            currentUser.username = newUsername;
            
            if (newPassword) {
                currentUser.password = newPassword;
            }
            
            // Update in data array
            const userIndex = data.users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                data.users[userIndex] = currentUser;
            }
            
            // Update session
            localStorage.setItem('transcs_current_user', JSON.stringify({
                id: currentUser.id,
                username: currentUser.username,
                role: currentUser.role
            }));
            
            saveData();
            updateUserInterface();
            loadUserProfile();
            
            // Clear password fields
            document.querySelector('input[name="currentPassword"]').value = '';
            document.querySelector('input[name="newPassword"]').value = '';
            
            showNotification('‚úÖ Perfil atualizado com sucesso!', 'success');
        }

        function handleUserSubmit(e) {
            e.preventDefault();
            
            if (currentUser.role !== 'admin') {
                showNotification('‚ùå Apenas administradores podem criar usu√°rios', 'error');
                return;
            }
            
            const formData = new FormData(e.target);
            const userData = {
                fullName: formData.get('nomeCompleto'),
                email: formData.get('email'),
                username: formData.get('username'),
                password: formData.get('senha'),
                role: formData.get('nivel')
            };
            
            // Validate unique username
            if (data.users.find(u => u.username === userData.username)) {
                showNotification('‚ùå Nome de usu√°rio j√° existe', 'error');
                return;
            }
            
            // Validate unique email
            if (data.users.find(u => u.email === userData.email)) {
                showNotification('‚ùå Email j√° cadastrado', 'error');
                return;
            }
            
            // Create user
            const newUser = {
                id: Date.now(),
                username: userData.username,
                password: userData.password,
                fullName: userData.fullName,
                email: userData.email,
                role: userData.role,
                status: 'active',
                createdAt: new Date().toISOString(),
                lastLogin: null
            };
            
            data.users.push(newUser);
            saveData();
            
            e.target.reset();
            updateUsersList();
            
            showNotification(`‚úÖ Usu√°rio ${userData.fullName} criado com sucesso!`, 'success');
        }

        function updateUsersList() {
            const container = document.getElementById('usersList');
            const count = document.getElementById('totalUsersCount');
            const systemCount = document.getElementById('systemUsersCount');
            
            if (!container || !count) return;
            
            count.textContent = data.users.length;
            if (systemCount) systemCount.textContent = data.users.length;
            
            if (data.users.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <h3>Nenhum usu√°rio cadastrado</h3>
                        <p>Comece criando usu√°rios ou enviando convites</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = data.users.map(user => {
                const isCurrentUser = currentUser && user.id === currentUser.id;
                const roleText = user.role === 'admin' ? 'üëë Administrador' : 'üë§ Usu√°rio';
                const statusClass = user.status === 'active' ? 'success' : 'danger';
                const statusText = user.status === 'active' ? '‚úÖ Ativo' : 'üö´ Bloqueado';
                
                return `
                    <div class="item">
                        <div class="item-info">
                            <div class="item-name">
                                ${user.fullName} ${isCurrentUser ? '(Voc√™)' : ''}
                            </div>
                            <div class="item-details">
                                ${roleText} | @${user.username} | ${user.email}<br>
                                <span class="stat-change ${statusClass}" style="display: inline; padding: 0.2rem 0.5rem; margin-right: 0.5rem;">
                                    ${statusText}
                                </span>
                                Criado em: ${new Date(user.createdAt).toLocaleDateString('pt-BR')}
                            </div>
                        </div>
                        <div class="item-actions">
                            ${!isCurrentUser && currentUser.role === 'admin' ? `
                                <button class="btn btn-sm btn-outline" onclick="toggleUserStatus(${user.id})">
                                    <i class="fas fa-${user.status === 'active' ? 'ban' : 'check'}"></i> 
                                    ${user.status === 'active' ? 'Bloquear' : 'Ativar'}
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="deleteUser(${user.id})">
                                    <i class="fas fa-trash"></i> Excluir
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function toggleUserStatus(userId) {
            if (currentUser.role !== 'admin') {
                showNotification('‚ùå Apenas administradores podem alterar status de usu√°rios', 'error');
                return;
            }
            
            const user = data.users.find(u => u.id === userId);
            if (!user) return;
            
            const newStatus = user.status === 'active' ? 'blocked' : 'active';
            const action = newStatus === 'blocked' ? 'bloquear' : 'ativar';
            
            if (confirm(`Tem certeza que deseja ${action} o usu√°rio ${user.fullName}?`)) {
                user.status = newStatus;
                saveData();
                updateUsersList();
                showNotification(`‚úÖ Usu√°rio ${action === 'bloquear' ? 'bloqueado' : 'ativado'} com sucesso!`, 'success');
            }
        }

        function deleteUser(userId) {
            if (currentUser.role !== 'admin') {
                showNotification('‚ùå Apenas administradores podem excluir usu√°rios', 'error');
                return;
            }
            
            const user = data.users.find(u => u.id === userId);
            if (!user) return;
            
            if (confirm(`‚ö†Ô∏è Tem certeza que deseja excluir o usu√°rio ${user.fullName}?\n\nEsta a√ß√£o n√£o pode ser desfeita.`)) {
                data.users = data.users.filter(u => u.id !== userId);
                saveData();
                updateUsersList();
                showNotification('‚úÖ Usu√°rio exclu√≠do com sucesso!', 'success');
            }
        }

        function generateInviteLink() {
            if (currentUser.role !== 'admin') {
                showNotification('‚ùå Apenas administradores podem gerar convites', 'error');
                return;
            }

            const role = document.getElementById('inviteUserType').value;
            const code = 'INV-' + Math.random().toString(36).substr(2, 8).toUpperCase();
            const expiresAt = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000); // 7 days
            
            data.invites[code] = {
                code,
                role,
                createdBy: currentUser.id,
                createdAt: new Date().toISOString(),
                expiresAt: expiresAt.toISOString()
            };
            
            saveData();
            
            const link = `${window.location.origin}${window.location.pathname}?invite=${code}`;
            document.getElementById('inviteLink').value = link;
            document.getElementById('inviteResult').classList.remove('hidden');
            
            showNotification('üîó Link de convite gerado com sucesso!', 'success');
        }

        function copyInviteLink() {
            const input = document.getElementById('inviteLink');
            input.select();
            navigator.clipboard.writeText(input.value).then(() => {
                showNotification('üìã Link copiado para a √°rea de transfer√™ncia!', 'success');
            }).catch(() => {
                showNotification('üìã Link selecionado! Use Ctrl+C para copiar.', 'info');
            });
        }

        // ==================== DATA MANAGEMENT ====================
        function handleClientSubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const client = {
                id: Date.now(),
                nome: formData.get('nome'),
                telefone: formData.get('telefone'),
                email: formData.get('email'),
                cidade: formData.get('cidade'),
                userId: currentUser.id,
                createdAt: new Date().toISOString()
            };
            
            data.clients.push(client);
            saveData();
            
            e.target.reset();
            updateClientsList();
            updateClientSelect();
            updateStats();
            
            showNotification('‚úÖ Cliente cadastrado com sucesso!', 'success');
        }

        function handleSupplierSubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const supplier = {
                id: Date.now(),
                nome: formData.get('nome'),
                tipo: formData.get('tipo'),
                telefone: formData.get('telefone'),
                cidade: formData.get('cidade'),
                userId: currentUser.id,
                createdAt: new Date().toISOString()
            };
            
            data.suppliers.push(supplier);
            saveData();
            
            e.target.reset();
            updateSuppliersList();
            updateStats();
            
            showNotification('‚úÖ Fornecedor cadastrado com sucesso!', 'success');
        }

        function handleTripSubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const clienteId = parseInt(formData.get('clienteId'));
            const receita = parseFloat(formData.get('receita'));
            const combustivel = parseFloat(formData.get('combustivel'));
            const custos = parseFloat(formData.get('custos')) || 0;
            
            const totalCosts = combustivel + custos;
            const profit = receita - totalCosts;
            
            const trip = {
                id: Date.now(),
                clienteId: clienteId,
                data: formData.get('data'),
                km: parseFloat(formData.get('km')),
                receita: receita,
                combustivel: combustivel,
                custos: custos,
                totalCosts: totalCosts,
                profit: profit,
                userId: currentUser.id,
                createdAt: new Date().toISOString()
            };
            
            data.trips.push(trip);
            saveData();
            
            e.target.reset();
            setTodayDate();
            updateTripsList();
            updateStats();
            
            showNotification('‚úÖ Viagem cadastrada com sucesso!', 'success');
        }

        function updateClientsList() {
            const container = document.getElementById('clientsList');
            const count = document.getElementById('clientsCount');
            
            const userClients = data.clients.filter(c => c.userId === currentUser.id);
            
            count.textContent = userClients.length;
            
            if (userClients.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <h3>Nenhum cliente cadastrado</h3>
                        <p>Cadastre seu primeiro cliente usando o formul√°rio acima</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = userClients.map(client => `
                <div class="item">
                    <div class="item-info">
                        <div class="item-name">${client.nome}</div>
                        <div class="item-details">
                            ${client.cidade || 'Cidade n√£o informada'} | ${client.telefone || 'Telefone n√£o informado'}
                        </div>
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-sm btn-danger" onclick="deleteClient(${client.id})">
                            <i class="fas fa-trash"></i> Excluir
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function updateSuppliersList() {
            const container = document.getElementById('suppliersList');
            const count = document.getElementById('suppliersCount');
            
            const userSuppliers = data.suppliers.filter(s => s.userId === currentUser.id);
            
            count.textContent = userSuppliers.length;
            
            if (userSuppliers.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-truck-loading"></i>
                        <h3>Nenhum fornecedor cadastrado</h3>
                        <p>Cadastre seus fornecedores para melhor controle</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = userSuppliers.map(supplier => `
                <div class="item">
                    <div class="item-info">
                        <div class="item-name">${supplier.nome}</div>
                        <div class="item-details">
                            ${supplier.tipo || 'Tipo n√£o especificado'} | ${supplier.cidade || 'Cidade n√£o informada'}
                        </div>
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-sm btn-danger" onclick="deleteSupplier(${supplier.id})">
                            <i class="fas fa-trash"></i> Excluir
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function updateTripsList() {
            const container = document.getElementById('tripsList');
            const count = document.getElementById('tripsCount');
            
            const userTrips = data.trips.filter(t => t.userId === currentUser.id);
            
            count.textContent = userTrips.length;
            
            if (userTrips.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-truck"></i>
                        <h3>Nenhuma viagem cadastrada</h3>
                        <p>Cadastre clientes primeiro, depois adicione viagens</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = userTrips.map(trip => {
                const client = data.clients.find(c => c.id === trip.clienteId);
                const clientName = client ? client.nome : 'Cliente n√£o encontrado';
                const date = new Date(trip.data).toLocaleDateString('pt-BR');
                
                return `
                    <div class="item">
                        <div class="item-info">
                            <div class="item-name">${clientName} - ${date}</div>
                            <div class="item-details">
                                ${trip.km} km | Receita: R$ ${trip.receita.toFixed(2)} | Lucro: R$ ${trip.profit.toFixed(2)}
                            </div>
                        </div>
                        <div class="item-actions">
                            <button class="btn btn-sm btn-danger" onclick="deleteTrip(${trip.id})">
                                <i class="fas fa-trash"></i> Excluir
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateClientSelect() {
            const select = document.querySelector('select[name="clienteId"]');
            if (!select) return;
            
            const userClients = data.clients.filter(c => c.userId === currentUser.id);
            
            select.innerHTML = '<option value="">Selecione um cliente...</option>' +
                userClients.map(client => `<option value="${client.id}">${client.nome}</option>`).join('');
        }

        function deleteClient(id) {
            if (confirm('Tem certeza que deseja excluir este cliente?')) {
                data.clients = data.clients.filter(c => c.id !== id);
                saveData();
                updateClientsList();
                updateClientSelect();
                updateStats();
                showNotification('‚úÖ Cliente exclu√≠do com sucesso!', 'success');
            }
        }

        function deleteSupplier(id) {
            if (confirm('Tem certeza que deseja excluir este fornecedor?')) {
                data.suppliers = data.suppliers.filter(s => s.id !== id);
                saveData();
                updateSuppliersList();
                updateStats();
                showNotification('‚úÖ Fornecedor exclu√≠do com sucesso!', 'success');
            }
        }

        function deleteTrip(id) {
            if (confirm('Tem certeza que deseja excluir esta viagem?')) {
                data.trips = data.trips.filter(t => t.id !== id);
                saveData();
                updateTripsList();
                updateStats();
                showNotification('‚úÖ Viagem exclu√≠da com sucesso!', 'success');
            }
        }

        // ==================== STATISTICS ====================
        function updateStats() {
            if (!currentUser) return;
            
            const userTrips = data.trips.filter(t => t.userId === currentUser.id);
            const userClients = data.clients.filter(c => c.userId === currentUser.id);
            
            const totalRevenue = userTrips.reduce((sum, trip) => sum + trip.receita, 0);
            const totalProfit = userTrips.reduce((sum, trip) => sum + trip.profit, 0);
            const totalKm = userTrips.reduce((sum, trip) => sum + trip.km, 0);
            const avgMargin = totalRevenue > 0 ? (totalProfit / totalRevenue) * 100 : 0;
            const avgPerKm = totalKm > 0 ? totalRevenue / totalKm : 0;
            
            // Update dashboard stats
            document.getElementById('totalRevenue').textContent = `R$ ${totalRevenue.toFixed(2)}`;
            document.getElementById('totalProfit').textContent = `R$ ${totalProfit.toFixed(2)}`;
            document.getElementById('avgMargin').textContent = `${avgMargin.toFixed(1)}%`;
            document.getElementById('totalTrips').textContent = userTrips.length;
            document.getElementById('totalKm').textContent = `${totalKm.toFixed(0)} km`;
            document.getElementById('totalClients').textContent = userClients.length;
            document.getElementById('avgPerKm').textContent = `R$ ${avgPerKm.toFixed(2)}/km`;
            
            // Update header stats
            document.getElementById('headerClients').textContent = userClients.length;
            document.getElementById('headerTrips').textContent = userTrips.length;
            document.getElementById('headerRevenue').textContent = `R$ ${totalRevenue.toFixed(0)}`;
            
            // Update reports
            document.getElementById('report-total-trips').textContent = userTrips.length;
            document.getElementById('report-total-km').textContent = `${totalKm.toFixed(0)} km`;
            
            // Update analytics
            const avgKmPerTrip = userTrips.length > 0 ? totalKm / userTrips.length : 0;
            document.getElementById('analytics-avg-km').textContent = `${avgKmPerTrip.toFixed(0)} km`;
            document.getElementById('total-routes').textContent = userTrips.length;
            
            // Find best client
            if (userTrips.length > 0) {
                const clientProfits = {};
                userTrips.forEach(trip => {
                    if (!clientProfits[trip.clienteId]) {
                        clientProfits[trip.clienteId] = 0;
                    }
                    clientProfits[trip.clienteId] += trip.profit;
                });
                
                const topClientId = Object.keys(clientProfits).reduce((a, b) => 
                    clientProfits[a] > clientProfits[b] ? a : b
                );
                const topClient = data.clients.find(c => c.id == topClientId);
                
                document.getElementById('analytics-best-client').textContent = topClient ? topClient.nome : '-';
                document.getElementById('best-client-profit').textContent = `R$ ${clientProfits[topClientId].toFixed(2)}`;
                document.getElementById('topClient').textContent = topClient ? topClient.nome : '-';
            }
            
            // Update financial (admin only)
            if (currentUser.role === 'admin') {
                document.getElementById('financial-revenue').textContent = `R$ ${totalRevenue.toFixed(2)}`;
                document.getElementById('financial-costs').textContent = `R$ ${(totalRevenue - totalProfit).toFixed(2)}`;
                document.getElementById('financial-profit').textContent = `R$ ${totalProfit.toFixed(2)}`;
                document.getElementById('profit-margin').textContent = `${avgMargin.toFixed(1)}%`;
            }
        }

        function updateAllData() {
            updateClientsList();
            updateSuppliersList();
            updateTripsList();
            updateClientSelect();
            updateStats();
            updateUsersList();
            loadUserProfile();
        }

        function refreshDashboard() {
            updateStats();
            showNotification('üîÑ Dashboard atualizado!', 'info');
        }

        // ==================== CALCULATORS ====================
        function calcularFrete() {
            const km = parseFloat(document.getElementById('calc1-km').value) || 0;
            const peso = parseFloat(document.getElementById('calc1-peso').value) || 0;
            
            if (km > 0) {
                let basePorKm = 3.50; // Base: R$ 3,50 por km
                let adicionalPeso = peso * 0.50; // R$ 0,50 por tonelada
                let valorBase = (km * basePorKm) + adicionalPeso;
                
                document.getElementById('result-frete').style.display = 'block';
                document.getElementById('valor-frete').textContent = `R$ ${valorBase.toFixed(2)}`;
            } else {
                document.getElementById('result-frete').style.display = 'none';
            }
        }

        function simularLucro() {
            const receita = parseFloat(document.getElementById('calc2-receita').value) || 0;
            const combustivel = parseFloat(document.getElementById('calc2-combustivel').value) || 0;
            const custos = parseFloat(document.getElementById('calc2-custos').value) || 0;
            
            if (receita > 0) {
                const totalCustos = combustivel + custos;
                const lucro = receita - totalCustos;
                const margem = (lucro / receita) * 100;
                
                document.getElementById('result-lucro').style.display = 'block';
                document.getElementById('valor-lucro').textContent = `R$ ${lucro.toFixed(2)}`;
                document.getElementById('margem-lucro').textContent = `${margem.toFixed(1)}%`;
                
                // Color based on margin
                const valorElement = document.getElementById('valor-lucro');
                if (margem >= 15) {
                    valorElement.style.color = 'var(--success)';
                } else if (margem >= 0) {
                    valorElement.style.color = 'var(--warning)';
                } else {
                    valorElement.style.color = 'var(--danger)';
                }
            } else {
                document.getElementById('result-lucro').style.display = 'none';
            }
        }

        // ==================== NAVIGATION ====================
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Remove active from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Add active to clicked button
            event.target.classList.add('active');
        }

        function showTab(tabId, button) {
            // Get parent container
            const container = button.closest('.tab-container');
            
            // Hide all tab contents in this container
            container.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active from all tab buttons in this container
            container.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabId).classList.add('active');
            button.classList.add('active');
        }

        // ==================== EXPORT FUNCTIONS ====================
        function exportClients() {
            const userClients = data.clients.filter(c => c.userId === currentUser.id);
            
            if (userClients.length === 0) {
                showNotification('‚ùå Nenhum cliente para exportar', 'error');
                return;
            }
            
            let csv = 'Nome,Telefone,Email,Cidade\n';
            userClients.forEach(client => {
                csv += `"${client.nome}","${client.telefone || ''}","${client.email || ''}","${client.cidade || ''}"\n`;
            });
            
            showExportData(csv);
        }

        function exportSuppliers() {
            const userSuppliers = data.suppliers.filter(s => s.userId === currentUser.id);
            
            if (userSuppliers.length === 0) {
                showNotification('‚ùå Nenhum fornecedor para exportar', 'error');
                return;
            }
            
            let csv = 'Nome,Tipo,Telefone,Cidade\n';
            userSuppliers.forEach(supplier => {
                csv += `"${supplier.nome}","${supplier.tipo || ''}","${supplier.telefone || ''}","${supplier.cidade || ''}"\n`;
            });
            
            showExportData(csv);
        }

        function exportTrips() {
            const userTrips = data.trips.filter(t => t.userId === currentUser.id);
            
            if (userTrips.length === 0) {
                showNotification('‚ùå Nenhuma viagem para exportar', 'error');
                return;
            }
            
            let csv = 'Data,Cliente,KM,Receita,Combust√≠vel,Outros Custos,Lucro\n';
            userTrips.forEach(trip => {
                const client = data.clients.find(c => c.id === trip.clienteId);
                const clientName = client ? client.nome : 'Cliente n√£o encontrado';
                csv += `"${trip.data}","${clientName}",${trip.km},${trip.receita},${trip.combustivel},${trip.custos},${trip.profit}\n`;
            });
            
            showExportData(csv);
        }

        function exportAll() {
            const userTrips = data.trips.filter(t => t.userId === currentUser.id);
            const userClients = data.clients.filter(c => c.userId === currentUser.id);
            
            const totalRevenue = userTrips.reduce((sum, trip) => sum + trip.receita, 0);
            const totalProfit = userTrips.reduce((sum, trip) => sum + trip.profit, 0);
            const totalKm = userTrips.reduce((sum, trip) => sum + trip.km, 0);
            
            let output = '=== RELAT√ìRIO COMPLETO - TRANSCS PRO ULTIMATE v5.1 ===\n\n';
            output += `Usu√°rio: ${currentUser.fullName}\n`;
            output += `Gerado em: ${new Date().toLocaleString('pt-BR')}\n\n`;
            
            output += 'RESUMO:\n';
            output += `Clientes: ${userClients.length}\n`;
            output += `Viagens: ${userTrips.length}\n`;
            output += `Receita Total: R$ ${totalRevenue.toFixed(2)}\n`;
            output += `Lucro Total: R$ ${totalProfit.toFixed(2)}\n`;
            output += `KM Total: ${totalKm.toFixed(1)}\n\n`;
            
            if (userTrips.length > 0) {
                output += '√öLTIMAS VIAGENS:\n';
                userTrips.slice(0, 10).forEach(trip => {
                    const client = data.clients.find(c => c.id === trip.clienteId);
                    const clientName = client ? client.nome : 'Cliente n√£o encontrado';
                    output += `- ${trip.data} | ${clientName} | ${trip.km} km | R$ ${trip.receita.toFixed(2)}\n`;
                });
            }
            
            showExportData(output);
        }

        function showExportData(exportData) {
            const textarea = document.getElementById('exportData');
            textarea.value = exportData;
            textarea.style.display = 'block';
            textarea.select();
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(exportData).then(() => {
                    showNotification('üìã Dados copiados para a √°rea de transfer√™ncia!', 'success');
                });
            } else {
                showNotification('üìÑ Dados exibidos abaixo. Selecione e copie manualmente.', 'success');
            }
        }

        // ==================== UTILITY FUNCTIONS ====================
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const text = document.getElementById('notificationText');
            
            text.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const icon = document.getElementById('themeIcon');
            icon.className = document.body.classList.contains('dark-mode') ? 'fas fa-sun' : 'fas fa-moon';
            
            // Save theme preference
            localStorage.setItem('transcs_theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
        }

        function clearAllData() {
            if (confirm('‚ö†Ô∏è ATEN√á√ÉO: Esta a√ß√£o ir√° apagar TODOS os dados do sistema. Tem certeza?')) {
                if (confirm('üö® CONFIRMA√á√ÉO FINAL: Todos os dados ser√£o perdidos permanentemente. Continuar?')) {
                    localStorage.clear();
                    showNotification('üóëÔ∏è Todos os dados foram limpos!', 'warning');
                    setTimeout(() => {
                        window.location.reload();
                    }, 2000);
                }
            }
        }

        function initializeCharts() {
            // Initialize charts here if needed
            // For now, we'll keep it simple
        }

        // ==================== INITIALIZE APP ====================
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved theme
            const savedTheme = localStorage.getItem('transcs_theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                const icon = document.getElementById('themeIcon');
                if (icon) icon.className = 'fas fa-sun';
            }
            
            init();
        });
    </script>
</body>
</html>container {
            background: var(--dark);
            color: var(--white);
        }

        /* LOGIN SCREEN */
        .login-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 2rem;
        }

        .login-box {
            background: rgba(255, 255, 255, 0.95);
            padding: 3rem;
            border-radius: 20px;
            width: 100%;
            max-width: 450px;
            box-shadow: var(--shadow-xl);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .login-content {
            position: relative;
            z-index: 2;
        }

        .login-logo {
            margin-bottom: 2rem;
        }

        .login-logo i {
            font-size: 4rem;
            color: var(--primary);
            margin-bottom: 1rem;
            display: block;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .login-logo h1 {
            font-size: 2rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .login-logo .version {
            background: var(--accent);
            color: var(--white);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 0.5rem;
            display: inline-block;
        }

        .form-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .form-label {
            display: block;
            margin-bottom: 0.75rem;
            font-weight: 600;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 2px solid var(--gray-light);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            background: var(--white);
            font-family: inherit;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
            transform: translateY(-1px);
        }

        .btn {
            padding: 1rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            text-decoration: none;
            white-space: nowrap;
            font-family: inherit;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--white);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
            width: 100%;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(37, 99, 235, 0.5);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary), #059669);
            color: var(--white);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }

        .btn-secondary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.5);
        }

        .btn-accent {
            background: linear-gradient(135deg, var(--accent), #7c3aed);
            color: var(--white);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
        }

        .btn-accent:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.5);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            box-shadow: none;
        }

        .btn-outline:hover:not(:disabled) {
            background: var(--primary);
            color: var(--white);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            color: var(--white);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }

        .btn-danger:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.5);
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            width: auto;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .info-box {
            background: linear-gradient(135deg, #e0f2fe 0%, #b3e5fc 100%);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin-top: 1.5rem;
            font-size: 0.9rem;
            color: var(--dark);
            border: 1px solid rgba(6, 182, 212, 0.2);
        }

        .switch-link {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .switch-link:hover {
            color: var(--primary-dark);
            text-decoration: underline;
        }

        /* APP CONTAINER */
        .app {
            display: none;
        }

        .app.active {
            display: block;
        }

        /* HEADER */
        .header {
            background: linear-gradient(135deg, var(--dark) 0%, var(--gray-dark) 100%);
            color: var(--white);
            padding: 2rem;
            position: relative;
            overflow: hidden;
        }

        .header-content {
            position: relative;
            z-index: 2;
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 2rem;
            align-items: center;
        }

        .header-left h1 {
            font-size: 2.5rem;
            font-weight: 900;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--primary-light), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-left .version-badge {
            font-size: 0.75rem;
            background: var(--accent);
            color: var(--white);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        .header-left p {
            opacity: 0.9;
            font-size: 1.1rem;
            font-weight: 500;
        }

        .header-stats {
            display: flex;
            gap: 2rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .quick-stat {
            text-align: center;
            min-width: 80px;
        }

        .quick-stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary-light);
            margin-bottom: 0.25rem;
        }

        .quick-stat-label {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .user-panel {
            background: rgba(255, 255, 255, 0.1);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: right;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-info {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-light), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: 700;
            font-size: 1.2rem;
        }

        .theme-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: var(--white);
            padding: 0.5rem;
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
            margin-left: 1rem;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* NAVIGATION */
        .nav {
            background: var(--dark);
            border-bottom: 3px solid var(--primary);
            position: sticky;
            top: 0;
            z-index: 90;
            box-shadow: var(--shadow);
        }

        .nav-tabs {
            display: flex;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .nav-tabs::-webkit-scrollbar {
            display: none;
        }

        .nav-btn {
            flex: 0 0 auto;
            min-width: 160px;
            padding: 1.25rem 2rem;
            background: transparent;
            border: none;
            color: var(--white);
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            white-space: nowrap;
            position: relative;
        }

        .nav-btn i {
            font-size: 1.1rem;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--white);
            box-shadow: var(--shadow);
        }

        .nav-btn.active::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-light), var(--secondary));
        }

        /* PAGES */
        .page {
            display: none;
            padding: 2rem;
            background: var(--gray-light);
            min-height: calc(100vh - 200px);
        }

        .dark-mode .page {
            background: var(--gray-dark);
        }

        .page.active {
            display: block;
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--primary);
        }

        .page-title {
            font-size: 2.25rem;
            font-weight: 800;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .dark-mode .page-title {
            color: var(--white);
        }

        .page-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        /* CARDS */
        .card {
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 0, 0, 0.05);
            overflow: hidden;
            transition: var(--transition);
            margin-bottom: 1.5rem;
        }

        .dark-mode .card {
            background: var(--dark);
            border-color: var(--gray-dark);
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--gray-light);
            background: linear-gradient(135deg, var(--white) 0%, #f8fafc 100%);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dark-mode .card-header {
            background: linear-gradient(135deg, var(--dark) 0%, var(--gray-dark) 100%);
            border-bottom-color: var(--gray-dark);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .dark-mode .card-title {
            color: var(--white);
        }

        .card-body {
            padding: 2rem;
        }

        /* STATS GRID */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--white) 0%, #f8fafc 100%);
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .dark-mode .stat-card {
            background: linear-gradient(135deg, var(--dark) 0%, var(--gray-dark) 100%);
            border-color: var(--gray-dark);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .stat-icon {
            width: 56px;
            height: 56px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            color: var(--white);
            box-shadow: var(--shadow);
        }

        .stat-icon.primary { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); }
        .stat-icon.secondary { background: linear-gradient(135deg, var(--secondary), #059669); }
        .stat-icon.accent { background: linear-gradient(135deg, var(--accent), #7c3aed); }
        .stat-icon.warning { background: linear-gradient(135deg, var(--warning), #d97706); }
        .stat-icon.danger { background: linear-gradient(135deg, var(--danger), #dc2626); }
        .stat-icon.info { background: linear-gradient(135deg, var(--info), #0891b2); }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--dark);
            margin-bottom: 0.5rem;
            line-height: 1;
        }

        .dark-mode .stat-value {
            color: var(--white);
        }

        .stat-label {
            color: var(--gray);
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 1rem;
        }

        .stat-change {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            margin-top: 0.75rem;
            padding: 0.5rem;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.02);
        }

        .stat-change.positive { 
            color: var(--success); 
            background: rgba(16, 185, 129, 0.1);
        }
        .stat-change.negative { 
            color: var(--danger); 
            background: rgba(239, 68, 68, 0.1);
        }
        .stat-change.neutral { 
            color: var(--gray); 
            background: rgba(107, 114, 128, 0.1);
        }

        /* FORM LAYOUTS */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        /* ITEMS LIST */
        .item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            background: var(--white);
            transition: var(--transition);
        }

        .dark-mode .item {
            background: var(--dark);
            border-color: var(--gray-dark);
        }

        .item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .item-info {
            flex: 1;
        }

        .item-name {
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--dark);
            font-size: 1.1rem;
        }

        .dark-mode .item-name {
            color: var(--white);
        }

        .item-details {
            color: var(--gray);
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .item-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* ALERTS */
        .alert {
            padding: 1.25rem 1.5rem;
            border-radius: var(--border-radius);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            border-left: 4px solid;
            box-shadow: var(--shadow);
        }

        .alert-success {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            color: #065f46;
            border-left-color: var(--success);
        }

        .alert-warning {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #92400e;
            border-left-color: var(--warning);
        }

        .alert-info {
            background: linear-gradient(135deg, #dbeafe 0%, #93c5fd 100%);
            color: #1e40af;
            border-left-color: var(--info);
        }

        .alert-danger {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: #991b1b;
            border-left-color: var(--danger);
        }

        .alert-icon {
            font-size: 1.25rem;
            margin-top: 0.125rem;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        /* CHARTS */
        .chart-container {
            position: relative;
            height: 300px;
            margin: 1rem 0;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        /* CALCULATORS */
        .calculator-card {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 1px solid rgba(6, 182, 212, 0.2);
            border-radius: var(--border-radius);
            padding: 2rem;
            margin-bottom: 1.5rem;
        }

        .calculator-result {
            background: var(--white);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            border: 2px solid var(--primary);
            margin-top: 1rem;
            text-align: center;
        }

        .result-value {
            font-size: 2rem;
            font-weight: 900;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .result-label {
            color: var(--gray);
            font-weight: 600;
        }

        /* NOTIFICATIONS */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            max-width: 400px;
            padding: 1.25rem 1.5rem;
            border-radius: var(--border-radius);
            color: var(--white);
            font-weight: 600;
            z-index: 1000;
            transform: translateX(450px);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            gap: 1rem;
            backdrop-filter: blur(10px);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success { 
            background: linear-gradient(135deg, var(--success), #059669);
        }
        .notification.error { 
            background: linear-gradient(135deg, var(--danger), #dc2626);
        }
        .notification.info { 
            background: linear-gradient(135deg, var(--info), #0891b2);
        }
        .notification.warning { 
            background: linear-gradient(135deg, var(--warning), #d97706);
        }

        .notification-icon {
            font-size: 1.25rem;
        }

        .notification-content {
            flex: 1;
        }

        /* EMPTY STATE */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            opacity: 0.3;
            display: block;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--gray-dark);
        }

        .dark-mode .empty-state h3 {
            color: var(--gray-light);
        }

        /* TABS */
        .tab-container {
            background: var(--white);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .dark-mode .tab-container {
            background: var(--dark);
        }

        .tab-nav {
            display: flex;
            background: var(--gray-light);
            border-bottom: 1px solid var(--gray-light);
        }

        .dark-mode .tab-nav {
            background: var(--gray-dark);
            border-bottom-color: var(--gray-dark);
        }

        .tab-btn {
            flex: 1;
            padding: 1rem 1.5rem;
            background: transparent;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: var(--gray);
            transition: var(--transition);
        }

        .tab-btn:hover {
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary);
        }

        .tab-btn.active {
            background: var(--white);
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }

        .dark-mode .
